(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1780:function(t,s,a){"use strict";a.r(s);var n=a(3),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("blockquote",[s("p",[t._v("把整个流程分成三个阶段："),s("strong",[t._v("准备阶段——> 匹配阶段——>执行阶段")])])]),t._v(" "),s("h3",{attrs:{id:"准备阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备阶段"}},[t._v("#")]),t._v(" "),s("strong",[t._v("准备阶段")])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("在 Web 容器第一次用到 DispatcherServlet 的时候，会创建其对象并执行 init 方法")])]),t._v(" "),s("li",[s("p",[t._v("init 方法内会创建 Spring Web 容器，并调用容器 refresh 方法")])]),t._v(" "),s("li",[s("p",[t._v("refresh 过程中会创建并初始化 SpringMVC 中的重要组件， 例如 MultipartResolver，HandlerMapping，HandlerAdapter，HandlerExceptionResolver、ViewResolver 等")]),t._v(" "),s("p",[t._v("DispatcherServlet源码分析")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onRefresh")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApplicationContext")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initStrategies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initStrategies")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ApplicationContext")]),t._v(" context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化多部 请求解析器，没有默认的实现")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initMultipartResolver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化地域解析器,默认的实现为AcceptHeaderLocaleResolver")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initLocaleResolver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化主题解析器，默认的实现为FixedThemeResolver")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initThemeResolver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化处理器映射器，这是一个集合，默认的实现为 BeanNameUrlHandlerMapping")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initHandlerMappings")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化处理器适配器，这也是一个集合，默认的实现有HttpRequestHandlerAdapter、SimpleControllerHandlerAdapter")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initHandlerAdapters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化异常解析器，也是一个集合")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initHandlerExceptionResolvers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化请求到视图名解析器，默认的实现为DefaultRequestToViewNameTranslator")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initRequestToViewNameTranslator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//初始化视图解析器，也是一个集合，InternalResourceViewResolver")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initViewResolvers")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("initFlashMapManager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br")])])]),t._v(" "),s("li",[s("p",[t._v("容器初始化后，会将上一步初始化好的重要组件，赋值给 DispatcherServlet 的成员变量，留待后用")])])]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:a(669),alt:"image-20210903140657163"}}),t._v(" "),s("h3",{attrs:{id:"匹配阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#匹配阶段"}},[t._v("#")]),t._v(" "),s("strong",[t._v("匹配阶段")])]),t._v(" "),s("ol",[s("li",[s("p",[t._v("用户发送的请求统一到达前端控制器 DispatcherServlet")])]),t._v(" "),s("li",[s("p",[t._v("DispatcherServlet 遍历所有 HandlerMapping ，找到与路径匹配的处理器")]),t._v(" "),s("p",[t._v("① HandlerMapping 有多个，每个 HandlerMapping 会返回不同的处理器对象，谁先匹配，返回谁的处理器。其中能识别 @RequestMapping 的优先级最高")]),t._v(" "),s("p",[t._v("② 对应 @RequestMapping 的处理器是 HandlerMethod，它包含了控制器对象和控制器方法信息")]),t._v(" "),s("p",[t._v("③ 其中路径与处理器的映射关系在 HandlerMapping 初始化时就会建立好")])])]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:a(670),alt:"image-20210903141017502"}}),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("将 HandlerMethod 连同匹配到的拦截器，生成调用链对象 HandlerExecutionChain 返回")])]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:a(671),alt:"image-20210903141124911"}}),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("遍历HandlerAdapter 处理器适配器，找到能处理 HandlerMethod 的适配器对象，开始调用")])]),t._v(" "),s("img",{staticStyle:{zoom:"80%"},attrs:{src:a(672),alt:"image-20210903141204799"}}),t._v(" "),s("h3",{attrs:{id:"调用阶段"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#调用阶段"}},[t._v("#")]),t._v(" "),s("strong",[t._v("调用阶段")])]),t._v(" "),s("ol",[s("li",[t._v("执行拦截器 preHandle")])]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:a(673),alt:"image-20210903141445870"}}),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[s("p",[t._v("由 HandlerAdapter 调用 HandlerMethod")]),t._v(" "),s("p",[t._v("① 调用前处理不同类型的参数")]),t._v(" "),s("p",[t._v("② 调用后处理不同类型的返回值")])])]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:a(674),alt:"image-20210903141658199"}}),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[s("p",[t._v("第 2 步没有异常")]),t._v(" "),s("p",[t._v("① 返回 ModelAndView")]),t._v(" "),s("p",[t._v("② 执行拦截器 postHandle 方法")]),t._v(" "),s("p",[t._v("③ 解析视图，得到 View 对象，进行视图渲染")])])]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:a(675),alt:"image-20210903141749830"}}),t._v(" "),s("ol",{attrs:{start:"4"}},[s("li",[t._v("第 2 步有异常，进入 HandlerExceptionResolver 异常处理流程")])]),t._v(" "),s("img",{staticStyle:{zoom:"67%"},attrs:{src:a(676),alt:"image-20210903141844185"}}),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[s("p",[t._v("最后都会执行拦截器的 afterCompletion 方法")])]),t._v(" "),s("li",[s("p",[t._v("如果控制器方法标注了 @ResponseBody 注解，则在第 2 步，就会生成 json 结果，并标记 ModelAndView 已处理，这样就不会执行第 3 步的视图渲染")])])])])}),[],!1,null,null,null);s.default=e.exports},669:function(t,s,a){t.exports=a.p+"assets/img/image-20210903140657163.20ed78df.png"},670:function(t,s,a){t.exports=a.p+"assets/img/image-20210903141017502.1dd441c8.png"},671:function(t,s,a){t.exports=a.p+"assets/img/image-20210903141124911.310e4504.png"},672:function(t,s,a){t.exports=a.p+"assets/img/image-20210903141204799.29a2b6d4.png"},673:function(t,s,a){t.exports=a.p+"assets/img/image-20210903141445870.99aa3b53.png"},674:function(t,s,a){t.exports=a.p+"assets/img/image-20210903141658199.c489daee.png"},675:function(t,s,a){t.exports=a.p+"assets/img/image-20210903141749830.88a2c45f.png"},676:function(t,s,a){t.exports=a.p+"assets/img/image-20210903141844185.af9aede7.png"}}]);