<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1、Docker简介 | 小熊学Java</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="./xiaobear.ico">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?c1b38aee20eeeb56adb65146a17e0b47";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
        </script>
    <meta name="description" content="放弃很容易，但坚持一定很酷！">
    <meta name="baidu-site-verification" content="code-FVmKyJMz00">
    
    <link rel="preload" href="/assets/css/0.styles.dda3ad7a.css" as="style"><link rel="preload" href="/assets/js/app.37f96e4a.js" as="script"><link rel="preload" href="/assets/js/8.bb74f850.js" as="script"><link rel="preload" href="/assets/js/4.e3bae0aa.js" as="script"><link rel="prefetch" href="/assets/js/10.27e489d6.js"><link rel="prefetch" href="/assets/js/11.5815b9d7.js"><link rel="prefetch" href="/assets/js/12.4098784e.js"><link rel="prefetch" href="/assets/js/13.4e1eb832.js"><link rel="prefetch" href="/assets/js/14.2ab4d8ce.js"><link rel="prefetch" href="/assets/js/15.247971f2.js"><link rel="prefetch" href="/assets/js/16.d4f33be1.js"><link rel="prefetch" href="/assets/js/17.c86cddfd.js"><link rel="prefetch" href="/assets/js/18.49946826.js"><link rel="prefetch" href="/assets/js/19.f62b8163.js"><link rel="prefetch" href="/assets/js/2.b063a5a7.js"><link rel="prefetch" href="/assets/js/20.f05782f3.js"><link rel="prefetch" href="/assets/js/21.70782ca1.js"><link rel="prefetch" href="/assets/js/22.59786b64.js"><link rel="prefetch" href="/assets/js/23.b6da86d5.js"><link rel="prefetch" href="/assets/js/24.ffda7169.js"><link rel="prefetch" href="/assets/js/25.d3ab7946.js"><link rel="prefetch" href="/assets/js/26.4cc7527d.js"><link rel="prefetch" href="/assets/js/27.9c3d2187.js"><link rel="prefetch" href="/assets/js/28.0fa85b1c.js"><link rel="prefetch" href="/assets/js/29.2926d7aa.js"><link rel="prefetch" href="/assets/js/3.339d98f6.js"><link rel="prefetch" href="/assets/js/30.1dd6b1a9.js"><link rel="prefetch" href="/assets/js/31.4f997bb4.js"><link rel="prefetch" href="/assets/js/32.450a0051.js"><link rel="prefetch" href="/assets/js/33.15ab9e73.js"><link rel="prefetch" href="/assets/js/34.238aaa61.js"><link rel="prefetch" href="/assets/js/35.c05019d6.js"><link rel="prefetch" href="/assets/js/36.36f059d3.js"><link rel="prefetch" href="/assets/js/37.b8c23052.js"><link rel="prefetch" href="/assets/js/38.96a28379.js"><link rel="prefetch" href="/assets/js/39.00f294af.js"><link rel="prefetch" href="/assets/js/40.2406e552.js"><link rel="prefetch" href="/assets/js/41.493ccbdb.js"><link rel="prefetch" href="/assets/js/42.c3d75bd8.js"><link rel="prefetch" href="/assets/js/43.98f593fe.js"><link rel="prefetch" href="/assets/js/44.5d2c7d63.js"><link rel="prefetch" href="/assets/js/45.f56e31d4.js"><link rel="prefetch" href="/assets/js/46.c38e5ca5.js"><link rel="prefetch" href="/assets/js/47.b7f424ba.js"><link rel="prefetch" href="/assets/js/48.fdf408a9.js"><link rel="prefetch" href="/assets/js/49.53816664.js"><link rel="prefetch" href="/assets/js/5.a19d2055.js"><link rel="prefetch" href="/assets/js/50.e3e5b264.js"><link rel="prefetch" href="/assets/js/51.06f12e58.js"><link rel="prefetch" href="/assets/js/52.3e9d0105.js"><link rel="prefetch" href="/assets/js/53.049754c2.js"><link rel="prefetch" href="/assets/js/54.fe280c9f.js"><link rel="prefetch" href="/assets/js/55.6f651899.js"><link rel="prefetch" href="/assets/js/56.38fcfa6f.js"><link rel="prefetch" href="/assets/js/57.31a4a23e.js"><link rel="prefetch" href="/assets/js/58.ac078fb0.js"><link rel="prefetch" href="/assets/js/59.20b36e89.js"><link rel="prefetch" href="/assets/js/6.6bbcc6f8.js"><link rel="prefetch" href="/assets/js/60.210d17ea.js"><link rel="prefetch" href="/assets/js/61.fd743c7c.js"><link rel="prefetch" href="/assets/js/62.1dddcf53.js"><link rel="prefetch" href="/assets/js/63.c27f1987.js"><link rel="prefetch" href="/assets/js/64.0af38e86.js"><link rel="prefetch" href="/assets/js/65.e8fbf733.js"><link rel="prefetch" href="/assets/js/66.e34f6a43.js"><link rel="prefetch" href="/assets/js/67.fe429269.js"><link rel="prefetch" href="/assets/js/68.895c5990.js"><link rel="prefetch" href="/assets/js/69.f527fb29.js"><link rel="prefetch" href="/assets/js/7.2add344e.js"><link rel="prefetch" href="/assets/js/70.6ce19d27.js"><link rel="prefetch" href="/assets/js/71.294b37cc.js"><link rel="prefetch" href="/assets/js/72.ed307b6c.js"><link rel="prefetch" href="/assets/js/73.abe42d1c.js"><link rel="prefetch" href="/assets/js/74.8ef1a16f.js"><link rel="prefetch" href="/assets/js/75.e531ddba.js"><link rel="prefetch" href="/assets/js/76.e1e22775.js"><link rel="prefetch" href="/assets/js/77.3ebd8344.js"><link rel="prefetch" href="/assets/js/78.3df17e1e.js"><link rel="prefetch" href="/assets/js/79.10176c31.js"><link rel="prefetch" href="/assets/js/9.8bc5ba15.js">
    <link rel="stylesheet" href="/assets/css/0.styles.dda3ad7a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">小熊学Java</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  🏠首页
</a></div><div class="nav-item"><a href="/brush/" class="nav-link">
  📝码不停题
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  💸面试专栏
</a></div><div class="nav-item"><a href="/install/" class="nav-link">
  📖安装教程
</a></div><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">
  📓学习笔记
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  🛠架构设计
</a></div><div class="nav-item"><a href="/about/me.html" class="nav-link">
  👨‍关于
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  🏠首页
</a></div><div class="nav-item"><a href="/brush/" class="nav-link">
  📝码不停题
</a></div><div class="nav-item"><a href="/interview/" class="nav-link">
  💸面试专栏
</a></div><div class="nav-item"><a href="/install/" class="nav-link">
  📖安装教程
</a></div><div class="nav-item"><a href="/notes/" class="nav-link router-link-active">
  📓学习笔记
</a></div><div class="nav-item"><a href="/architecture/" class="nav-link">
  🛠架构设计
</a></div><div class="nav-item"><a href="/about/me.html" class="nav-link">
  👨‍关于
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发工具篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/devTools/GitNote.html" class="sidebar-link">Git</a></li><li><a href="/notes/devTools/Linux.html" class="sidebar-link">Linux常用命令</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/basic/features.html" class="sidebar-link">Java 8新特性</a></li><li><a href="/notes/basic/dataAndAlgorithm.html" class="sidebar-link">数据结构与算法</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>数据库篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/database/MySQL.html" class="sidebar-link">MySQL</a></li><li><a href="/notes/frame/RedisNote.html" class="sidebar-link">Redis</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>框架篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/frame/JavaWebNote.html" class="sidebar-link">Java Web</a></li><li><a href="/notes/frame/SpringMVCNote.html" class="sidebar-link">Spring MVC</a></li><li><a href="/notes/frame/MybatisNote.html" class="sidebar-link">Mybatis</a></li><li><a href="/notes/frame/MybatisPlusNote.html" class="sidebar-link">Mybatis-plus</a></li><li><a href="/notes/frame/SpringBootNote.html" class="sidebar-link">Spring Boot</a></li><li><a href="/notes/frame/SpringCloudNote.html" class="sidebar-link">Spring Cloud</a></li><li><a href="/notes/frame/Docker.html" aria-current="page" class="active sidebar-link">Docker</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、docker简介" class="sidebar-link">1、Docker简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、docker为何会出现" class="sidebar-link">1、Docker为何会出现</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、容器与虚拟机的比较" class="sidebar-link">2、容器与虚拟机的比较</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、学习的用处" class="sidebar-link">3、学习的用处</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_4、官网地址" class="sidebar-link">4、官网地址</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、docker安装" class="sidebar-link">2、Docker安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、前提说明" class="sidebar-link">1、前提说明</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、docker的组成" class="sidebar-link">2、Docker的组成</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、整体架构及底层原理" class="sidebar-link">3、整体架构及底层原理</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_4、docker安装" class="sidebar-link">4、Docker安装</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_5、阿里云加速镜像" class="sidebar-link">5、阿里云加速镜像</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_6、hello-world" class="sidebar-link">6、Hello World</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_7、底层原理" class="sidebar-link">7、底层原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、docker常用命令" class="sidebar-link">3、Docker常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、帮助类启动命令" class="sidebar-link">1、帮助类启动命令</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、镜像命令" class="sidebar-link">2、镜像命令</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、容器命令" class="sidebar-link">3、容器命令</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_4、实操" class="sidebar-link">4、实操</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_5、从容器内拷贝文件到主机上" class="sidebar-link">5、从容器内拷贝文件到主机上</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_6、导入和导出容器" class="sidebar-link">6、导入和导出容器</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_7、常用命令汇总" class="sidebar-link">7、常用命令汇总</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_4、docker镜像" class="sidebar-link">4、Docker镜像</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、什么是docker镜像" class="sidebar-link">1、什么是Docker镜像</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、理解" class="sidebar-link">2、理解</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、commit操作" class="sidebar-link">3、commit操作</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_4、总结-2" class="sidebar-link">4、总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_5、本地镜像上传至阿里云" class="sidebar-link">5、本地镜像上传至阿里云</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、镜像的生成方法" class="sidebar-link">1、镜像的生成方法</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、本地推送到阿里云" class="sidebar-link">2、本地推送到阿里云</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、将阿里云上的镜像下载到本地" class="sidebar-link">3、将阿里云上的镜像下载到本地</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_6、本地镜像发布到私有库" class="sidebar-link">6、本地镜像发布到私有库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、本地镜像发布到私有库流程" class="sidebar-link">1、本地镜像发布到私有库流程</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、什么是docker-registry" class="sidebar-link">2、什么是Docker Registry</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、将本地镜像推送到私有库" class="sidebar-link">3、将本地镜像推送到私有库</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_7、docker容器数据卷" class="sidebar-link">7、Docker容器数据卷</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、什么是容器卷" class="sidebar-link">1、什么是容器卷</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、作用" class="sidebar-link">2、作用</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、案例" class="sidebar-link">3、案例</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_8、docker常规安装" class="sidebar-link">8、Docker常规安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、安装tomcat" class="sidebar-link">1、安装tomcat</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、安装mysql" class="sidebar-link">2、安装MySQL</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、安装redis" class="sidebar-link">3、安装redis</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_9、复杂安装" class="sidebar-link">9、复杂安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、mysql主从复制" class="sidebar-link">1、MySQL主从复制</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、redis集群" class="sidebar-link">2、redis集群</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_10、dockerfile解析" class="sidebar-link">10、DockerFile解析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、什么是dockerfile" class="sidebar-link">1、什么是DockerFile</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、dockerfile构建过程解析" class="sidebar-link">2、DockerFile构建过程解析</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、docker常用保留字指令" class="sidebar-link">3、Docker常用保留字指令</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_4、构建案例" class="sidebar-link">4、构建案例</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_5、虚悬镜像" class="sidebar-link">5、虚悬镜像</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_11、docker微服务实战" class="sidebar-link">11、Docker微服务实战</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、建立测试微服务模块" class="sidebar-link">1、建立测试微服务模块</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、通过dockerfile发布微服务部署到docker容器" class="sidebar-link">2、通过dockerfile发布微服务部署到docker容器</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_12、docker网络" class="sidebar-link">12、Docker网络</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、什么是docker网络" class="sidebar-link">1、什么是Docker网络</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、基本命令" class="sidebar-link">2、基本命令</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、作用" class="sidebar-link">3、作用</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_4、网络模式" class="sidebar-link">4、网络模式</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_5、docker平台架构图解" class="sidebar-link">5、Docker平台架构图解</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_13、docker-compose容器编排" class="sidebar-link">13、Docker-compose容器编排</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、什么是compose" class="sidebar-link">1、什么是compose</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、作用-2" class="sidebar-link">2、作用</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、安装" class="sidebar-link">3、安装</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_4、compose核心概念" class="sidebar-link">4、Compose核心概念</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_5、compose使用的三个步骤" class="sidebar-link">5、Compose使用的三个步骤</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_6、compose常用命令" class="sidebar-link">6、Compose常用命令</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_7、compose编排微服务" class="sidebar-link">7、Compose编排微服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_14、docker轻量级可视化工具portainer" class="sidebar-link">14、Docker轻量级可视化工具Portainer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、安装" class="sidebar-link">1、安装</a></li></ul></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_15、docker容器监控之cadvisor-influxdb-granfana" class="sidebar-link">15、Docker容器监控之CAdvisor+InfluxDB+Granfana</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_1、原生监控" class="sidebar-link">1、原生监控</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_2、容器监控三剑客" class="sidebar-link">2、容器监控三剑客</a></li><li class="sidebar-sub-header"><a href="/notes/frame/Docker.html#_3、compose容器编排安装" class="sidebar-link">3、compose容器编排安装</a></li></ul></li></ul></li><li><a href="/notes/frame/RabbitMQ.html" class="sidebar-link">RabbitMQ</a></li><li><a href="/notes/frame/Elasticsearch.html" class="sidebar-link">Elasticsearch</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>组件篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/notes/components/CAT.html" class="sidebar-link">CAT链路追踪</a></li><li><a href="/notes/components/HATEOAS.html" class="sidebar-link">HATEOAS</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1、docker简介"><a href="#_1、docker简介" class="header-anchor">#</a> 1、Docker简介</h2> <h3 id="_1、docker为何会出现"><a href="#_1、docker为何会出现" class="header-anchor">#</a> 1、Docker为何会出现</h3> <h4 id="_1、引出docker"><a href="#_1、引出docker" class="header-anchor">#</a> 1、引出Docker</h4> <blockquote><p>假定您在开发一个尚硅谷的谷粒商城，您使用的是一台笔记本电脑而且您的开发环境具有特定的配置。其他开发人员身处的环境配置也各有不同。您正在开发的应用依赖于您当前的配置且还要依赖于某些配置文件。此外，您的企业还拥有标准化的测试和生产环境，且具有自身的配置和一系列支持文件。您希望尽可能多在本地模拟这些环境而不产生重新创建服务器环境的开销。</p> <p>请问？
您要如何确保应用能够在这些环境中运行和通过质量检测？并且在部署过程中不出现令人头疼的版本、配置问题，也无需重新编写代码和进行故障修复？</p></blockquote> <p><strong>答案</strong>：使用容器。Docker之所以发展如此迅速，也是因为它对此给出了一个标准化的解决方案-----系统平滑移植，容器虚拟化技术。</p> <p>环境配置相当麻烦，换一台机器，就要重来一次，费力费时。很多人想到，能不能从根本上解决问题，软件可以带环境安装？也就是说，<strong>安装的时候，把原始环境一模一样地复制过来。开发人员利用 Docker 可以消除协作编码时“在我的机器上可正常工作”的问题</strong>。</p> <p><img src="/assets/img/image-20220409144827717.57a6df39.png" alt="image-20220409144827717"></p> <p>之前在服务器配置一个应用的运行环境，要安装各种软件，就拿尚硅谷电商项目的环境来说，Java/RabbitMQ/MySQL/JDBC驱动包等。安装和配置这些东西有多麻烦就不说了，它还不能跨平台。假如我们是在 Windows 上安装的这些环境，到了 Linux 又得重新装。况且就算不跨操作系统，换另一台同样操作系统的服务器，要移植应用也是非常麻烦的。</p> <blockquote><p>传统上认为，软件编码开发/测试结束后，所产出的成果即是程序或是能够编译执行的二进制字节码等(java为例)。而为了让这些程序可以顺利执行，开发团队也得准备完整的部署文件，让维运团队得以部署应用程式，开发需要清楚的告诉运维部署团队，用的全部配置文件+所有软件环境。不过，即便如此，仍然常常发生部署失败的状况。==Docker的出现使得Docker得以打破过去「程序即应用」的观念。透过镜像(../images)将作业系统核心除外，运作应用程式所需要的系统环境，由下而上打包，达到应用程式跨平台间的无缝接轨运作。==</p></blockquote> <h4 id="_2、什么是docker"><a href="#_2、什么是docker" class="header-anchor">#</a> 2、什么是Docker</h4> <blockquote><p>Docker是基于Go语言实现的云开源项目。
Docker的主要目标是“Build，Ship and Run Any App,Anywhere”，也就是通过对应用组件的封装、分发、部署、运行等生命周期的管理，使用户的APP（可以是一个WEB应用或数据库应用等等）及其运行环境能够做到“一次镜像，处处运行”。</p></blockquote> <p><img src="/assets/img/image-20220409145223100.7def26bf.png" alt="image-20220409145223100"></p> <p>Linux容器技术的出现就解决了这样一个问题，而 Docker 就是在它的基础上发展过来的。将应用打成镜像，通过镜像成为运行在Docker容器上面的实例，而 Docker容器在任何操作系统上都是一致的，这就实现了跨平台、跨服务器。</p> <p>只需要一次配置好环境，换到别的机子上就可以一键部署好，大大简化了操作。</p> <h4 id="_3、总结"><a href="#_3、总结" class="header-anchor">#</a> 3、总结</h4> <blockquote><p>Docker解决了运行环境和配置问题的软件容器，方便做持续集成并有助于整体发布的容器虚拟化技术。</p></blockquote> <h3 id="_2、容器与虚拟机的比较"><a href="#_2、容器与虚拟机的比较" class="header-anchor">#</a> 2、容器与虚拟机的比较</h3> <h4 id="_1、容器的发展史"><a href="#_1、容器的发展史" class="header-anchor">#</a> 1、容器的发展史</h4> <p>具体资讯参考：https://developer.aliyun.com/article/775778</p> <p><img src="/assets/img/image-20220409145447661.24732267.png" alt="image-20220409145447661"></p> <h4 id="_2、传统虚拟机技术"><a href="#_2、传统虚拟机技术" class="header-anchor">#</a> 2、传统虚拟机技术</h4> <blockquote><p>虚拟机（virtual machine）就是带环境安装的一种解决方案。
它可以在一种操作系统里面运行另一种操作系统，比如在Windows10系统里面运行Linux系统CentOS7。应用程序对此毫无感知，因为虚拟机看上去跟真实系统一模一样，而对于底层系统来说，虚拟机就是一个普通文件，不需要了就删掉，对其他部分毫无影响。这类虚拟机完美的运行了另一套系统，能够使应用程序，操作系统和硬件三者之间的逻辑不变。</p></blockquote> <p><img src="data:image/png;base64,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rHKCwAJyVosN3eEhcwz2ZSQOU0biWPZH5VDJdaCAl4jID6Ngl4iIiIiIfIrl2hxzn/I9U7q03YB1UQ1uNMtPrDWnjHVZkMGGNqe4Vs5qN2QeW+RRj/fdkHkcYJGz2k2Yr5uGJBpmC3Ach+HbcQwjO0LGwWl5ez9lwRuuawEubnHIJBMRkasRxGsAAAOfSURBVJ9GszGKiIiIiMgnnUJL+WrB5hWrzFcsGPJ2FbXKMdGKdlxmWmW7DZvt8Sne4ubaW3k0hcmcYf1Bs4SJMrZERH4rBbtEREREROSLDLPRBtiy9Hv0/Ij8U+vJid5HbLqQGYPZb2G7xxiD37PpL+BsvsTNrhxGeau2Vh4xY36sCXZ8j33z8EkREfkdNIxRRERERES+JI+mJJ6Hl8AgHtPp2dh+m2LwwQurYNUpUGURrDPecquaVXEJ3Tau6+K6xdWwQs/rsM/BbY50Ea3axFWNrtPDGe23B7O67k3vKCIi35aCXSIiIiIi8gWG2aJLuh6wTJaARTAP2a2qHKztvpo18XI2xt2N9VkPxJdy9ltgCBfRsjNvwY30rcxgsvOHzgvUAyyZ9hPwUtax0sBERH4SBbtEREREROTTyppYa1wMx3L0VkAcQB5toTvAdZtnY5yObgW8arZ7omjJbtdhMH7DtSwgY7fxGKzbLH0DblMw6sbQRsttzAQ7L1APZZF6lagXEfmJFOwSEREREZHPqdfEyvdsgfrIRettThbcSLuyAtZF0zpzTLZiOV2w3WzACXkLYoL6MmZJ4nQY4zKgR5S73HobERH571GBehERERER+QRTq4l1w63C8TdX6dOybaZLGMzXrFMPuu2LdeRE0wSvmk3RHXRZzMxnPsCZbPeSuSRFROQbUGaXiIiIiIh8gksQfLzUc6sck2XxqWZX1rCMmTHqphSHkYvugG5/SjRWdpeIiJSU2SUiIiIiIt/EB8Xp84jeFNKzgvEu4xBGdo8ov/lKYMOuKXgmIiK/joJdIiIiIiLyF2R8aqTgdk8OkBv8GczXMZfl6K1gTuhsGNkter7hbsxLRER+PQ1jFBERERGRl+h6Hex7Czhd2k+u0xm2wUREvBHHTbMuAlgE65S2sWuzKdZlgMfg/sbRfXbjRETkW2oVRXE2B0qr1eLiIRH5AdR3RX4m9V35r1LbF5F/QfsekZ/nM/1WwxhFREREREREROTXULBLRERERERERER+DQW7RERERERERETk11CwS0REREREREREfg0Fu0RERERERERE5NdQsEtERERERERERH4NBbtEREREREREROTXULBLRERERERERER+jVZRFMXZA63Wv9oWERERERERERGRMxehqw/976srEBERERERERER+S40jFFERERERERERH4NBbtEREREREREROTXULBLRERERERERER+jf8HkZcMafZ0qGkAAAAASUVORK5CYII=" alt="image-20220409145706034"></p> <p><img src="/assets/img/image-20220409145847773.a685fab9.png" alt="image-20220409145847773"></p> <p><img src="/assets/img/image-20220409145751579.de2ba531.png" alt="image-20220409145751579"></p> <p>虚拟机的缺点：</p> <ul><li>占用资源多</li> <li>冗余步骤多</li> <li>启动速度慢</li></ul> <h4 id="_3、容器虚拟化技术"><a href="#_3、容器虚拟化技术" class="header-anchor">#</a> 3、容器虚拟化技术</h4> <p>由于前面虚拟机存在某些缺点，Linux发展出了另一种虚拟化技术：</p> <h5 id="linux容器-linux-containers-缩写为-lxc"><a href="#linux容器-linux-containers-缩写为-lxc" class="header-anchor">#</a> Linux容器(Linux Containers，缩写为 LXC)</h5> <blockquote><p>Linux容器是与系统其他部分隔离开的一系列进程，从另一个镜像运行，并由该镜像提供支持进程所需的全部文件。容器提供的镜像包含了应用的所有依赖项，因而在从开发到测试再到生产的整个过程中，它都具有可移植性和一致性。</p></blockquote> <p><strong>Linux 容器不是模拟一个完整的操作系统而是对进程进行隔离</strong>。有了容器，就可以将软件运行所需的所有资源打包到一个隔离的容器中。容器与虚拟机不同，不需要捆绑一整套操作系统，只需要软件工作所需的库资源和设置。系统因此而变得高效轻量并保证部署在任何环境中的软件都能始终如一地运行。</p> <p><img src="/assets/img/image-20220409150112432.49ef2036.png" alt="image-20220409150112432"></p> <p>Docker容器则是在操作系统层面上实现虚拟化，直接复用本地主机的操作系统，而传统虚拟机则是在硬件层面上实现虚拟化，<strong>与传统的虚拟机相比，Docker优势体现为启动速度快，占用内存小。</strong></p> <h4 id="_4、区别"><a href="#_4、区别" class="header-anchor">#</a> 4、区别</h4> <p>Docker 和传统虚拟化方式的不同之处：</p> <ul><li>传统虚拟机技术是虚拟出一套硬件后，在其上运行一个完整操作系统，在该系统上再运行所需应用进程；</li> <li>容器内的应用进程直接运行于宿主的内核，容器内没有自己的内核且也没有进行硬件虚拟。因此容器要比传统虚拟机更为轻便。</li> <li>每个容器之间互相隔离，每个容器有自己的文件系统 ，容器之间进程不会相互影响，能区分计算资源。</li></ul> <h3 id="_3、学习的用处"><a href="#_3、学习的用处" class="header-anchor">#</a> 3、学习的用处</h3> <h4 id="_1、职场的变化"><a href="#_1、职场的变化" class="header-anchor">#</a> 1、职场的变化</h4> <p>coder -&gt; programmer -&gt; software engineer -&gt; DevOps engineer</p> <h4 id="_2、一次构建-随处运行"><a href="#_2、一次构建-随处运行" class="header-anchor">#</a> 2、一次构建，随处运行</h4> <ul><li>更快速的应用交付和部署</li></ul> <blockquote><p>传统的应用开发完成后，需要提供一堆安装程序和配置说明文档，安装部署后需根据配置文档进行繁杂的配置才能正常运行。Docker化之后只需要交付少量容器镜像文件，在正式生产环境加载镜像并运行即可，应用安装配置在镜像里已经内置好，大大节省部署配置和测试验证时间。</p></blockquote> <ul><li>更便捷的升级和扩缩容</li></ul> <blockquote><p>随着微服务架构和Docker的发展，大量的应用会通过微服务方式架构，应用的开发构建将变成搭乐高积木一样，每个Docker容器将变成一块“积木”，应用的升级将变得非常容易。当现有的容器不足以支撑业务处理时，可通过镜像运行新的容器进行快速扩容，使应用系统的扩容从原先的天级变成分钟级甚至秒级。</p></blockquote> <ul><li>更简单的系统运维</li></ul> <blockquote><p>应用容器化运行后，生产环境运行的应用可与开发、测试环境的应用高度一致，容器会将应用程序相关的环境和状态完全封装起来，不会因为底层基础架构和操作系统的不一致性给应用带来影响，产生新的BUG。当出现程序异常时，也可以通过测试环境的相同容器进行快速定位和修复。</p></blockquote> <ul><li>更高效的计算资源利用</li></ul> <blockquote><p>Docker是内核级虚拟化，其不像传统的虚拟化技术一样需要额外的Hypervisor支持，所以在一台物理机上可以运行很多个容器实例，可大大提升物理服务器的CPU和内存的利用率。</p></blockquote> <h4 id="_3、docker应用场景"><a href="#_3、docker应用场景" class="header-anchor">#</a> 3、Docker应用场景</h4> <p><img src="/assets/img/image-20220409151623790.eb7e8796.png" alt="image-20220409151623790"></p> <h3 id="_4、官网地址"><a href="#_4、官网地址" class="header-anchor">#</a> 4、官网地址</h3> <p>官网：docker官网：http://www.docker.com</p> <p>仓库：Docker Hub官网: https://hub.docker.com/</p> <h2 id="_2、docker安装"><a href="#_2、docker安装" class="header-anchor">#</a> 2、Docker安装</h2> <h3 id="_1、前提说明"><a href="#_1、前提说明" class="header-anchor">#</a> 1、前提说明</h3> <p><img src="/assets/img/image-20220409163721410.c1040a6a.png" alt="image-20220409163721410"></p> <h4 id="_1、前提条件"><a href="#_1、前提条件" class="header-anchor">#</a> 1、前提条件</h4> <p>目前，CentOS 仅发行版本中的内核支持 Docker。Docker 运行在CentOS 7 (64-bit)上，要求系统为64位、Linux系统内核版本为 3.8以上，这里选用Centos7.x</p> <h4 id="_2、查看自己内核"><a href="#_2、查看自己内核" class="header-anchor">#</a> 2、查看自己内核</h4> <p>uname命令用于打印当前系统相关信息（内核版本号、硬件架构、主机名称和操作系统类型等）。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## cat /etc/redhat-release </span>
CentOS Linux release <span class="token number">7.8</span>.2003 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## uname -r</span>
<span class="token number">3.10</span>.0-1127.el7.x86_64
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2、docker的组成"><a href="#_2、docker的组成" class="header-anchor">#</a> 2、Docker的组成</h3> <h4 id="_1、镜像image"><a href="#_1、镜像image" class="header-anchor">#</a> 1、镜像<code>image</code></h4> <blockquote><p>Docker 镜像（Image）就是一个只读的模板。镜像可以用来创建 Docker 容器，一个镜像可以创建很多容器。它也相当于是一个root文件系统。</p> <p>比如官方镜像 centos:7 就包含了完整的一套 centos:7 最小系统的 root 文件系统。</p> <p>相当于容器的“源代码”，docker镜像文件类似于Java的类模板，而docker容器实例类似于java中new出来的实例对象。</p></blockquote> <p><img src="data:image/png;base64,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" alt="image-20220409164025440"></p> <h4 id="_2、容器container"><a href="#_2、容器container" class="header-anchor">#</a> 2、容器<code>container</code></h4> <h5 id="_1、从面向对象角度看"><a href="#_1、从面向对象角度看" class="header-anchor">#</a> 1、从面向对象角度看</h5> <blockquote><p>Docker 利用容器（Container）独立运行的一个或一组应用，应用程序或服务运行在容器里面，容器就类似于一个虚拟化的运行环境，容器是用镜像创建的运行实例。就像是Java中的类和实例对象一样，镜像是静态的定义，容器是镜像运行时的实体。容器为镜像提供了一个标准的和隔离的运行环境，它可以被启动、开始、停止、删除。每个容器都是相互隔离的、保证安全的平台</p></blockquote> <h5 id="_2、从容器角度看"><a href="#_2、从容器角度看" class="header-anchor">#</a> 2、从容器角度看</h5> <blockquote><p>可以把容器看做是一个简易版的 Linux 环境（包括root用户权限、进程空间、用户空间和网络空间等）和运行在其中的应用程序。</p></blockquote> <h4 id="_3、仓库repository"><a href="#_3、仓库repository" class="header-anchor">#</a> 3、仓库<code>repository</code></h4> <blockquote><p>仓库（Repository）是集中存放镜像文件的场所。</p></blockquote> <p>类似于
Maven仓库，存放各种jar包的地方；
github仓库，存放各种git项目的地方；
Docker公司提供的官方registry被称为Docker Hub，存放各种镜像模板的地方。</p> <p>仓库分为公开仓库（Public）和私有仓库（Private）两种形式。最大的公开仓库是 Docker Hub(https://hub.docker.com/)，
存放了数量庞大的镜像供用户下载。国内的公开仓库包括阿里云 、网易云等</p> <h4 id="_4、总结"><a href="#_4、总结" class="header-anchor">#</a> 4、总结</h4> <p>需要正确的理解仓库/镜像/容器这几个概念:</p> <blockquote><p>Docker 本身是一个容器运行载体或称之为管理引擎。我们把应用程序和配置依赖打包好形成一个可交付的运行环境，这个打包好的运行环境就是image镜像文件。只有通过这个镜像文件才能生成Docker容器实例(类似Java中new出来一个对象)。</p> <p>image文件可以看作是容器的模板。Docker 根据 image 文件生成容器的实例。同一个 image 文件，可以生成多个同时运行的容器实例。</p> <ul><li>镜像文件</li></ul> <p>image 文件生成的容器实例，本身也是一个文件，称为镜像文件。</p> <ul><li>容器实例</li></ul> <p>一个容器运行一种服务，当我们需要的时候，就可以通过docker客户端创建一个对应的运行实例，也就是我们的容器</p> <ul><li>仓库</li></ul> <p>就是放一堆镜像的地方，我们可以把镜像发布到仓库中，需要的时候再从仓库中拉下来就可以了。</p></blockquote> <h3 id="_3、整体架构及底层原理"><a href="#_3、整体架构及底层原理" class="header-anchor">#</a> 3、整体架构及底层原理</h3> <blockquote><p>Docker 是一个 C/S 模式的架构，后端是一个松耦合架构，众多模块各司其职。</p></blockquote> <p><img src="/assets/img/image-20220409200835163.b5e59819.png" alt="image-20220409200835163"></p> <p><img src="/assets/img/image-20220409200845747.02fd2ae1.png" alt="image-20220409200845747"></p> <h3 id="_4、docker安装"><a href="#_4、docker安装" class="header-anchor">#</a> 4、Docker安装</h3> <blockquote><p>官方安装地址：https://docs.docker.com/engine/install/centos/</p> <p>个人总结安装地址：http://xiao_bear.gitee.io/javaxiaobear/install/linux.html#_1%E3%80%81linux%E5%AE%89%E8%A3%85docker</p></blockquote> <h4 id="_1、卸载系统之前的docker"><a href="#_1、卸载系统之前的docker" class="header-anchor">#</a> 1、卸载系统之前的docker</h4> <div class="language-text line-numbers-mode"><pre class="language-text"><code>sudo yum remove docker \
docker-client \
docker-client-latest \
docker-common \
docker-latest \
docker-latest-logrotate \
docker-logrotate \
docker-engine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_2、yum安装gcc相关"><a href="#_2、yum安装gcc相关" class="header-anchor">#</a> 2、yum安装gcc相关</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> -y gcc gcc-c++
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3、安装需要的软件包"><a href="#_3、安装需要的软件包" class="header-anchor">#</a> 3、安装需要的软件包</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> -y yum-utils
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4、设置stable镜像仓库"><a href="#_4、设置stable镜像仓库" class="header-anchor">#</a> 4、设置stable镜像仓库</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>最好使用阿里云镜像,国外下载速度慢
官方镜像：yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
阿里云镜像：yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span>
已加载插件：fastestmirror, langpacks
adding repo from: http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
grabbing <span class="token function">file</span> http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo
repo saved to /etc/yum.repos.d/docker-ce.repo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_5、更新yum软件包索引"><a href="#_5、更新yum软件包索引" class="header-anchor">#</a> 5、更新yum软件包索引</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum makecache fast
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_6、安装docker-ce"><a href="#_6、安装docker-ce" class="header-anchor">#</a> 6、安装DOCKER CE</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum -y <span class="token function">install</span> docker-ce docker-ce-cli containerd.io
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_7、启动docker"><a href="#_7、启动docker" class="header-anchor">#</a> 7、启动docker</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl start <span class="token function">docker</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_8、测试"><a href="#_8、测试" class="header-anchor">#</a> 8、测试</h4> <p>查看docker版本</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>永远的hello-world：没有找到镜像，会自动拉去镜像下载</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run hello-world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run hello-world</span>
Unable to <span class="token function">find</span> image <span class="token string">'hello-world:latest'</span> locally
latest: Pulling from library/hello-world
2db29710123e: Pull complete 
Digest: sha256:bfea6278a0a267fad2634554f4f0c6f31981eea41c553fdf5a83e95a41d40c38
Status: Downloaded newer image <span class="token keyword">for</span> hello-world:latest

Hello from Docker<span class="token operator">!</span>
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 <span class="token number">1</span>. The Docker client contacted the Docker daemon.
 <span class="token number">2</span>. The Docker daemon pulled the <span class="token string">&quot;hello-world&quot;</span> image from the Docker Hub.
    <span class="token punctuation">(</span>amd64<span class="token punctuation">)</span>
 <span class="token number">3</span>. The Docker daemon created a new container from that image <span class="token function">which</span> runs the
    executable that produces the output you are currently reading.
 <span class="token number">4</span>. The Docker daemon streamed that output to the Docker client, <span class="token function">which</span> sent it
    to your terminal.

To try something <span class="token function">more</span> ambitious, you can run an Ubuntu container with:
 $ <span class="token function">docker</span> run -it ubuntu <span class="token function">bash</span>

Share <span class="token punctuation">..</span>/images, automate workflows, and <span class="token function">more</span> with a <span class="token function">free</span> Docker ID:
 https://hub.docker.com/

For <span class="token function">more</span> examples and ideas, visit:
 https://docs.docker.com/get-started/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="_9、卸载"><a href="#_9、卸载" class="header-anchor">#</a> 9、卸载</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>停止docker
systemctl stop <span class="token function">docker</span>

移除docker组件
yum remove docker-ce docker-ce-cli containerd.io

<span class="token function">rm</span> -rf /var/lib/docker

<span class="token function">rm</span> -rf /var/lib/containerd
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_5、阿里云加速镜像"><a href="#_5、阿里云加速镜像" class="header-anchor">#</a> 5、阿里云加速镜像</h3> <h4 id="_1、阿里云镜像地址"><a href="#_1、阿里云镜像地址" class="header-anchor">#</a> 1、阿里云镜像地址</h4> <p>https://promotion.aliyun.com/ntms/act/kubernetes.html</p> <h4 id="_2、获得加速器地址连接"><a href="#_2、获得加速器地址连接" class="header-anchor">#</a> 2、获得加速器地址连接</h4> <ul><li><p>登录</p> <p><img src="/assets/img/image-20220409205857761.aa0b4be6.png" alt="image-20220409205857761"></p></li> <li><p>控制台</p> <p><img src="/assets/img/image-20220409205935957.12b5a406.png" alt="image-20220409205935957"></p></li> <li><p>选择容器镜像服务</p> <p><img src="/assets/img/image-20220409205954722.94090177.png" alt="image-20220409205954722"></p></li> <li><p>获取加速器地址</p> <p><img src="/assets/img/image-20220409210009314.9f25e068.png" alt="image-20220409210009314"></p></li> <li><p>运行命名</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#分步骤执行</span>
<span class="token function">mkdir</span> -p /etc/docker
<span class="token function">vim</span>  /etc/docker/daemon.json

 <span class="token comment">#阿里云</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://｛自已的编码｝.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>重启服务器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> systemctl daemon-reload
<span class="token function">sudo</span> systemctl restart <span class="token function">docker</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h3 id="_6、hello-world"><a href="#_6、hello-world" class="header-anchor">#</a> 6、Hello World</h3> <blockquote><p>启动Docker后台容器(测试运行 hello-world)</p></blockquote> <p><img src="/assets/img/image-20220409210405190.1223f0c2.png" alt="image-20220409210405190"></p> <p>PS：输出这段提示以后，hello world就会停止运行，容器自动终止。</p> <h4 id="run的流程"><a href="#run的流程" class="header-anchor">#</a> run的流程</h4> <p><img src="/assets/img/image-20220409210440404.58dd6560.png" alt="image-20220409210440404"></p> <h3 id="_7、底层原理"><a href="#_7、底层原理" class="header-anchor">#</a> 7、底层原理</h3> <h4 id="_1、为什么docker会比虚拟机快"><a href="#_1、为什么docker会比虚拟机快" class="header-anchor">#</a> 1、为什么Docker会比虚拟机快</h4> <ol><li><p>docker有着比虚拟机更少的抽象层</p> <blockquote><p>由于docker不需要Hypervisor(虚拟机)实现硬件资源虚拟化,运行在docker容器上的程序直接使用的都是实际物理机的硬件资源。因此在CPU、内存利用率上docker将会在效率上有明显优势。</p></blockquote></li> <li><p>docker利用的是宿主机的内核,而不需要加载操作系统OS内核</p> <blockquote><p>当新建一个容器时,docker不需要和虚拟机一样重新加载一个操作系统内核。进而避免引寻、加载操作系统内核返回等比较费时费资源的过程,当新建一个虚拟机时,虚拟机软件需要加载OS,返回新建过程是分钟级别的。而docker由于直接利用宿主机的操作系统,则省略了返回过程,因此新建一个docker容器只需要几秒钟。</p></blockquote> <p><img src="/assets/img/image-20220409210622482.cffdca47.png" alt="image-20220409210622482"></p> <p><img src="/assets/img/image-20220409210706973.d78aeff8.png" alt="image-20220409210706973"></p></li></ol> <h2 id="_3、docker常用命令"><a href="#_3、docker常用命令" class="header-anchor">#</a> 3、Docker常用命令</h2> <h3 id="_1、帮助类启动命令"><a href="#_1、帮助类启动命令" class="header-anchor">#</a> 1、帮助类启动命令</h3> <ul><li>启动docker： systemctl start docker</li> <li>停止docker： systemctl stop docker</li> <li>重启docker： systemctl restart docker</li> <li>查看docker状态： systemctl status docker</li> <li>开机启动： systemctl enable docker</li> <li>查看docker概要信息： docker info</li> <li>查看docker总体帮助文档： docker --help</li> <li>查看docker命令帮助文档： docker 具体命令 --help</li></ul> <h3 id="_2、镜像命令"><a href="#_2、镜像命令" class="header-anchor">#</a> 2、镜像命令</h3> <h4 id="_1、列出本地主机上的镜像"><a href="#_1、列出本地主机上的镜像" class="header-anchor">#</a> 1、列出本地主机上的镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token punctuation">..</span>/images
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20220409211128203.dd7c1b46.png" alt="image-20220409211128203"></p> <p>各个选项说明:</p> <ul><li>REPOSITORY：表示镜像的仓库源</li> <li>TAG：镜像的标签版本号</li> <li>IMAGE ID：镜像ID</li> <li>CREATED：镜像创建时间</li> <li>SIZE：镜像大小</li></ul> <blockquote><p>同一仓库源可以有多个 TAG版本，代表这个仓库源的不同个版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。
如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像</p></blockquote> <p>OPTIONS说明：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>-a :列出本地所有的镜像（含历史映像层）
<span class="token function">docker</span> <span class="token punctuation">..</span>/images -a

-q :只显示镜像ID。
<span class="token function">docker</span> <span class="token punctuation">..</span>/images -q
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_2、搜索镜像"><a href="#_2、搜索镜像" class="header-anchor">#</a> 2、搜索镜像</h4> <p>官方搜索网址：https://hub.docker.com/</p> <p>命令</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> search <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> 镜像名字
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker search mysql</span>
NAME                             DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql                            MySQL is a widely used, open-source relation…   <span class="token number">12378</span>     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>       
mariadb                          MariaDB Server is a high performing <span class="token function">open</span> sou…   <span class="token number">4762</span>      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>       
mysql/mysql-server               Optimized MySQL Server Docker <span class="token punctuation">..</span>/images. Create…   <span class="token number">917</span>                  <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
percona                          Percona Server is a fork of the MySQL relati…   <span class="token number">572</span>       <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>       
phpmyadmin                       phpMyAdmin - A web interface <span class="token keyword">for</span> MySQL and M…   <span class="token number">494</span>       <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>       
mysql/mysql-cluster              Experimental MySQL Cluster Docker <span class="token punctuation">..</span>/images. Cr…   <span class="token number">93</span>                   
centos/mysql-57-centos7          MySQL <span class="token number">5.7</span> SQL database server                   <span class="token number">92</span>                   
bitnami/mysql                    Bitnami MySQL Docker Image                      <span class="token number">68</span>                   <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
ubuntu/mysql                     MySQL <span class="token function">open</span> <span class="token builtin class-name">source</span> fast, stable, multi-thread…   <span class="token number">29</span>                   
circleci/mysql                   MySQL is a widely used, open-source relation…   <span class="token number">25</span>                   
mysql/mysql-router               MySQL Router provides transparent routing be…   <span class="token number">23</span>                   
centos/mysql-56-centos7          MySQL <span class="token number">5.6</span> SQL database server                   <span class="token number">22</span>                   
google/mysql                     MySQL server <span class="token keyword">for</span> Google Compute Engine          <span class="token number">21</span>                   <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
vmware/harbor-db                 Mysql container <span class="token keyword">for</span> Harbor                      <span class="token number">10</span>                   
mysqlboy/docker-mydumper         docker-mydumper containerizes MySQL logical …   <span class="token number">3</span>                    
mysqlboy/mydumper                mydumper <span class="token keyword">for</span> mysql logcial backups              <span class="token number">3</span>                    
bitnami/mysqld-exporter                                                          <span class="token number">2</span>                    
ibmcom/mysql-s390x               Docker image <span class="token keyword">for</span> mysql-s390x                    <span class="token number">2</span>                    
mysql/mysql-operator             MySQL Operator <span class="token keyword">for</span> Kubernetes                   <span class="token number">0</span>                    
ibmcom/tidb-ppc64le              TiDB is a distributed NewSQL database compat…   <span class="token number">0</span>                    
mysqlboy/elasticsearch                                                           <span class="token number">0</span>                    
mysqleatmydata/mysql-eatmydata                                                   <span class="token number">0</span>                    
cimg/mysql                                                                       <span class="token number">0</span>                    
mysql/ndb-operator               MySQL NDB Operator <span class="token keyword">for</span> Kubernetes               <span class="token number">0</span>                    
mirantis/mysql  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p><img src="/assets/img/image-20220409211628931.83ea8e79.png" alt="image-20220409211628931"></p> <h5 id="options说明"><a href="#options说明" class="header-anchor">#</a> OPTIONS说明：</h5> <ul><li>--limit : 只列出N个镜像，默认25个</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> search --limit <span class="token number">5</span> redis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3、拉取-下载-镜像"><a href="#_3、拉取-下载-镜像" class="header-anchor">#</a> 3、拉取（下载）镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> pull 某个XXX镜像名字
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>docker pull 某个XXX镜像名字[:TAG]</p></li> <li><p>docker pull 镜像名字</p> <blockquote><ul><li>没有TAG就是最新版</li> <li>等价于：docker pull 镜像名字:latest</li></ul></blockquote></li></ul> <h4 id="_4、查看镜像"><a href="#_4、查看镜像" class="header-anchor">#</a> 4、查看镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> system <span class="token function">df</span> 查看镜像/容器/数据卷所占的空间
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker system df</span>
TYPE            TOTAL     ACTIVE    SIZE      RECLAIMABLE
<span class="token punctuation">..</span>/images          <span class="token number">1</span>         <span class="token number">1</span>         <span class="token number">13</span>.26kB   0B <span class="token punctuation">(</span><span class="token number">0</span>%<span class="token punctuation">)</span>
Containers      <span class="token number">1</span>         <span class="token number">0</span>         0B        0B
Local Volumes   <span class="token number">0</span>         <span class="token number">0</span>         0B        0B
Build Cache     <span class="token number">0</span>         <span class="token number">0</span>         0B        0B
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_5、删除镜像"><a href="#_5、删除镜像" class="header-anchor">#</a> 5、删除镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> rmi 某个XXX镜像名字ID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_1、删除单个"><a href="#_1、删除单个" class="header-anchor">#</a> 1、删除单个</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> rmi  -f 镜像ID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_2、删除多个"><a href="#_2、删除多个" class="header-anchor">#</a> 2、删除多个</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> rmi -f 镜像名1:TAG 镜像名2:TAG 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3、删除全部"><a href="#_3、删除全部" class="header-anchor">#</a> 3、删除全部</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> rmi -f <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token punctuation">..</span>/images -qa<span class="token variable">)</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_6、面试题-谈谈docker虚悬镜像是什么"><a href="#_6、面试题-谈谈docker虚悬镜像是什么" class="header-anchor">#</a> 6、面试题：谈谈docker虚悬镜像是什么？</h4> <blockquote><p>仓库名、标签都是<none>的镜像，俗称虚悬镜像dangling image</none></p></blockquote> <p><img src="/assets/img/image-20220409212552970.f4a054a4.png" alt="image-20220409212552970"></p> <h3 id="_3、容器命令"><a href="#_3、容器命令" class="header-anchor">#</a> 3、容器命令</h3> <blockquote><p>有镜像才能创建容器</p></blockquote> <p><img src="/assets/img/image-20220409224855550.9e451795.png" alt="image-20220409224855550"></p> <p>本次用centos进行演示</p> <h4 id="_1、新建-启动命令"><a href="#_1、新建-启动命令" class="header-anchor">#</a> 1、新建+启动命令</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> IMAGE <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> <span class="token punctuation">[</span>ARG<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>OPTIONS说明（常用）：有些是一个减号，有些是两个减号</p> <p>--name=&quot;容器新名字&quot;       为容器指定一个名称；
-d: 后台运行容器并返回容器ID，也即启动守护式容器(后台运行)；</p> <p>-i：以交互模式运行容器，通常与 -t 同时使用；
-t：为容器重新分配一个伪输入终端，通常与 -i 同时使用；
也即启动交互式容器(前台有伪终端，等待交互)；</p> <p>-P: 随机端口映射，大写P
-p: 指定端口映射，小写p</p> <p><img src="/assets/img/image-20220409231225018.fc415a0c.png" alt="image-20220409231225018"></p> <p><img src="/assets/img/image-20220410154448928.3ec44116.png" alt="image-20220410154448928"></p> <blockquote><p>#使用镜像centos:latest以交互模式启动一个容器,在容器内执行/bin/bash命令。</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -it centos /bin/bash 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>参数说明：
-i: 交互式操作。
-t: 终端。
centos : centos 镜像。
/bin/bash：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。
要退出终端，直接输入 exit:</p> <h4 id="_2、列出当前所有正在运行的容器"><a href="#_2、列出当前所有正在运行的容器" class="header-anchor">#</a> 2、列出当前所有正在运行的容器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">ps</span> <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>OPTIONS说明（常用）：</p> <p>-a :列出当前所有正在运行的容器+历史上运行过的
-l :显示最近创建的容器。
-n：显示最近n个创建的容器。
-q :静默模式，只显示容器编号。</p></blockquote> <h4 id="_3、退出容器"><a href="#_3、退出容器" class="header-anchor">#</a> 3、退出容器</h4> <h5 id="_1、exec退出"><a href="#_1、exec退出" class="header-anchor">#</a> 1、<code>exec</code>退出</h5> <blockquote><p>run进去容器，exit退出，容器停止</p></blockquote> <h5 id="_2、ctrl-p-q"><a href="#_2、ctrl-p-q" class="header-anchor">#</a> 2、<code>ctrl+p+q</code></h5> <blockquote><p>run进去容器，ctrl+p+q退出，容器不停止</p></blockquote> <h4 id="_4、启动已停止运行的容器"><a href="#_4、启动已停止运行的容器" class="header-anchor">#</a> 4、启动已停止运行的容器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> start 容器ID或者容器名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5、重启容器"><a href="#_5、重启容器" class="header-anchor">#</a> 5、重启容器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> restart 容器ID或者容器名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_6、停止容器"><a href="#_6、停止容器" class="header-anchor">#</a> 6、停止容器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> stop 容器ID或者容器名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_7、强制停止容器"><a href="#_7、强制停止容器" class="header-anchor">#</a> 7、强制停止容器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">kill</span> 容器ID或容器名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_8、删除已停止的容器"><a href="#_8、删除已停止的容器" class="header-anchor">#</a> 8、删除已停止的容器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">rm</span> 容器ID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="一次性删除多个容器实例"><a href="#一次性删除多个容器实例" class="header-anchor">#</a> 一次性删除多个容器实例</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">rm</span> -f <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> -a -q<span class="token variable">)</span></span>

<span class="token function">docker</span> <span class="token function">ps</span> -a -q <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">docker</span> <span class="token function">rm</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><code>docker ps -a -q</code>：查询进行的容器ID</p> <h3 id="_4、实操"><a href="#_4、实操" class="header-anchor">#</a> 4、实操</h3> <h4 id="_1、启动守护式容器-后台服务器"><a href="#_1、启动守护式容器-后台服务器" class="header-anchor">#</a> 1、启动守护式容器(后台服务器)</h4> <blockquote><p>在大部分的场景下，我们希望 docker 的服务是在后台运行的，我们可以过 -d 指定容器的后台运行模式。</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d 容器名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>#使用镜像centos:latest以后台模式启动一个容器</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d centos
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>问题：然后docker ps -a 进行查看, 会发现容器已经退出很重要的要说明的一点: Docker容器后台运行,就必须有一个前台进程.容器运行的命令如果不是那些一直挂起的命令（比如运行top，tail），就是会自动退出的。</p> <p>这个是docker的机制问题,比如你的web容器,我们以nginx为例，正常情况下,我们配置启动服务只需要启动响应的service即可。例如service nginx start但是,这样做,nginx为后台进程模式运行,就导致docker前台没有运行的应用,这样的容器后台启动后,会立即自杀因为他觉得他没事可做了.所以，最佳的解决方案是,将你要运行的程序以前台进程的形式运行，常见就是命令行模式，表示我还有交互操作，别中断，O(∩_∩)O哈哈~</p> <h5 id="案例演示"><a href="#案例演示" class="header-anchor">#</a> 案例演示</h5> <blockquote><p>redis 前后台启动演示case（下载一个Redis6.0.8镜像演示）</p></blockquote> <ul><li><p>前台交互式启动</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -it redis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>后台守护式启动</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d redis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <p>PS：启动容器后，先查看容器是否启动正常，往往伴随着<code>docker ps</code></p> <h4 id="_2、查看容器日志"><a href="#_2、查看容器日志" class="header-anchor">#</a> 2、查看容器日志</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> logs 容器ID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>PS：容器ID可省略为前三位</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker ps </span>
CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS      NAMES
94b526c73db2   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">4</span> seconds ago   Up <span class="token number">3</span> seconds   <span class="token number">6379</span>/tcp   admiring_poincare
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker logs 94b</span>
<span class="token number">1</span>:C <span class="token number">10</span> Apr <span class="token number">2022</span> 09:50:03.396 <span class="token comment">## oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span>
<span class="token number">1</span>:C <span class="token number">10</span> Apr <span class="token number">2022</span> 09:50:03.396 <span class="token comment">## Redis version=6.2.6, bits=64, commit=00000000, modified=0, pid=1, just started</span>
<span class="token number">1</span>:C <span class="token number">10</span> Apr <span class="token number">2022</span> 09:50:03.396 <span class="token comment">## Warning: no config file specified, using the default config. In order to specify a config file use redis-server /path/to/redis.conf</span>
<span class="token number">1</span>:M <span class="token number">10</span> Apr <span class="token number">2022</span> 09:50:03.397 * monotonic clock: POSIX clock_gettime
<span class="token number">1</span>:M <span class="token number">10</span> Apr <span class="token number">2022</span> 09:50:03.398 * Running <span class="token assign-left variable">mode</span><span class="token operator">=</span>standalone, <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token number">6379</span>.
<span class="token number">1</span>:M <span class="token number">10</span> Apr <span class="token number">2022</span> 09:50:03.399 <span class="token comment">## WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span>
<span class="token number">1</span>:M <span class="token number">10</span> Apr <span class="token number">2022</span> 09:50:03.399 <span class="token comment">## Server initialized</span>
<span class="token number">1</span>:M <span class="token number">10</span> Apr <span class="token number">2022</span> 09:50:03.399 <span class="token comment">## WARNING overcommit_memory is set to 0! Background save may fail under low memory condition. To fix this issue add 'vm.overcommit_memory = 1' to /etc/sysctl.conf and then reboot or run the command 'sysctl vm.overcommit_memory=1' for this to take effect.</span>
<span class="token number">1</span>:M <span class="token number">10</span> Apr <span class="token number">2022</span> 09:50:03.399 * Ready to accept connections
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_3、查看容器内运行的进程"><a href="#_3、查看容器内运行的进程" class="header-anchor">#</a> 3、查看容器内运行的进程</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">top</span> 容器ID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker top 94b</span>
<span class="token environment constant">UID</span>                 PID                 <span class="token environment constant">PPID</span>                C                   STIME               TTY                 TIME                CMD
polkitd             <span class="token number">35360</span>               <span class="token number">35341</span>               <span class="token number">0</span>                   <span class="token number">17</span>:50               ?                   00:00:00            redis-server *:6379
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_4、查看容器内部细节"><a href="#_4、查看容器内部细节" class="header-anchor">#</a> 4、查看容器内部细节</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> inspect 容器ID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5、进入容器内部"><a href="#_5、进入容器内部" class="header-anchor">#</a> 5、进入容器内部</h4> <h5 id="_1、使用exec进入容器"><a href="#_1、使用exec进入容器" class="header-anchor">#</a> 1、使用<code>exec</code>进入容器</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it 容器ID bashShell
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker exec -it 94b /bin/bash</span>
root@94b526c73db2:/data<span class="token comment">## redis-c</span>
redis-check-aof  redis-check-rdb  redis-cli        
root@94b526c73db2:/data<span class="token comment">## redis-cli </span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span>
PONG
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k1
<span class="token string">&quot;v1&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">exit</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>exec帮助命令</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker exec --help</span>

Usage:  <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> CONTAINER COMMAND <span class="token punctuation">[</span>ARG<span class="token punctuation">..</span>.<span class="token punctuation">]</span>

Run a <span class="token builtin class-name">command</span> <span class="token keyword">in</span> a running container

Options:
  -d, --detach               Detached mode: run <span class="token builtin class-name">command</span> <span class="token keyword">in</span> the background
      --detach-keys string   Override the key sequence <span class="token keyword">for</span> detaching a container
  -e, --env list             Set environment variables
      --env-file list        Read <span class="token keyword">in</span> a <span class="token function">file</span> of environment variables
  -i, --interactive          Keep STDIN <span class="token function">open</span> even <span class="token keyword">if</span> not attached
      --privileged           Give extended privileges to the <span class="token builtin class-name">command</span>
  -t, --tty                  Allocate a pseudo-TTY
  -u, --user string          Username or <span class="token environment constant">UID</span> <span class="token punctuation">(</span>format: <span class="token operator">&lt;</span>name<span class="token operator">|</span>uid<span class="token operator">&gt;</span><span class="token punctuation">[</span>:<span class="token operator">&lt;</span>group<span class="token operator">|</span>gid<span class="token operator">&gt;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  -w, --workdir string       Working directory inside the container
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h5 id="_2、使用attach进入容器"><a href="#_2、使用attach进入容器" class="header-anchor">#</a> 2、使用<code>attach</code>进入容器</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> attach 容器ID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_3、两者的区别"><a href="#_3、两者的区别" class="header-anchor">#</a> 3、两者的区别</h5> <ul><li>attach 直接进入容器启动命令的终端，不会启动新的进程，用exit退出，会导致容器的停止。</li> <li>exec 是在容器中打开新的终端，并且可以启动新的进程，用exit退出，不会导致容器的停止。</li></ul> <p>PS：推荐大家使用<code>docker exec</code> 命令，因为退出容器终端，不会导致容器的停止。</p> <h3 id="_5、从容器内拷贝文件到主机上"><a href="#_5、从容器内拷贝文件到主机上" class="header-anchor">#</a> 5、从容器内拷贝文件到主机上</h3> <blockquote><p>把文件从容器内部复制到主机上</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">cp</span>  容器ID:容器内路径 目的主机路径
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token function">docker</span> <span class="token function">cp</span> 3065f084c80d:a.txt a.txt
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_6、导入和导出容器"><a href="#_6、导入和导出容器" class="header-anchor">#</a> 6、导入和导出容器</h3> <h4 id="_1、导出容器"><a href="#_1、导出容器" class="header-anchor">#</a> 1、导出容器</h4> <blockquote><p>export 导出容器的内容留作为一个tar归档文件[对应import命令]</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">export</span> 容器ID <span class="token operator">&gt;</span> 文件名.tar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker /<span class="token punctuation">]</span><span class="token comment">## docker export 3065f084c80d &gt; centos.tar.gz</span>
<span class="token punctuation">[</span>root@docker /<span class="token punctuation">]</span><span class="token comment">## ll</span>
总用量 <span class="token number">233004</span>
-rw-r--r--.   <span class="token number">1</span> root root         <span class="token number">0</span> <span class="token number">4</span>月  <span class="token number">10</span> <span class="token number">18</span>:16 a.txt
lrwxrwxrwx.   <span class="token number">1</span> root root         <span class="token number">7</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">15</span>:59 bin -<span class="token operator">&gt;</span> usr/bin
dr-xr-xr-x.   <span class="token number">5</span> root root      <span class="token number">4096</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">16</span>:06 boot
-rw-r--r--.   <span class="token number">1</span> root root <span class="token number">238572032</span> <span class="token number">4</span>月  <span class="token number">10</span> <span class="token number">19</span>:04 centos.tar.gz
drwxr-xr-x.  <span class="token number">20</span> root root      <span class="token number">3220</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">16</span>:29 dev
drwxr-xr-x.  <span class="token number">86</span> root root      <span class="token number">8192</span> <span class="token number">4</span>月  <span class="token number">10</span> <span class="token number">11</span>:03 etc
drwxr-xr-x.   <span class="token number">3</span> root root        <span class="token number">22</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">16</span>:05 home
lrwxrwxrwx.   <span class="token number">1</span> root root         <span class="token number">7</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">15</span>:59 lib -<span class="token operator">&gt;</span> usr/lib
lrwxrwxrwx.   <span class="token number">1</span> root root         <span class="token number">9</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">15</span>:59 lib64 -<span class="token operator">&gt;</span> usr/lib64
drwxr-xr-x.   <span class="token number">2</span> root root         <span class="token number">6</span> <span class="token number">4</span>月  <span class="token number">11</span> <span class="token number">2018</span> media
drwxr-xr-x.   <span class="token number">2</span> root root         <span class="token number">6</span> <span class="token number">4</span>月  <span class="token number">11</span> <span class="token number">2018</span> mnt
drwxr-xr-x.   <span class="token number">4</span> root root        <span class="token number">34</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">20</span>:38 opt
dr-xr-xr-x. <span class="token number">124</span> root root         <span class="token number">0</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">16</span>:29 proc
dr-xr-x---.   <span class="token number">5</span> root root       <span class="token number">176</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">20</span>:36 root
drwxr-xr-x.  <span class="token number">31</span> root root       <span class="token number">940</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">21</span>:01 run
lrwxrwxrwx.   <span class="token number">1</span> root root         <span class="token number">8</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">15</span>:59 sbin -<span class="token operator">&gt;</span> usr/sbin
drwxr-xr-x.   <span class="token number">2</span> root root         <span class="token number">6</span> <span class="token number">4</span>月  <span class="token number">11</span> <span class="token number">2018</span> srv
dr-xr-xr-x.  <span class="token number">13</span> root root         <span class="token number">0</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">16</span>:29 sys
drwxrwxrwt.  <span class="token number">13</span> root root      <span class="token number">4096</span> <span class="token number">4</span>月  <span class="token number">10</span> <span class="token number">18</span>:16 tmp
drwxr-xr-x.  <span class="token number">13</span> root root       <span class="token number">155</span> <span class="token number">4</span>月   <span class="token number">9</span> <span class="token number">15</span>:59 usr
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h4 id="_2、导入容器"><a href="#_2、导入容器" class="header-anchor">#</a> 2、导入容器</h4> <blockquote><p>import 从tar包中的内容创建一个新的文件系统再导入为镜像[对应export]</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> 文件名.tar <span class="token operator">|</span> <span class="token function">docker</span> <span class="token function">import</span> - 镜像用户/镜像名:镜像版本号
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker /<span class="token punctuation">]</span><span class="token comment">## cat centos.tar.gz | docker import - xiaobear/centos:8.8</span>
sha256:12e7a58fc36a755fa63a82f78364291de7271c3ade90f2f5581cc50bc2416cb2
<span class="token punctuation">[</span>root@docker /<span class="token punctuation">]</span><span class="token comment">## docker ../images</span>
REPOSITORY        TAG       IMAGE ID       CREATED              SIZE
xiaobear/centos   <span class="token number">8.8</span>       12e7a58fc36a   About a minute ago   231MB
redis             latest    7614ae9453d1   <span class="token number">3</span> months ago         113MB
hello-world       latest    feb5d9fea6a5   <span class="token number">6</span> months ago         <span class="token number">13</span>.3kB
centos            latest    5d0da3dc9764   <span class="token number">6</span> months ago         231MB
<span class="token punctuation">[</span>root@docker /<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_7、常用命令汇总"><a href="#_7、常用命令汇总" class="header-anchor">#</a> 7、常用命令汇总</h3> <p><img src="/assets/img/image-20220410190930000.959c5c54.png" alt="image-20220410190930000"></p> <table><thead><tr><th>命令</th> <th>英文</th> <th>中文</th></tr></thead> <tbody><tr><td>attach</td> <td>Attach to a running container</td> <td>当前 shell 下 attach 连接指定运行镜像</td></tr> <tr><td>build</td> <td>Build an image from a Dockerfile</td> <td>通过 Dockerfile 定制镜像</td></tr> <tr><td>commit</td> <td>Create a new image from a container changes</td> <td>提交当前容器为新的镜像</td></tr> <tr><td>cp</td> <td>Copy files/folders from the containers filesystem to the host path</td> <td>容器中拷贝指定文件或者目录到宿主机中</td></tr> <tr><td>create</td> <td>Create a new container</td> <td>创建一个新的容器，同 run，但不启动容器</td></tr> <tr><td>diff</td> <td>Inspect changes on a container's filesystem</td> <td>查看 docker 容器变化</td></tr> <tr><td>events</td> <td>Get real time events from the server</td> <td>从 docker 服务获取容器实时事件</td></tr> <tr><td>exec</td> <td>Run a command in an existing container</td> <td>在已存在的容器上运行命令</td></tr> <tr><td>export</td> <td>Stream the contents of a container as a tar archive</td> <td>导出容器的内容流作为一个 tar 归档文件[对应 import ]</td></tr> <tr><td>history</td> <td>Show the history of an image</td> <td>展示一个镜像形成历史</td></tr> <tr><td>../images</td> <td>List ../images</td> <td>列出系统当前镜像</td></tr> <tr><td>import</td> <td>Create a new filesystem image from the contents of a tarball</td> <td>从tar包中的内容创建一个新的文件系统映像[对应export]</td></tr> <tr><td>info</td> <td>Display system-wide information</td> <td>显示系统相关信息</td></tr> <tr><td>inspect</td> <td>Return low-level information on a container</td> <td>查看容器详细信息</td></tr> <tr><td>kill</td> <td>Kill a running container</td> <td>kill 指定 docker 容器</td></tr> <tr><td>load</td> <td>Load an image from a tar archive</td> <td>从一个 tar 包中加载一个镜像[对应 save]</td></tr> <tr><td>login</td> <td>Register or Login to the docker registry server</td> <td>注册或者登陆一个 docker 源服务器</td></tr> <tr><td>logout</td> <td>Log out from a Docker registry server</td> <td>从当前 Docker registry 退出</td></tr> <tr><td>logs</td> <td>Fetch the logs of a container</td> <td>输出当前容器日志信息</td></tr> <tr><td>port</td> <td>Lookup the public-facing port which is NAT-ed to PRIVATE_PORT</td> <td>查看映射端口对应的容器内部源端口</td></tr> <tr><td>pause</td> <td>Pause all processes within a container</td> <td>暂停容器</td></tr> <tr><td>ps</td> <td>List containers</td> <td>列出容器列表</td></tr></tbody></table> <h2 id="_4、docker镜像"><a href="#_4、docker镜像" class="header-anchor">#</a> 4、Docker镜像</h2> <h3 id="_1、什么是docker镜像"><a href="#_1、什么是docker镜像" class="header-anchor">#</a> 1、什么是Docker镜像</h3> <blockquote><p>镜像：是一种轻量级、可执行的独立软件包，它包含运行某个软件所需的所有内容，我们把应用程序和配置依赖打包好形成一个可交付的运行环境(包括代码、运行时需要的库、环境变量和配置文件等)，这个打包好的运行环境就是image镜像文件。</p> <p>只有通过这个镜像文件才能生成Docker容器实例(类似Java中new出来一个对象)。</p></blockquote> <h4 id="_1、分层镜像"><a href="#_1、分层镜像" class="header-anchor">#</a> 1、分层镜像</h4> <p><code>docker pull</code>我们拉取镜像的时候，下载的时候就是多线程在下载，一层一层的下载</p> <h4 id="_2、联合文件系统"><a href="#_2、联合文件系统" class="header-anchor">#</a> 2、联合文件系统</h4> <blockquote><p>UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p></blockquote> <p><strong>特性</strong>：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p> <h4 id="_3、镜像加速的原理"><a href="#_3、镜像加速的原理" class="header-anchor">#</a> 3、镜像加速的原理</h4> <p><img src="/assets/img/image-20220410204502597.d6ad2da9.png" alt="image-20220410204502597"></p> <blockquote><p>平时我们安装进虚拟机的CentOS都是好几个G，为什么docker这里才200M？？</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker /<span class="token punctuation">]</span><span class="token comment">## docker ../images centos</span>
REPOSITORY   TAG       IMAGE ID       CREATED        SIZE
centos       latest    5d0da3dc9764   <span class="token number">6</span> months ago   231MB
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>对于一个精简的OS，rootfs可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供 rootfs 就行了。由此可见对于不同的linux发行版, bootfs基本是一致的, rootfs会有差别, 因此不同的发行版可以公用bootfs。</p> <h4 id="_4、docker为什么采用分层镜像"><a href="#_4、docker为什么采用分层镜像" class="header-anchor">#</a> 4、Docker为什么采用分层镜像</h4> <blockquote><p><strong>镜像分层最大的一个好处就是共享资源，方便复制迁移，就是为了复用</strong>。</p> <p>比如说有多个镜像都从相同的 base 镜像构建而来，那么 Docker Host 只需在磁盘上保存一份 base 镜像；同时内存中也只需加载一份 base 镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。</p></blockquote> <h3 id="_2、理解"><a href="#_2、理解" class="header-anchor">#</a> 2、理解</h3> <blockquote><p>Docker镜像层都是只读的，容器层是可写的
当容器启动时，一个新的可写层被加载到镜像的顶部。
这一层通常被称作“容器层”，“容器层”之下的都叫“镜像层”。</p></blockquote> <p>所有对容器的改动 - 无论添加、删除、还是修改文件都只会发生在容器层中。只有容器层是可写的，容器层下面的所有镜像层都是只读的。</p> <p><img src="/assets/img/image-20220410205151462.3b219582.png" alt="image-20220410205151462"></p> <h3 id="_3、commit操作"><a href="#_3、commit操作" class="header-anchor">#</a> 3、<code>commit</code>操作</h3> <blockquote><p>docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 要创建的目标镜像名:[标签名]</p> <p>docker commit提交容器副本使之成为一个新的镜像</p></blockquote> <h5 id="案例演示-2"><a href="#案例演示-2" class="header-anchor">#</a> 案例演示</h5> <h5 id="_1、启动centos容器"><a href="#_1、启动centos容器" class="header-anchor">#</a> 1、启动centos容器</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker /<span class="token punctuation">]</span><span class="token comment">## docker run -it centos /bin/bash</span>
<span class="token punctuation">[</span>root@c7f841ff540c /<span class="token punctuation">]</span><span class="token comment">## vim a.txt</span>
bash: vim: <span class="token builtin class-name">command</span> not found
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="_2、安装vim"><a href="#_2、安装vim" class="header-anchor">#</a> 2、安装Vim</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@c7f841ff540c /<span class="token punctuation">]</span><span class="token comment">## yum update</span>
Failed to <span class="token builtin class-name">set</span> locale, defaulting to C.UTF-8
CentOS Linux <span class="token number">8</span> - AppStream                                                                            <span class="token number">54</span>  B/s <span class="token operator">|</span>  <span class="token number">38</span>  B     00:00    
Error: Failed to download metadata <span class="token keyword">for</span> repo <span class="token string">'appstream'</span><span class="token builtin class-name">:</span> Cannot prepare internal mirrorlist: No URLs <span class="token keyword">in</span> mirrorlist
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>失败原因：</p> <p>在2022年1月31日，CentOS团队终于从官方镜像中移除CentOS 8的所有包。</p> <p>CentOS 8已于2021年12月31日寿终正非，但软件包仍在官方镜像上保留了一段时间。现在他们被转移到<a href="https://vault.centos.org/" target="_blank" rel="noopener noreferrer">https://vault.centos.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>解决方法</strong></p> <p>如果你仍然需要运行CentOS 8，你可以在/etc/yum.repos.d中更新一下源。使用<a href="http://vault.centos.org/" target="_blank" rel="noopener noreferrer">vault.centos.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>代替<a href="http://mirror.centos.org/" target="_blank" rel="noopener noreferrer">mirror.centos.org<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sed</span> -i -e <span class="token string">&quot;s|mirrorlist=|#mirrorlist=|g&quot;</span> /etc/yum.repos.d/CentOS-*
<span class="token function">sed</span> -i -e <span class="token string">&quot;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&quot;</span> /etc/yum.repos.d/CentOS-*
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> -y <span class="token function">vim</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_3、提交新镜像"><a href="#_3、提交新镜像" class="header-anchor">#</a> 3、提交新镜像</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> commit <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> 容器ID <span class="token punctuation">[</span>REPOSITORY<span class="token punctuation">[</span>:TAG<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker /<span class="token punctuation">]</span><span class="token comment">## docker commit -m=&quot;add vim cmd&quot; -a=&quot;xiaobear&quot; c7f841ff540c centos1:1.0</span>
sha256:08f93c12227128eef1e61d0c064ad1b74f903e4102071528a798389980e69608
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="_4、测试"><a href="#_4、测试" class="header-anchor">#</a> 4、测试</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker /<span class="token punctuation">]</span><span class="token comment">## docker run -it centos1:1.0 /bin/bash</span>
<span class="token punctuation">[</span>root@80c4d3b1ea3b /<span class="token punctuation">]</span><span class="token comment">## vim xiaobear.txt</span>
<span class="token punctuation">[</span>root@80c4d3b1ea3b /<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>官网是默认下载的centos没有vim命令
我们自己commit构建的镜像，新增加了vim功能，可以成功使用。</p> <h3 id="_4、总结-2"><a href="#_4、总结-2" class="header-anchor">#</a> 4、总结</h3> <blockquote><p>Docker中的镜像分层，支持通过扩展现有镜像，创建新的镜像。类似Java继承于一个Base基础类，自己再按需扩展。
新镜像是从 base 镜像一层一层叠加生成的。每安装一个软件，就在现有镜像的基础上增加一层</p></blockquote> <p><img src="/assets/img/image-20220410215157180.45f78c31.png" alt="image-20220410215157180"></p> <h2 id="_5、本地镜像上传至阿里云"><a href="#_5、本地镜像上传至阿里云" class="header-anchor">#</a> 5、本地镜像上传至阿里云</h2> <p><img src="/assets/img/image-20220410220217273.70981f70.png" alt="image-20220410220217273"></p> <h3 id="_1、镜像的生成方法"><a href="#_1、镜像的生成方法" class="header-anchor">#</a> 1、镜像的生成方法</h3> <blockquote><ul><li><p>基于当前容器创建一个新的镜像，新功能增强</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> commit <span class="token punctuation">[</span>OPTIONS<span class="token punctuation">]</span> 容器ID <span class="token punctuation">[</span>REPOSITORY<span class="token punctuation">[</span>:TAG<span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>DockerFile</p></li></ul></blockquote> <h3 id="_2、本地推送到阿里云"><a href="#_2、本地推送到阿里云" class="header-anchor">#</a> 2、本地推送到阿里云</h3> <h4 id="_1、阿里云开发者平台"><a href="#_1、阿里云开发者平台" class="header-anchor">#</a> 1、阿里云开发者平台</h4> <p>https://promotion.aliyun.com/ntms/act/kubernetes.html</p> <p><img src="/assets/img/image-20220416152352397.21a4d562.png" alt="image-20220416152352397"></p> <h4 id="_2、创建仓库镜像"><a href="#_2、创建仓库镜像" class="header-anchor">#</a> 2、创建仓库镜像</h4> <h5 id="_1、选择控制台-进入容器镜像服务"><a href="#_1、选择控制台-进入容器镜像服务" class="header-anchor">#</a> 1、选择控制台，进入容器镜像服务</h5> <p><img src="/assets/img/image-20220416152500028.23aa3df2.png" alt="image-20220416152500028"></p> <h5 id="_2、选择个人实例"><a href="#_2、选择个人实例" class="header-anchor">#</a> 2、选择个人实例</h5> <p><img src="/assets/img/image-20220416152544697.3f76d8a5.png" alt="image-20220416152544697"></p> <h5 id="_3、命名空间"><a href="#_3、命名空间" class="header-anchor">#</a> 3、命名空间</h5> <p><img src="/assets/img/image-20220416152604459.9fc4cf29.png" alt="image-20220416152604459"></p> <p>创建命名空间</p> <p><img src="/assets/img/image-20220416152624420.8b65998e.png" alt="image-20220416152624420"></p> <h5 id="_4、仓库名称"><a href="#_4、仓库名称" class="header-anchor">#</a> 4、仓库名称</h5> <p><img src="/assets/img/image-20220416152700231.5bc0ca7e.png" alt="image-20220416152700231"></p> <p><img src="/assets/img/image-20220416152714343.8c955f48.png" alt="image-20220416152714343"></p> <p><img src="/assets/img/image-20220416152724320.46087fd2.png" alt="image-20220416152724320"></p> <h5 id="_5、进入管理界面获得脚本"><a href="#_5、进入管理界面获得脚本" class="header-anchor">#</a> 5、进入管理界面获得脚本</h5> <p><img src="/assets/img/image-20220416152746792.e03ee941.png" alt="image-20220416152746792"></p> <h4 id="_3、将镜像推送到阿里云"><a href="#_3、将镜像推送到阿里云" class="header-anchor">#</a> 3、将镜像推送到阿里云</h4> <p>将镜像推送到阿里云registry</p> <ul><li>管理界面脚本</li></ul> <p><img src="/assets/img/image-20220416152927778.e336621c.png" alt="image-20220416152927778"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>将镜像推送到Registry
$ <span class="token function">docker</span> login --username<span class="token operator">=</span><span class="token punctuation">[</span>阿里云账号<span class="token punctuation">]</span> registry.cn-hangzhou.aliyuncs.com
$ <span class="token function">docker</span> tag <span class="token punctuation">[</span>ImageId<span class="token punctuation">]</span> registry.cn-hangzhou.aliyuncs.com/xiaobear/xiaobear-dcoker:<span class="token punctuation">[</span>镜像版本号<span class="token punctuation">]</span>
$ <span class="token function">docker</span> push registry.cn-hangzhou.aliyuncs.com/xiaobear/xiaobear-dcoker:<span class="token punctuation">[</span>镜像版本号<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="/assets/img/image-20220416154550387.0571755f.png" alt="image-20220416154550387"></p> <h3 id="_3、将阿里云上的镜像下载到本地"><a href="#_3、将阿里云上的镜像下载到本地" class="header-anchor">#</a> 3、将阿里云上的镜像下载到本地</h3> <h4 id="从registry中拉取镜像"><a href="#从registry中拉取镜像" class="header-anchor">#</a> 从Registry中拉取镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token function">docker</span> pull registry.cn-hangzhou.aliyuncs.com/xiaobear/xiaobear-dcoker:<span class="token punctuation">[</span>镜像版本号<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_6、本地镜像发布到私有库"><a href="#_6、本地镜像发布到私有库" class="header-anchor">#</a> 6、本地镜像发布到私有库</h2> <h3 id="_1、本地镜像发布到私有库流程"><a href="#_1、本地镜像发布到私有库流程" class="header-anchor">#</a> 1、本地镜像发布到私有库流程</h3> <p><img src="/assets/img/image-20220416160207057.865f3736.png" alt="image-20220416160207057"></p> <h3 id="_2、什么是docker-registry"><a href="#_2、什么是docker-registry" class="header-anchor">#</a> 2、什么是<code>Docker Registry</code></h3> <blockquote><p>官方Docker Hub地址：https://hub.docker.com/，中国大陆访问太慢了且准备被阿里云取代的趋势，不太主流。</p> <p>Dockerhub、阿里云这样的公共镜像仓库可能不太方便，涉及机密的公司不可能提供镜像给公网，所以需要创建一个本地私人仓库供给团队使用，基于公司内部项目构建镜像。</p> <p>Docker Registry是官方提供的工具，可以用于构建私有镜像仓库</p></blockquote> <h3 id="_3、将本地镜像推送到私有库"><a href="#_3、将本地镜像推送到私有库" class="header-anchor">#</a> 3、将本地镜像推送到私有库</h3> <h4 id="_1、下载镜像docker-registry"><a href="#_1、下载镜像docker-registry" class="header-anchor">#</a> 1、下载镜像Docker Registry</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> pull registry 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker pull registry</span>
Using default tag: latest
latest: Pulling from library/registry
79e9f2f55bf5: Pull complete 
0d96da54f60b: Pull complete 
5b27040df4a2: Pull complete 
e2ead8259a04: Pull complete 
3790aef225b9: Pull complete 
Digest: sha256:169211e20e2f2d5d115674681eb79d21a217b296b43374b8e39f97fcf866b375
Status: Downloaded newer image <span class="token keyword">for</span> registry:latest
docker.io/library/registry:latest
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker ../images</span>
REPOSITORY                                                   TAG       IMAGE ID       CREATED        SIZE
centos1                                                      <span class="token number">1.0</span>       08f93c122271   <span class="token number">5</span> days ago     298MB
registry.cn-hangzhou.aliyuncs.com/xiaobear/xiaobear-dcoker   <span class="token number">1.0</span>       12e7a58fc36a   <span class="token number">5</span> days ago     231MB
redis                                                        latest    7614ae9453d1   <span class="token number">3</span> months ago   113MB
registry                                                     latest    b8604a3fe854   <span class="token number">5</span> months ago   <span class="token number">26</span>.2MB
hello-world                                                  latest    feb5d9fea6a5   <span class="token number">6</span> months ago   <span class="token number">13</span>.3kB
centos                                                       latest    5d0da3dc9764   <span class="token number">7</span> months ago   231MB
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="_2、运行私有库registry-相当于本地有个私有docker-hub"><a href="#_2、运行私有库registry-相当于本地有个私有docker-hub" class="header-anchor">#</a> 2、运行私有库Registry，相当于本地有个私有Docker hub</h4> <p>默认情况，仓库被创建在容器的/var/lib/registry目录下，建议自行用容器卷映射，方便于宿主机联调</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">5000</span>:5000  -v /zzyyuse/myregistry/:/tmp/registry --privileged<span class="token operator">=</span>true registry
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>-p</code>：指定端口</p> <p><code>-P</code>：随机端口</p> <h4 id="_3、案例演示创建一个新镜像-centos安装ifconfig命令"><a href="#_3、案例演示创建一个新镜像-centos安装ifconfig命令" class="header-anchor">#</a> 3、案例演示创建一个新镜像，centos安装ifconfig命令</h4> <h5 id="_1、从hub上下载ubuntu镜像到本地并成功运行"><a href="#_1、从hub上下载ubuntu镜像到本地并成功运行" class="header-anchor">#</a> 1、从Hub上下载ubuntu镜像到本地并成功运行</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> pull centos
<span class="token function">docker</span> run -it centos /bin/bash
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -it centos /bin/bash</span>
<span class="token punctuation">[</span>root@76d96b17087a /<span class="token punctuation">]</span><span class="token comment">## ifconfig</span>
bash: ifconfig: <span class="token builtin class-name">command</span> not found
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h5 id="_2、外网连通-安装redis"><a href="#_2、外网连通-安装redis" class="header-anchor">#</a> 2、外网连通，安装redis</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>yum <span class="token function">install</span> -y redis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_3、安装完成-提交镜像"><a href="#_3、安装完成-提交镜像" class="header-anchor">#</a> 3、安装完成，提交镜像</h5> <blockquote><p>docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID 要创建的目标镜像名:[标签名]
命令：在容器外执行，记得</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> commit -m<span class="token operator">=</span><span class="token string">&quot;add test&quot;</span> -a<span class="token operator">=</span><span class="token string">&quot;xiaobear&quot;</span> 846cde73b2fd centos1:1.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4、验证私服上镜像"><a href="#_4、验证私服上镜像" class="header-anchor">#</a> 4、验证私服上镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">curl</span> -XGET http://<span class="token punctuation">[</span>ip<span class="token punctuation">]</span>:5000/v2/_catalog
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker ps</span>
CONTAINER ID   IMAGE      COMMAND                  CREATED          STATUS         PORTS                                       NAMES
a35006a5eb6e   registry   <span class="token string">&quot;/entrypoint.sh /etc…&quot;</span>   <span class="token number">13</span> seconds ago   Up <span class="token number">7</span> seconds   <span class="token number">0.0</span>.0.0:5000-<span class="token operator">&gt;</span><span class="token number">5000</span>/tcp, :::5000-<span class="token operator">&gt;</span><span class="token number">5000</span>/tcp   tender_buck
846cde73b2fd   centos     <span class="token string">&quot;/bin/bash&quot;</span>              <span class="token number">7</span> minutes ago    Up <span class="token number">7</span> minutes                                               stupefied_wescoff
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">##  curl -XGET http://192.168.130.132:5000/v2/_catalog</span>
<span class="token punctuation">{</span><span class="token string">&quot;repositories&quot;</span>:<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_5、将新镜像centos1-1-0修改符合私服规范的tag"><a href="#_5、将新镜像centos1-1-0修改符合私服规范的tag" class="header-anchor">#</a> 5、将新镜像centos1:1.0修改符合私服规范的Tag</h4> <blockquote><p>公式： docker   tag   镜像:Tag   Host:Port/Repository:Tag</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker tag centos1:1.0  192.168.130.132:5000/centos1:1.0</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker ../images</span>
REPOSITORY                                                   TAG       IMAGE ID       CREATED          SIZE
<span class="token number">192.168</span>.130.132:5000/centos1                                 <span class="token number">1.0</span>       39cad16c0525   <span class="token number">32</span> minutes ago   231MB
centos1                                                      <span class="token number">1.0</span>       39cad16c0525   <span class="token number">32</span> minutes ago   231MB
registry.cn-hangzhou.aliyuncs.com/xiaobear/xiaobear-dcoker   <span class="token number">1.0</span>       12e7a58fc36a   <span class="token number">6</span> days ago       231MB
redis                                                        latest    7614ae9453d1   <span class="token number">3</span> months ago     113MB
registry                                                     latest    b8604a3fe854   <span class="token number">5</span> months ago     <span class="token number">26</span>.2MB
hello-world                                                  latest    feb5d9fea6a5   <span class="token number">6</span> months ago     <span class="token number">13</span>.3kB
centos                                                       latest    5d0da3dc9764   <span class="token number">7</span> months ago     231MB
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="_6、修改配置文件-支持http"><a href="#_6、修改配置文件-支持http" class="header-anchor">#</a> 6、修改配置文件，支持http</h4> <blockquote><p>docker默认不允许http方式推送镜像，通过配置选项来取消这个限制。</p></blockquote> <h5 id="_1、查看配置文件"><a href="#_1、查看配置文件" class="header-anchor">#</a> 1、查看配置文件</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cat</span> /etc/docker/daemon.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_2、修改配置文件"><a href="#_2、修改配置文件" class="header-anchor">#</a> 2、修改配置文件</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> /etc/docker/daemon.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://cmquykjm.mirror.aliyuncs.com&quot;</span><span class="token punctuation">]</span>,
  <span class="token string">&quot;insecure-registries&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;192.168.140.132:5000&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>[&quot;ip:端口&quot;]:</p> <ul><li>ip：自己启动服务器的ip</li> <li>端口：映射的端口</li></ul> <h5 id="_3、修改之后查看配置并重新启动"><a href="#_3、修改之后查看配置并重新启动" class="header-anchor">#</a> 3、修改之后查看配置并重新启动</h5> <p>PS：重新启动端口之后，需启动私有仓库</p> <h4 id="_7、push到私有仓库"><a href="#_7、push到私有仓库" class="header-anchor">#</a> 7、push到私有仓库</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker ps</span>
CONTAINER ID   IMAGE      COMMAND                  CREATED         STATUS         PORTS                                       NAMES
e36d4066ba00   registry   <span class="token string">&quot;/entrypoint.sh /etc…&quot;</span>   <span class="token number">5</span> seconds ago   Up <span class="token number">5</span> seconds   <span class="token number">0.0</span>.0.0:5000-<span class="token operator">&gt;</span><span class="token number">5000</span>/tcp, :::5000-<span class="token operator">&gt;</span><span class="token number">5000</span>/tcp   ecstatic_goldstine
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker push 192.168.130.132:5000/centos1:1.0</span>
The push refers to repository <span class="token punctuation">[</span><span class="token number">192.168</span>.130.132:5000/centos1<span class="token punctuation">]</span>
74ddd0ec08fa: Pushed 
<span class="token number">1.0</span>: digest: sha256:df7b98170728e2ae419520239adf7862c15a246a58115ba91ee5ac10dfb7fdb0 size: <span class="token number">529</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_8、验证私服镜像"><a href="#_8、验证私服镜像" class="header-anchor">#</a> 8、验证私服镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">curl</span> -XGET http://192.168.130.132:5000/v2/_catalog
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## curl -XGET http://192.168.130.132:5000/v2/_catalog</span>
<span class="token punctuation">{</span><span class="token string">&quot;repositories&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;centos1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="_9、pull到本地并运行"><a href="#_9、pull到本地并运行" class="header-anchor">#</a> 9、pull到本地并运行</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker pull 192.168.130.132:5000/centos1:1.0</span>
<span class="token number">1.0</span>: Pulling from centos1
a1d0c7532777: Already exists 
Digest: sha256:df7b98170728e2ae419520239adf7862c15a246a58115ba91ee5ac10dfb7fdb0
Status: Downloaded newer image <span class="token keyword">for</span> <span class="token number">192.168</span>.130.132:5000/centos1:1.0
<span class="token number">192.168</span>.130.132:5000/centos1:1.0
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_7、docker容器数据卷"><a href="#_7、docker容器数据卷" class="header-anchor">#</a> 7、Docker容器数据卷</h2> <blockquote><p>容器卷记得加入：<code>--privileged=true</code></p></blockquote> <p>Docker挂载主机目录访问如果出现cannot open directory .: Permission denied</p> <p>**解决办法：**在挂载目录后多 加一个--privileged=true参数即可</p> <blockquote><p>如果是CentOS7安全模块会比之前系统版本加强，不安全的会先禁止，所以目录挂载的情况被默认为不安全的行为，
在SELinux里面挂载目录被禁止掉了额，如果要开启，我们一般使用--privileged=true命令，扩大容器的权限解决挂载目录没有权限的问题，也即
使用该参数，container内的root拥有真正的root权限，否则，container内的root只是外部的一个普通用户权限。</p></blockquote> <h3 id="_1、什么是容器卷"><a href="#_1、什么是容器卷" class="header-anchor">#</a> 1、什么是容器卷</h3> <blockquote><p>卷就是目录或文件，存在于一个或多个容器中，由docker挂载到容器，但不属于联合文件系统，因此能够绕过Union File System提供一些用于持续存储或共享数据的特性：
卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此Docker不会在容器删除时删除其挂载的数据卷</p></blockquote> <p>一句话：有点类似我们Redis里面的rdb和aof文件</p> <p>将docker容器内的数据保存进宿主机的磁盘中</p> <p>运行一个带有容器卷存储功能的容器实例</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token function">docker</span> run -it --privileged<span class="token operator">=</span>true -v /宿主机绝对路径目录:/容器内目录      镜像名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2、作用"><a href="#_2、作用" class="header-anchor">#</a> 2、作用</h3> <blockquote><p>将运用与运行的环境打包镜像，run后形成容器实例运行 ，但是我们对数据的要求希望是持久化的；Docker容器产生的数据，如果不备份，那么当容器实例删除后，容器内的数据自然也就没有了。为了能保存数据在docker中我们使用卷。</p></blockquote> <p>特点：</p> <ul><li>数据卷可在容器之间共享或重用数据</li> <li>卷中的更改可以直接实时生效</li> <li>数据卷中的更改不会包含在镜像的更新中</li> <li>数据卷的生命周期一直持续到没有容器使用它为止</li></ul> <h3 id="_3、案例"><a href="#_3、案例" class="header-anchor">#</a> 3、案例</h3> <h4 id="_1、宿主vs容器之间映射添加容器卷"><a href="#_1、宿主vs容器之间映射添加容器卷" class="header-anchor">#</a> 1、宿主vs容器之间映射添加容器卷</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token function">docker</span> run -it --privileged<span class="token operator">=</span>true -v /宿主机绝对路径目录:/容器内目录      镜像名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 公式：docker run -it -v /宿主机目录:/容器内目录 centos /bin/bash</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -it --name mycentos --privileged=true -v /tmp/myHostData:/tmp/myDockerData centos /bin/bash</span>
<span class="token punctuation">[</span>root@77429a055609 /<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>容器内目录结构</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@77429a055609 /<span class="token punctuation">]</span><span class="token comment">## cd tmp</span>
<span class="token punctuation">[</span>root@77429a055609 tmp<span class="token punctuation">]</span><span class="token comment">## ls</span>
ks-script-4luisyla  ks-script-o23i7rc2	ks-script-x6ei4wuu  myDockerData
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>宿主机内</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker /<span class="token punctuation">]</span><span class="token comment">## cd tmp/</span>
<span class="token punctuation">[</span>root@docker tmp<span class="token punctuation">]</span><span class="token comment">## ls</span>
ks-script-DUUAUC                                                         vmware-root_671-3988556280
myHostData                                                               vmware-root_679-3988687326
systemd-private-d8aa05bbc4754bae8de67cf03b16ed6c-chronyd.service-duHBa7  vmware-root_688-2688750615
systemd-private-dfa20a5865b348c4bb8885cff1f38f6a-chronyd.service-Kxsvca  yum.log
vmware-root_662-2689143848
<span class="token punctuation">[</span>root@docker tmp<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h5 id="_1、查看是否挂载成功"><a href="#_1、查看是否挂载成功" class="header-anchor">#</a> 1、查看是否挂载成功</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> inspect 容器ID
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token string">&quot;Mounts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
                <span class="token string">&quot;Type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;bind&quot;</span>,
                <span class="token string">&quot;Source&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/myHostData&quot;</span>,
                <span class="token string">&quot;Destination&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;/tmp/myDockerData&quot;</span>,
                <span class="token string">&quot;Mode&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                <span class="token string">&quot;RW&quot;</span><span class="token builtin class-name">:</span> true,
                <span class="token string">&quot;Propagation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;rprivate&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>,
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="_2、容器与宿主机数据共享"><a href="#_2、容器与宿主机数据共享" class="header-anchor">#</a> 2、容器与宿主机数据共享</h5> <ul><li>docker修改，主机同步获取</li> <li>主机修改，docker同步获得</li> <li>docker容器stop，主机修改，docker重启后数据同步获得</li></ul> <p><img src="/assets/img/image-20220417165734661.bc7cbdca.png" alt="image-20220417165734661"></p> <h4 id="_2、读写规则映射添加说明"><a href="#_2、读写规则映射添加说明" class="header-anchor">#</a> 2、读写规则映射添加说明</h4> <p>默认就是rw，<code>rw = read + write</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token function">docker</span> run -it --privileged<span class="token operator">=</span>true -v /宿主机绝对路径目录:/容器内目录:rw      镜像名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_1、只读"><a href="#_1、只读" class="header-anchor">#</a> 1、只读</h5> <blockquote><p>容器实例内部被限制，只能读取不能写 <code>ro = read only</code></p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token function">docker</span> run -it --privileged<span class="token operator">=</span>true -v /宿主机绝对路径目录:/容器内目录:ro      镜像名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20220417170024379.ec18ca2f.png" alt="image-20220417170024379"></p> <p>/容器目录:ro 镜像名               就能完成功能，此时容器自己只能读取不能写</p> <p>此时如果宿主机写入内容，可以同步给容器内，容器可以读取到。</p> <h4 id="_3、卷的继承和共享"><a href="#_3、卷的继承和共享" class="header-anchor">#</a> 3、卷的继承和共享</h4> <blockquote><p>案例场景：容器1完成与主机的映射，容器2继承容器1的卷规则</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -it  --privileged<span class="token operator">=</span>true --volumes-from 父类  --name u2 ubuntu
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20220417170551848.8f2b88a9.png" alt="image-20220417170551848"></p> <h2 id="_8、docker常规安装"><a href="#_8、docker常规安装" class="header-anchor">#</a> 8、Docker常规安装</h2> <p>步骤：</p> <ol><li>搜索镜像</li> <li>拉取镜像</li> <li>查看镜像</li> <li>启动镜像</li> <li>停止容器</li> <li>移除容器</li></ol> <h3 id="_1、安装tomcat"><a href="#_1、安装tomcat" class="header-anchor">#</a> 1、安装tomcat</h3> <h4 id="_1、搜索镜像"><a href="#_1、搜索镜像" class="header-anchor">#</a> 1、搜索镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> search tomcat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2、拉取镜像"><a href="#_2、拉取镜像" class="header-anchor">#</a> 2、拉取镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> pull tomcat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3、查看镜像"><a href="#_3、查看镜像" class="header-anchor">#</a> 3、查看镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token punctuation">..</span>/images
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4、创建容器示例"><a href="#_4、创建容器示例" class="header-anchor">#</a> 4、创建容器示例</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -it -p <span class="token number">8080</span>:8080 tomcat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>-p 小写，主机端口:docker容器端口</li> <li>-P 大写，随机分配端口</li> <li>i:交互</li> <li>t:终端</li> <li>d:后台</li></ul> <p>PS：宿主机8080映射到容器内的8080端口</p> <h5 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h5> <p>访问http://[ip]:8080/</p> <p><img src="/assets/img/image-20220417173007323.effa9dfa.png" alt="image-20220417173007323"></p> <h5 id="解决"><a href="#解决" class="header-anchor">#</a> 解决</h5> <ol><li><p>可能没有映射端口或者没有关闭防火墙</p></li> <li><p>查看tomcat文件，把webapps.dist目录换成webapps</p> <ol><li><p>先后台启动tomcat</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">8080</span>:8080 tomcat
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>进入容器内部</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it tomcat /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>查看文件目录，webapps.dist目录换成webapps</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@90c2f8c553b0:/usr/local/tomcat<span class="token comment">## ls</span>
BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist
CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work
root@90c2f8c553b0:/usr/local/tomcat<span class="token comment">## rm -f webapps</span>
rm: cannot remove <span class="token string">'webapps'</span><span class="token builtin class-name">:</span> Is a directory
root@90c2f8c553b0:/usr/local/tomcat<span class="token comment">## rm -r webapps</span>
root@90c2f8c553b0:/usr/local/tomcat<span class="token comment">## mv webapps.dist webapps</span>
root@90c2f8c553b0:/usr/local/tomcat<span class="token comment">## ls</span>
BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     work
CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps
root@90c2f8c553b0:/usr/local/tomcat<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>重新访问：http://[ip]:8080/</p> <p><img src="/assets/img/image-20220417173322103.83b41797.png" alt="image-20220417173322103"></p></li></ol></li></ol> <h4 id="_5、免修改版"><a href="#_5、免修改版" class="header-anchor">#</a> 5、免修改版</h4> <h5 id="拉取镜像"><a href="#拉取镜像" class="header-anchor">#</a> 拉取镜像</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> pull billygoo/tomcat8-jdk8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="创建容器"><a href="#创建容器" class="header-anchor">#</a> 创建容器</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">8080</span>:8080 --name mytomcat8 billygoo/tomcat8-jdk8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2、安装mysql"><a href="#_2、安装mysql" class="header-anchor">#</a> 2、安装MySQL</h3> <h4 id="_1、搜索镜像-2"><a href="#_1、搜索镜像-2" class="header-anchor">#</a> 1、搜索镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> search mysql
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2、拉取指定版本镜像"><a href="#_2、拉取指定版本镜像" class="header-anchor">#</a> 2、拉取指定版本镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> pull mysql:5.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3、创建容器"><a href="#_3、创建容器" class="header-anchor">#</a> 3、创建容器</h4> <p>查看镜像省略</p> <div class="language-text line-numbers-mode"><pre class="language-text"><code>docker run -itd --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql:5.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><strong>-p 3306:3306</strong> ：映射容器服务的 3306 端口到宿主机的 3306 端口，外部主机可以直接通过 <strong>宿主机ip:3306</strong> 访问到 MySQL 的服务。</li> <li><strong>MYSQL_ROOT_PASSWORD=123456</strong>：设置 MySQL 服务 root 用户的密码。</li></ul> <h4 id="_4、使用"><a href="#_4、使用" class="header-anchor">#</a> 4、使用</h4> <h5 id="_1、简单版"><a href="#_1、简单版" class="header-anchor">#</a> 1、简单版</h5> <h6 id="_1、使用mysql镜像"><a href="#_1、使用mysql镜像" class="header-anchor">#</a> 1、使用MySQL镜像</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it a6b1fc904bad /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker myHostData<span class="token punctuation">]</span><span class="token comment">## docker exec -it a6b1fc904bad /bin/bash</span>
root@a6b1fc904bad:/<span class="token comment">## mysql -u root -p</span>
Enter password: 
Welcome to the MySQL monitor.  Commands end with <span class="token punctuation">;</span> or <span class="token punctuation">\</span>g.
Your MySQL connection <span class="token function">id</span> is <span class="token number">2</span>
Server version: <span class="token number">5.7</span>.36 MySQL Community Server <span class="token punctuation">(</span>GPL<span class="token punctuation">)</span>

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2000</span>, <span class="token number">2021</span>, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.

mysql<span class="token operator">&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h6 id="_2、建库建表"><a href="#_2、建库建表" class="header-anchor">#</a> 2、建库建表</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> create database db1<span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> show databases<span class="token punctuation">;</span>
+--------------------+
<span class="token operator">|</span> Database           <span class="token operator">|</span>
+--------------------+
<span class="token operator">|</span> information_schema <span class="token operator">|</span>
<span class="token operator">|</span> db1                <span class="token operator">|</span>
<span class="token operator">|</span> mysql              <span class="token operator">|</span>
<span class="token operator">|</span> performance_schema <span class="token operator">|</span>
<span class="token operator">|</span> sys                <span class="token operator">|</span>
+--------------------+
<span class="token number">5</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> use db1<span class="token punctuation">;</span>
Database changed
mysql<span class="token operator">&gt;</span> create table test01<span class="token punctuation">(</span>id int, name varchar<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.05</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> insert into test01 values<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token string">'xiaobear'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.45</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from test01<span class="token punctuation">;</span>
+------+----------+
<span class="token operator">|</span> <span class="token function">id</span>   <span class="token operator">|</span> name     <span class="token operator">|</span>
+------+----------+
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> xiaobear <span class="token operator">|</span>
+------+----------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h6 id="_3、远程连接docker中的mysql"><a href="#_3、远程连接docker中的mysql" class="header-anchor">#</a> 3、远程连接docker中的MySQL</h6> <h6 id="_4、插入中文数据"><a href="#_4、插入中文数据" class="header-anchor">#</a> 4、插入中文数据</h6> <p><img src="/assets/img/image-20220418233727804.f3c4ae25.png" alt="image-20220418233727804"></p> <p>**原因：**docker上默认字符集编码隐患</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> show variables like <span class="token string">'character%'</span><span class="token punctuation">;</span>
+--------------------------+----------------------------+
<span class="token operator">|</span> Variable_name            <span class="token operator">|</span> Value                      <span class="token operator">|</span>
+--------------------------+----------------------------+
<span class="token operator">|</span> character_set_client     <span class="token operator">|</span> latin1                     <span class="token operator">|</span>
<span class="token operator">|</span> character_set_connection <span class="token operator">|</span> latin1                     <span class="token operator">|</span>
<span class="token operator">|</span> character_set_database   <span class="token operator">|</span> latin1                     <span class="token operator">|</span>
<span class="token operator">|</span> character_set_filesystem <span class="token operator">|</span> binary                     <span class="token operator">|</span>
<span class="token operator">|</span> character_set_results    <span class="token operator">|</span> latin1                     <span class="token operator">|</span>
<span class="token operator">|</span> character_set_server     <span class="token operator">|</span> latin1                     <span class="token operator">|</span>
<span class="token operator">|</span> character_set_system     <span class="token operator">|</span> utf8                       <span class="token operator">|</span>
<span class="token operator">|</span> character_sets_dir       <span class="token operator">|</span> /usr/share/mysql/charsets/ <span class="token operator">|</span>
+--------------------------+----------------------------+
<span class="token number">8</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="_2、实战版"><a href="#_2、实战版" class="header-anchor">#</a> 2、实战版</h5> <h6 id="_1、创建容器"><a href="#_1、创建容器" class="header-anchor">#</a> 1、创建容器</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">3306</span>:3306 --privileged<span class="token operator">=</span>true -v /xiaobear/mysql/log:/var/log/mysql -v /xiaobear/mysql/data:/var/lib/mysql -v /xiaobear/mysql/conf:/etc/mysql/conf.d -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span><span class="token number">123456</span>  --name mysql mysql:5.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h6 id="_2、创建配置文件"><a href="#_2、创建配置文件" class="header-anchor">#</a> 2、创建配置文件</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -d -p 3306:3306 --privileged=true -v /xiaobear/mysql/log:/var/log/mysql -v /xiaobear/mysql/data:/var/lib/mysql -v /xiaobear/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456  --name mysql mysql:5.7</span>
9b08a40ccc0668416dbe8abc744cf2878940203f0e4fa3cb3a46c0179ac2244b
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker ps</span>
CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                                                  NAMES
9b08a40ccc06   mysql:5.7   <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">7</span> seconds ago   Up <span class="token number">7</span> seconds   <span class="token number">0.0</span>.0.0:3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, :::3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, <span class="token number">33060</span>/tcp   mysql
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## cd /xiaobear/mysql/conf/</span>
<span class="token punctuation">[</span>root@docker conf<span class="token punctuation">]</span><span class="token comment">## ls</span>
<span class="token punctuation">[</span>root@docker conf<span class="token punctuation">]</span><span class="token comment">## vim my.cnf</span>
<span class="token punctuation">[</span>root@docker conf<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>配置文件内容</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">client</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">default-character-set</span><span class="token punctuation">=</span><span class="token value attr-value">utf8</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysql</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">default-character-set</span><span class="token punctuation">=</span><span class="token value attr-value">utf8</span>

<span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">mysqld</span><span class="token punctuation">]</span></span>
<span class="token key attr-name">init_connect</span><span class="token punctuation">=</span><span class="token value attr-value">'<span class="token inner-value">SET collation_connection = utf8_unicode_ci</span>'</span>
<span class="token key attr-name">init_connect</span><span class="token punctuation">=</span><span class="token value attr-value">'<span class="token inner-value">SET NAMES utf8</span>'</span>
<span class="token key attr-name">character-set-server</span><span class="token punctuation">=</span><span class="token value attr-value">utf8</span>
<span class="token key attr-name">collation-server</span><span class="token punctuation">=</span><span class="token value attr-value">utf8_unicode_ci</span>
skip-character-set-client-handshake
skip-name-resolve
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h6 id="_3、重新启动查看编码"><a href="#_3、重新启动查看编码" class="header-anchor">#</a> 3、重新启动查看编码</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> restart mysql
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it mysql /bin/bash
mysql -u root -p

<span class="token comment">#show variables like 'character%';</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h6 id="_4、中文测试"><a href="#_4、中文测试" class="header-anchor">#</a> 4、中文测试</h6> <h6 id="_5、总结"><a href="#_5、总结" class="header-anchor">#</a> 5、总结</h6> <blockquote><p>docker安装完MySQL并run出容器后，建议请先修改完字符集编码后再新建mysql库-表-插数据</p></blockquote> <h3 id="_3、安装redis"><a href="#_3、安装redis" class="header-anchor">#</a> 3、安装redis</h3> <h4 id="_1、拉取镜像"><a href="#_1、拉取镜像" class="header-anchor">#</a> 1、拉取镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> pull redis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2、创建容器"><a href="#_2、创建容器" class="header-anchor">#</a> 2、创建容器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">6739</span>:6739 redis
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3、进入容器"><a href="#_3、进入容器" class="header-anchor">#</a> 3、进入容器</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it 3f85f4351992 /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4、在宿主机创建目录"><a href="#_4、在宿主机创建目录" class="header-anchor">#</a> 4、在宿主机创建目录</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">mkdir</span> -p /app/redis/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5、复制一份redis-conf到该目录下-修改"><a href="#_5、复制一份redis-conf到该目录下-修改" class="header-anchor">#</a> 5、复制一份redis.conf到该目录下,修改</h4> <p>/app/redis目录下修改redis.conf文件
3.1 开启redis验证    可选
requirepass 123</p> <p>3.2 允许redis外地连接  必须
注释掉 ## bind 127.0.0.1</p> <p><img src="/assets/img/image-20220421223538381.cbed18af.png" alt="image-20220421223538381"></p> <p>3.3   daemonize no
将daemonize yes注释起来或者 daemonize no设置，因为该配置和docker run中-d参数冲突，会导致容器一直启动失败</p> <p><img src="/assets/img/image-20220421223555698.20666f07.png" alt="image-20220421223555698"></p> <p>3.4 开启redis数据持久化  appendonly yes  可选</p> <h4 id="_6、使用redis镜像创建容器-也叫运行镜像"><a href="#_6、使用redis镜像创建容器-也叫运行镜像" class="header-anchor">#</a> 6、使用redis镜像创建容器(也叫运行镜像)</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run  -p <span class="token number">6379</span>:6379 --name myredis --privileged<span class="token operator">=</span>true -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis redis-server /etc/redis/redis.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker redis<span class="token punctuation">]</span><span class="token comment">## docker run  -p 6379:6379 --name myredis --privileged=true -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis redis-server /etc/redis/redis.conf</span>
50c5ce6ccb609cb8d4e3da1d40f51e5148c57b44f821ab55483ffe1aae689a31
<span class="token punctuation">[</span>root@docker redis<span class="token punctuation">]</span><span class="token comment">## docker ps</span>
CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                                                  NAMES
50c5ce6ccb60   redis       <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">8</span> seconds ago   Up <span class="token number">6</span> seconds   <span class="token number">0.0</span>.0.0:6379-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp, :::6379-<span class="token operator">&gt;</span><span class="token number">6379</span>/tcp              myredis
9b08a40ccc06   mysql:5.7   <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">2</span> days ago      Up <span class="token number">2</span> days      <span class="token number">0.0</span>.0.0:3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, :::3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, <span class="token number">33060</span>/tcp   mysql
<span class="token punctuation">[</span>root@docker redis<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="_7、测试连接"><a href="#_7、测试连接" class="header-anchor">#</a> 7、测试连接</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker redis<span class="token punctuation">]</span><span class="token comment">## docker exec -it myredis /bin/bash</span>
root@50c5ce6ccb60:/data<span class="token comment">## redis-cli</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> k hello
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get k
<span class="token string">&quot;hello&quot;</span>
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>docker exec -it 运行着Rediis服务的容器ID redis-cli</p> <h2 id="_9、复杂安装"><a href="#_9、复杂安装" class="header-anchor">#</a> 9、复杂安装</h2> <h3 id="_1、mysql主从复制"><a href="#_1、mysql主从复制" class="header-anchor">#</a> 1、MySQL主从复制</h3> <blockquote><p>原理：</p></blockquote> <h4 id="_1、搭建步骤"><a href="#_1、搭建步骤" class="header-anchor">#</a> 1、搭建步骤</h4> <h5 id="_1、新建主服务器示例3307"><a href="#_1、新建主服务器示例3307" class="header-anchor">#</a> 1、新建主服务器示例3307</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -p <span class="token number">3307</span>:3306 --name mysql-master <span class="token punctuation">\</span>
-v /mydata/mysql-master/log:/var/log/mysql <span class="token punctuation">\</span>
-v /mydata/mysql-master/data:/var/lib/mysql <span class="token punctuation">\</span>
-v /mydata/mysql-master/conf:/etc/mysql <span class="token punctuation">\</span>
-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root  <span class="token punctuation">\</span>
-d mysql:5.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="_2、进入-mydata-mysql-master-conf目录下新建my-cnf"><a href="#_2、进入-mydata-mysql-master-conf目录下新建my-cnf" class="header-anchor">#</a> 2、进入/mydata/mysql-master/conf目录下新建my.cnf</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vim</span> my.cnf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-cnf line-numbers-mode"><pre class="language-text"><code>[mysqld]
### 设置server_id，同一局域网中需要唯一
server_id=101 
### 指定不需要同步的数据库名称
binlog-ignore-db=mysql  
### 开启二进制日志功能
log-bin=mall-mysql-bin  
### 设置二进制日志使用内存大小（事务）
binlog_cache_size=1M  
### 设置使用的二进制日志格式（mixed,statement,row）
binlog_format=mixed  
### 二进制日志过期清理时间。默认值为0，表示不自动清理。
expire_logs_days=7  
### 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。
### 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致
slave_skip_errors=1062
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h5 id="_3、重启实例"><a href="#_3、重启实例" class="header-anchor">#</a> 3、重启实例</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> restart mysql-master
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_4、进入容器"><a href="#_4、进入容器" class="header-anchor">#</a> 4、进入容器</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it mysql-master /bin/bash
<span class="token comment">#登录mysql</span>
mysql -u root -p
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="_5、master容器实例内创建数据同步用户"><a href="#_5、master容器实例内创建数据同步用户" class="header-anchor">#</a> 5、master容器实例内创建数据同步用户</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#创建用户名和密码</span>
CREATE <span class="token environment constant">USER</span> <span class="token string">'slave'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'123456'</span><span class="token punctuation">;</span>
<span class="token comment">#授权</span>
GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO <span class="token string">'slave'</span>@<span class="token string">'%'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="_6、创建从服务器实例3308"><a href="#_6、创建从服务器实例3308" class="header-anchor">#</a> 6、创建从服务器实例3308</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -p <span class="token number">3308</span>:3306 --name mysql-slave <span class="token punctuation">\</span>
-v /mydata/mysql-slave/log:/var/log/mysql <span class="token punctuation">\</span>
-v /mydata/mysql-slave/data:/var/lib/mysql <span class="token punctuation">\</span>
-v /mydata/mysql-slave/conf:/etc/mysql <span class="token punctuation">\</span>
-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root  <span class="token punctuation">\</span>
-d mysql:5.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h5 id="_7、进入-mydata-mysql-slave-conf目录下新建my-cnf"><a href="#_7、进入-mydata-mysql-slave-conf目录下新建my-cnf" class="header-anchor">#</a> 7、进入/mydata/mysql-slave/conf目录下新建my.cnf</h5> <div class="language-cnf line-numbers-mode"><pre class="language-text"><code>[mysqld]
### 设置server_id，同一局域网中需要唯一
server_id=102
### 指定不需要同步的数据库名称
binlog-ignore-db=mysql  
### 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用
log-bin=mall-mysql-slave1-bin  
### 设置二进制日志使用内存大小（事务）
binlog_cache_size=1M  
### 设置使用的二进制日志格式（mixed,statement,row）
binlog_format=mixed  
### 二进制日志过期清理时间。默认值为0，表示不自动清理。
expire_logs_days=7  
### 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。
### 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致
slave_skip_errors=1062  
### relay_log配置中继日志
relay_log=mall-mysql-relay-bin  
### log_slave_updates表示slave将复制事件写进自己的二进制日志
log_slave_updates=1  
### slave设置为只读（具有super权限的用户除外）
read_only=1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h5 id="_8、重启mysql-slave"><a href="#_8、重启mysql-slave" class="header-anchor">#</a> 8、重启mysql-slave</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> restart mysql-slave
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_9、在主数据库中查看主从同步状态"><a href="#_9、在主数据库中查看主从同步状态" class="header-anchor">#</a> 9、在主数据库中查看主从同步状态</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>show master status<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_10、进入从容器"><a href="#_10、进入从容器" class="header-anchor">#</a> 10、进入从容器</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it mysql-slave /bin/bash
mysql -uroot -proot
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="_11、在从数据库中配置主从复制"><a href="#_11、在从数据库中配置主从复制" class="header-anchor">#</a> 11、在从数据库中配置主从复制</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>change master to <span class="token assign-left variable">master_host</span><span class="token operator">=</span><span class="token string">'192.168.130.132'</span>, <span class="token assign-left variable">master_user</span><span class="token operator">=</span><span class="token string">'slave'</span>, <span class="token assign-left variable">master_password</span><span class="token operator">=</span><span class="token string">'123456'</span>, <span class="token assign-left variable">master_port</span><span class="token operator">=</span><span class="token number">3307</span>, <span class="token assign-left variable">master_log_file</span><span class="token operator">=</span><span class="token string">'mall-mysql-bin.000001'</span>, <span class="token assign-left variable">master_log_pos</span><span class="token operator">=</span><span class="token number">617</span>, <span class="token assign-left variable">master_connect_retry</span><span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>master_host：主数据库的IP地址；</li> <li>master_port：主数据库的运行端口；</li> <li>master_user：在主数据库创建的用于同步数据的用户账号；</li> <li>master_password：在主数据库创建的用于同步数据的用户密码；</li> <li>master_log_file：指定从数据库要复制数据的日志文件，通过查看主数据的状态，获取File参数；</li> <li>master_log_pos：指定从数据库从哪个位置开始复制数据，通过查看主数据的状态，获取Position参数；</li> <li>master_connect_retry：连接失败重试的时间间隔，单位为秒。</li></ul> <h5 id="_12、在从数据库中查看主从同步状态"><a href="#_12、在从数据库中查看主从同步状态" class="header-anchor">#</a> 12、在从数据库中查看主从同步状态</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>show slave status <span class="token punctuation">\</span>G<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20220421232112588.4fea847a.png" alt="image-20220421232112588"></p> <h5 id="_13、在从数据库中开启主从同步"><a href="#_13、在从数据库中开启主从同步" class="header-anchor">#</a> 13、在从数据库中开启主从同步</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> start slave<span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.06</span> sec<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="_14、查看从数据库状态"><a href="#_14、查看从数据库状态" class="header-anchor">#</a> 14、查看从数据库状态</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>show slave status <span class="token punctuation">\</span>G<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_15、主从复制测试"><a href="#_15、主从复制测试" class="header-anchor">#</a> 15、主从复制测试</h5> <h6 id="_1、主机新建库-使用库-新建表-插入数据"><a href="#_1、主机新建库-使用库-新建表-插入数据" class="header-anchor">#</a> 1、主机新建库-使用库-新建表-插入数据</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> create database <span class="token builtin class-name">test</span><span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> use <span class="token builtin class-name">test</span>
Database changed
mysql<span class="token operator">&gt;</span> create table t1<span class="token punctuation">(</span>id int, name varchar<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
Query OK, <span class="token number">0</span> rows affected <span class="token punctuation">(</span><span class="token number">0.04</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> insert into t1<span class="token punctuation">(</span>id, name<span class="token punctuation">)</span> values <span class="token punctuation">(</span><span class="token number">1</span>,<span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.01</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from t1<span class="token punctuation">;</span>
+------+-------+
<span class="token operator">|</span> <span class="token function">id</span>   <span class="token operator">|</span> name  <span class="token operator">|</span>
+------+-------+
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> hello <span class="token operator">|</span>
+------+-------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> 

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h6 id="_2、从机使用库-查看记录"><a href="#_2、从机使用库-查看记录" class="header-anchor">#</a> 2、从机使用库-查看记录</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>mysql<span class="token operator">&gt;</span> use <span class="token builtin class-name">test</span><span class="token punctuation">;</span>
Reading table information <span class="token keyword">for</span> completion of table and <span class="token function">column</span> names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> * from t1<span class="token punctuation">;</span>
+------+-------+
<span class="token operator">|</span> <span class="token function">id</span>   <span class="token operator">|</span> name  <span class="token operator">|</span>
+------+-------+
<span class="token operator">|</span>    <span class="token number">1</span> <span class="token operator">|</span> hello <span class="token operator">|</span>
+------+-------+
<span class="token number">1</span> row <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_2、redis集群"><a href="#_2、redis集群" class="header-anchor">#</a> 2、redis集群</h3> <blockquote><p>cluster(集群)模式-docker版  哈希槽分区进行亿级数据存储</p></blockquote> <h4 id="_1、场景"><a href="#_1、场景" class="header-anchor">#</a> 1、场景</h4> <blockquote><p>1~2亿条数据需要缓存，请问如何设计这个存储案例？</p> <p>单机单台100%不可能，肯定是分布式存储，用redis如何落地？</p></blockquote> <h5 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h5> <h6 id="_1、哈希取余分区"><a href="#_1、哈希取余分区" class="header-anchor">#</a> 1、哈希取余分区</h6> <p><img src="/assets/img/image-20220425225921158.59f3cc79.png" alt="image-20220425225921158"></p> <blockquote><p>2亿条记录就是2亿个k,v，我们单机不行必须要分布式多机，假设有3台机器构成一个集群，用户每次读写操作都是根据公式：
hash(key) % N个机器台数，计算出哈希值，用来决定数据映射到哪一个节点上。</p></blockquote> <p><strong>优点：</strong></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>简单粗暴，直接有效，只需要预估好数据规划好节点，例如3台、8台、10台，就能保证一段时间的数据支撑。使用Hash算法让固定的一部分请求落到同一台服务器上，这样每台服务器固定处理一部分请求（并维护这些请求的信息），起到负载均衡+分而治之的作用。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>缺点：</strong></p> <div class="language-\ line-numbers-mode"><pre class="language-text"><code> 原来规划好的节点，进行扩容或者缩容就比较麻烦了额，不管扩缩，每次数据变动导致节点有变动，映射关系需要重新进行计算，在服务器个数固定不变时没有问题，如果需要弹性扩容或故障停机的情况下，原来的取模公式就会发生变化：Hash(key)/3会变成Hash(key) /?。此时地址经过取余运算的结果将发生很大变化，根据公式获取的服务器也会变得不可控。
某个redis机器宕机了，由于台数数量变化，会导致hash取余全部数据重新洗牌。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h6 id="_2、一致性哈希算法分区"><a href="#_2、一致性哈希算法分区" class="header-anchor">#</a> 2、一致性哈希算法分区</h6> <blockquote><p>一致性哈希算法在1997年由麻省理工学院中提出的，设计目标是<strong>为了解决分布式缓存数据变动和映射问题，某个机器宕机了，分母数量改变了，自然取余数不OK了。</strong></p></blockquote> <p><strong>作用：</strong></p> <blockquote><p>提出一致性Hash解决方案。目的是当服务器个数发生变动时，尽量减少影响客户端到服务器的映射关系</p></blockquote> <p><strong>步骤：</strong></p> <ol><li><p>算法构建一致性哈希环</p> <p><strong>一致性哈希环</strong></p> <blockquote><p>​    一致性哈希算法必然有个hash函数并按照算法产生hash值，这个算法的所有可能哈希值会构成一个全量集，这个集合可以成为一个hash空间[0,2^32-1]，这个是一个线性空间，但是在算法中，我们通过适当的逻辑控制将它首尾相连(0 = 2^32),这样让它逻辑上形成了一个环形空间。</p> <p>它也是按照使用取模的方法，前面笔记介绍的节点取模法是对节点（服务器）的数量进行取模。而一致性Hash算法是对2^32 取模，简单来说，一致性Hash算法将整个哈希值空间组织成一个虚拟的圆环，如假设某哈希函数H的值空间为0-2^32-1 （即哈希值是一个32位无符号整形），整个哈希环如下图：整个空间按顺时针方向组织，圆环的正上方的点代表0，0点右侧的第一个点代表1，以此类推，2、3、4、……直到2^32-1 ，也就是说0点左侧的第一个点代表2^32-1， 0和2^32-1 在零点中方向重合，我们把这个由2^32个点组成的圆环称为Hash环。</p></blockquote> <p><img src="/assets/img/image-20220425230502555.78a87ba2.png" alt="image-20220425230502555"></p></li> <li><p>服务器IP节点映射</p> <p>节点映射</p> <blockquote><p>将集群中各个IP节点映射到环上的某一个位置。
将各个服务器使用Hash进行一个哈希，具体可以选择服务器的IP或主机名作为关键字进行哈希，这样每台机器就能确定其在哈希环上的位置。假如4个节点NodeA、B、C、D，经过IP地址的哈希函数计算(hash(ip))，使用IP地址哈希后在环空间的位置如下：</p></blockquote> <p><img src="/assets/img/image-20220425230647469.65931b6b.png" alt="image-20220425230647469"></p></li> <li><p>key落到服务器的落键规则</p> <blockquote><p>当我们需要存储一个kv键值对时，首先计算key的hash值，hash(key)，将这个key使用相同的函数Hash计算出哈希值并确定此数据在环上的位置，从此位置沿环顺时针“行走”，第一台遇到的服务器就是其应该定位到的服务器，并将该键值对存储在该节点上。
如我们有Object A、Object B、Object C、Object D四个数据对象，经过哈希计算后，在环空间上的位置如下：根据一致性Hash算法，数据A会被定为到Node A上，B被定为到Node B上，C被定为到Node C上，D被定为到Node D上。</p></blockquote> <p><img src="/assets/img/image-20220425230712127.00ba1eb3.png" alt="image-20220425230712127"></p></li></ol> <p><strong>优点：</strong></p> <p>1.一致性哈希算法的容错性</p> <blockquote><p>容错性
假设Node C宕机，可以看到此时对象A、B、D不会受到影响，只有C对象被重定位到Node D。一般的，在一致性Hash算法中，如果一台服务器不可用，则受影响的数据仅仅是此服务器到其环空间中前一台服务器（即沿着逆时针方向行走遇到的第一台服务器）之间数据，其它不会受到影响。简单说，就是C挂了，受到影响的只是B、C之间的数据，并且这些数据会转移到D进行存储。</p></blockquote> <p><img src="/assets/img/image-20220425230845392.bcde2640.png" alt="image-20220425230845392"></p> <p>2.一致性哈希算法的扩展性</p> <blockquote><p>扩展性
数据量增加了，需要增加一台节点NodeX，X的位置在A和B之间，那收到影响的也就是A到X之间的数据，重新把A到X的数据录入到X上即可，不会导致hash取余全部数据重新洗牌。</p></blockquote> <p><img src="/assets/img/image-20220425230934948.de76e541.png" alt="image-20220425230934948"></p> <p><strong>缺点：</strong></p> <blockquote><p>一致性哈希算法的数据倾斜问题</p> <p>一致性Hash算法在服务节点太少时，容易因为节点分布不均匀而造成数据倾斜（被缓存的对象大部分集中缓存在某一台服务器上）问题，
例如系统中只有两台服务器：</p></blockquote> <p><img src="/assets/img/image-20220425231012335.5b1384e1.png" alt="image-20220425231012335"></p> <p><strong>总结：</strong></p> <blockquote><p>为了在节点数目发生改变时尽可能少的迁移数据</p> <p>将所有的存储节点排列在收尾相接的Hash环上，每个key在计算Hash后会顺时针找到临近的存储节点存放。
而当有节点加入或退出时仅影响该节点在Hash环上顺时针相邻的后续节点。</p> <p><strong>优点</strong>    加入和删除节点只影响哈希环中顺时针方向的相邻的节点，对其他节点无影响。</p> <p><strong>缺点</strong>    数据的分布和节点的位置有关，因为这些节点不是均匀的分布在哈希环上的，所以数据在进行存储时达不到均匀分布的效果。</p></blockquote> <h6 id="_3、哈希槽分区"><a href="#_3、哈希槽分区" class="header-anchor">#</a> 3、哈希槽分区</h6> <blockquote><p>哈希槽实质就是一个数组，数组[0,2^14 -1]形成hash slot空间。</p> <p>**作用：**解决一致性哈希算法的数据倾斜问题</p></blockquote> <p>解决均匀分配的问题，在数据和节点之间又加入了一层，把这层称为哈希槽（slot），用于管理数据和节点之间的关系，现在就相当于节点上放的是槽，槽里放的是数据。</p> <p><img src="/assets/img/image-20220425231209394.89c70d6a.png" alt="image-20220425231209394"></p> <p>槽解决的是粒度问题，相当于把粒度变大了，这样便于数据移动。
哈希解决的是映射问题，使用key的哈希值来计算所在的槽，便于数据分配。</p> <p>####### 哈希槽的计算</p> <blockquote><p>Redis 集群中内置了 16384 个哈希槽，redis 会根据节点数量大致均等的将哈希槽映射到不同的节点。当需要在 Redis 集群中放置一个 key-value时，redis 先对 key 使用 crc16 算法算出一个结果，然后把结果对 16384 求余数，这样每个 key 都会对应一个编号在 0-16383 之间的哈希槽，也就是映射到某个节点上。如下代码，key之A 、B在Node2， key之C落在Node3上</p></blockquote> <p><img src="/assets/img/image-20220425231325048.3d64933f.png" alt="image-20220425231325048"></p> <p><img src="/assets/img/image-20220425231331746.d5f25a6f.png" alt="image-20220425231331746"></p> <h4 id="_2、3主3从集群配置"><a href="#_2、3主3从集群配置" class="header-anchor">#</a> 2、3主3从集群配置</h4> <h5 id="_1、启动docker"><a href="#_1、启动docker" class="header-anchor">#</a> 1、启动docker</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>systemctl start <span class="token function">docker</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_2、新建6个docker容器redis实例"><a href="#_2、新建6个docker容器redis实例" class="header-anchor">#</a> 2、新建6个docker容器redis实例</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d --name redis-node-1 --net <span class="token function">host</span> --privileged<span class="token operator">=</span>true -v /data/redis/share/redis-node-1:/data redis --cluster-enabled <span class="token function">yes</span> --appendonly <span class="token function">yes</span> --port <span class="token number">6381</span>
 
<span class="token function">docker</span> run -d --name redis-node-2 --net <span class="token function">host</span> --privileged<span class="token operator">=</span>true -v /data/redis/share/redis-node-2:/data redis --cluster-enabled <span class="token function">yes</span> --appendonly <span class="token function">yes</span> --port <span class="token number">6382</span>
 
<span class="token function">docker</span> run -d --name redis-node-3 --net <span class="token function">host</span> --privileged<span class="token operator">=</span>true -v /data/redis/share/redis-node-3:/data redis --cluster-enabled <span class="token function">yes</span> --appendonly <span class="token function">yes</span> --port <span class="token number">6383</span>
 
<span class="token function">docker</span> run -d --name redis-node-4 --net <span class="token function">host</span> --privileged<span class="token operator">=</span>true -v /data/redis/share/redis-node-4:/data redis --cluster-enabled <span class="token function">yes</span> --appendonly <span class="token function">yes</span> --port <span class="token number">6384</span>
 
<span class="token function">docker</span> run -d --name redis-node-5 --net <span class="token function">host</span> --privileged<span class="token operator">=</span>true -v /data/redis/share/redis-node-5:/data redis --cluster-enabled <span class="token function">yes</span> --appendonly <span class="token function">yes</span> --port <span class="token number">6385</span>
 
<span class="token function">docker</span> run -d --name redis-node-6 --net <span class="token function">host</span> --privileged<span class="token operator">=</span>true -v /data/redis/share/redis-node-6:/data redis --cluster-enabled <span class="token function">yes</span> --appendonly <span class="token function">yes</span> --port <span class="token number">6386</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker ps</span>
CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES
d6fc3ef2855b   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">3</span> seconds ago   Up <span class="token number">2</span> seconds             redis-node-6
9c8868d69a50   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">3</span> seconds ago   Up <span class="token number">3</span> seconds             redis-node-5
7fbb5345951a   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">4</span> seconds ago   Up <span class="token number">3</span> seconds             redis-node-4
d53b9d5af1ac   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">4</span> seconds ago   Up <span class="token number">4</span> seconds             redis-node-3
fe0e430cb940   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">6</span> seconds ago   Up <span class="token number">4</span> seconds             redis-node-2
ee03a7ec212e   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">8</span> seconds ago   Up <span class="token number">6</span> seconds             redis-node-1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h6 id="分步解释"><a href="#分步解释" class="header-anchor">#</a> 分步解释</h6> <ul><li><code>docker run</code>：创建并运行docker容器实例</li> <li><code>--name redis-node-6</code>：容器名字</li> <li><code>--net host</code> ：使用宿主机的IP和端口，默认、</li> <li><code>--privileged=true</code>：获取宿主机root用户权限</li> <li><code>-v /data/redis/share/redis-node-6:/data</code>：容器卷，宿主机地址:docker内部地址</li> <li><code>redis</code>：redis镜像和版本号</li> <li><code>--cluster-enabled yes</code>：开启redis集群</li> <li><code>--appendonly yes</code>：开启持久化</li> <li><code>--port 6386</code>：redis端口号</li></ul> <h5 id="_3、进入容器redis-node-1并为6台机器构建集群关系"><a href="#_3、进入容器redis-node-1并为6台机器构建集群关系" class="header-anchor">#</a> 3、进入容器redis-node-1并为6台机器构建集群关系</h5> <h6 id="_1、进入容器"><a href="#_1、进入容器" class="header-anchor">#</a> 1、进入容器</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it redis-node-1 /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h6 id="_2、构建主从关系"><a href="#_2、构建主从关系" class="header-anchor">#</a> 2、构建主从关系</h6> <p>PS：注意自己的真实IP地址</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster create <span class="token number">192.168</span>.130.132:6381 <span class="token number">192.168</span>.130.132:6382 <span class="token number">192.168</span>.130.132:6383 <span class="token number">192.168</span>.130.132:6384 <span class="token number">192.168</span>.130.132:6385 <span class="token number">192.168</span>.130.132:6386 --cluster-replicas <span class="token number">1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>--cluster-replicas 1</code>：表示为每个master创建一个slave节点</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker exec -it redis-node-1 /bin/bash</span>
root@docker:/data<span class="token comment">## redis-cli --cluster create 192.168.130.132:6381 192.168.130.132:6382 192.168.130.132:6383 192.168.130.132:6384 192.168.130.132:6385 192.168.130.132:6386 --cluster-replicas 1</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing <span class="token builtin class-name">hash</span> slots allocation on <span class="token number">6</span> nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">0</span> - <span class="token number">5460</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">5461</span> - <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">10923</span> - <span class="token number">16383</span>
Adding replica <span class="token number">192.168</span>.130.132:6385 to <span class="token number">192.168</span>.130.132:6381
Adding replica <span class="token number">192.168</span>.130.132:6386 to <span class="token number">192.168</span>.130.132:6382
Adding replica <span class="token number">192.168</span>.130.132:6384 to <span class="token number">192.168</span>.130.132:6383
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Trying to optimize slaves allocation <span class="token keyword">for</span> anti-affinity
<span class="token punctuation">[</span>WARNING<span class="token punctuation">]</span> Some slaves are <span class="token keyword">in</span> the same <span class="token function">host</span> as their master
M: 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
M: 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
M: 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384
   replicates 60fa7e084483feca3af41f269de5a57b526c0ad7
S: b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385
   replicates 8dbe8b347410cf87d62933382b73693405535ba1
S: 4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386
   replicates 8335b5349d781c11745ee129f5dbae370dbd3394
Can I <span class="token builtin class-name">set</span> the above configuration? <span class="token punctuation">(</span>type <span class="token string">'yes'</span> to accept<span class="token punctuation">)</span>: <span class="token function">yes</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Assign a different config epoch to each <span class="token function">node</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.130.132:6381<span class="token punctuation">)</span>
M: 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8dbe8b347410cf87d62933382b73693405535ba1
M: 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 60fa7e084483feca3af41f269de5a57b526c0ad7
M: 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8335b5349d781c11745ee129f5dbae370dbd3394
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
root@docker:/data<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><p>到这里，3主3从就构建完成了。</p> <h5 id="_4、链接进入6381作为切入点-查看集群状态"><a href="#_4、链接进入6381作为切入点-查看集群状态" class="header-anchor">#</a> 4、链接进入6381作为切入点，查看集群状态</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli -p 6381</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster info
cluster_state:ok
cluster_slots_assigned:16384
cluster_slots_ok:16384
cluster_slots_pfail:0
cluster_slots_fail:0
cluster_known_nodes:6
cluster_size:3
cluster_current_epoch:6
cluster_my_epoch:1
cluster_stats_messages_ping_sent:663
cluster_stats_messages_pong_sent:671
cluster_stats_messages_sent:1334
cluster_stats_messages_ping_received:666
cluster_stats_messages_pong_received:663
cluster_stats_messages_meet_received:5
cluster_stats_messages_received:1334
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster nodes
b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385@16385 slave 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">0</span> <span class="token number">1651152474000</span> <span class="token number">3</span> connected
8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381@16381 myself,master - <span class="token number">0</span> <span class="token number">1651152472000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383@16383 master - <span class="token number">0</span> <span class="token number">1651152474000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384@16384 slave 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">0</span> <span class="token number">1651152476585</span> <span class="token number">2</span> connected
60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382@16382 master - <span class="token number">0</span> <span class="token number">1651152475573</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386@16386 slave 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">0</span> <span class="token number">1651152474566</span> <span class="token number">1</span> connected
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h6 id="_1、cluster-info-查看集群状态"><a href="#_1、cluster-info-查看集群状态" class="header-anchor">#</a> 1、<code>cluster info</code>：查看集群状态</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster info
cluster_state:ok
cluster_slots_assigned:16384
cluster_slots_ok:16384
cluster_slots_pfail:0
cluster_slots_fail:0
cluster_known_nodes:6
cluster_size:3
cluster_current_epoch:6
cluster_my_epoch:1
cluster_stats_messages_ping_sent:663
cluster_stats_messages_pong_sent:671
cluster_stats_messages_sent:1334
cluster_stats_messages_ping_received:666
cluster_stats_messages_pong_received:663
cluster_stats_messages_meet_received:5
cluster_stats_messages_received:1334
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li><code>cluster_state</code>: <code>ok</code>状态表示集群可以正常接受查询请求。<code>fail</code> 状态表示，至少有一个哈希槽没有被绑定（说明有哈希槽没有被绑定到任意一个节点），或者在错误的状态（节点可以提供服务但是带有FAIL 标记），或者该节点无法联系到多数master节点。.</li> <li><code>cluster_slots_assigned</code>: 已分配到集群节点的哈希槽数量（不是没有被绑定的数量）。16384个哈希槽全部被分配到集群节点是集群正常运行的必要条件.</li> <li><code>cluster_slots_ok</code>: 哈希槽状态不是<code>FAIL</code> 和 <code>PFAIL</code> 的数量.</li> <li><code>cluster_slots_pfail</code>: 哈希槽状态是 <code>PFAIL</code>的数量。只要哈希槽状态没有被升级到<code>FAIL</code>状态，这些哈希槽仍然可以被正常处理。<code>PFAIL</code>状态表示我们当前不能和节点进行交互，但这种状态只是临时的错误状态。</li> <li><code>cluster_slots_fail</code>: 哈希槽状态是<code>FAIL</code>的数量。如果值不是0，那么集群节点将无法提供查询服务，除非<code>cluster-require-full-coverage</code>被设置为<code>no</code> .</li> <li><code>cluster_known_nodes</code>: 集群中节点数量，包括处于<code>握手</code>状态还没有成为集群正式成员的节点.</li> <li><code>cluster_size</code>: 至少包含一个哈希槽且能够提供服务的master节点数量.</li> <li><code>cluster_current_epoch</code>: 集群本地<code>Current Epoch</code>变量的值。这个值在节点故障转移过程时有用，它总是递增和唯一的。</li> <li><code>cluster_my_epoch</code>: 当前正在使用的节点的<code>Config Epoch</code>值. 这个是关联在本节点的版本值.</li> <li><code>cluster_stats_messages_sent</code>: 通过node-to-node二进制总线发送的消息数量.</li> <li><code>cluster_stats_messages_received</code>: 通过node-to-node二进制总线接收的消息数量.</li></ul> <h6 id="_2、cluster-nodes-提供了当前连接节点所属集群的配置信息-信息格式和redis集群在磁盘上存储使用的序列化格式完全一样-在磁盘存储信息的结尾还存储了一些额外信息"><a href="#_2、cluster-nodes-提供了当前连接节点所属集群的配置信息-信息格式和redis集群在磁盘上存储使用的序列化格式完全一样-在磁盘存储信息的结尾还存储了一些额外信息" class="header-anchor">#</a> 2、<code>cluster nodes</code>：提供了当前连接节点所属集群的配置信息，信息格式和Redis集群在磁盘上存储使用的序列化格式完全一样（在磁盘存储信息的结尾还存储了一些额外信息）</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> cluster nodes
b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385@16385 slave 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">0</span> <span class="token number">1651152474000</span> <span class="token number">3</span> connected
8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381@16381 myself,master - <span class="token number">0</span> <span class="token number">1651152472000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383@16383 master - <span class="token number">0</span> <span class="token number">1651152474000</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384@16384 slave 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">0</span> <span class="token number">1651152476585</span> <span class="token number">2</span> connected
60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382@16382 master - <span class="token number">0</span> <span class="token number">1651152475573</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386@16386 slave 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">0</span> <span class="token number">1651152474566</span> <span class="token number">1</span> connected
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>主从关系图：</p> <p><img src="/assets/img/image-20220428230338788.950a6e93.png" alt="image-20220428230338788"></p> <p>每行的组成：</p> <blockquote><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token operator">&lt;</span>id<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>ip:port<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>flags<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>master<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>ping-sent<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>pong-recv<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>config-epoch<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>link-state<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span> <span class="token punctuation">..</span>. <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></blockquote> <ol><li><code>id</code>: 节点ID,是一个40字节的随机字符串，这个值在节点启动的时候创建，并且永远不会改变（除非使用<code>CLUSTER RESET HARD</code>命令）。</li> <li><code>ip:port</code>: 客户端与节点通信使用的地址.</li> <li><code>flags</code>: 逗号分割的标记位，可能的值有: <code>myself</code>, <code>master</code>, <code>slave</code>, <code>fail?</code>, <code>fail</code>, <code>handshake</code>, <code>noaddr</code>, <code>noflags</code>. 下一部分将详细介绍这些标记.
<ul><li><code>myself</code>: 当前连接的节点.</li> <li><code>master</code>: 节点是master.</li> <li><code>slave</code>: 节点是slave.</li> <li><code>fail?</code>: 节点处于<code>PFAIL</code> 状态。 当前节点无法联系，但逻辑上是可达的 (非 <code>FAIL</code> 状态).</li> <li><code>fail</code>: 节点处于<code>FAIL</code> 状态. 大部分节点都无法与其取得联系将会将改节点由 <code>PFAIL</code> 状态升级至<code>FAIL</code>状态。</li> <li><code>handshake</code>: 还未取得信任的节点，当前正在与其进行握手.</li> <li><code>noaddr</code>: 没有地址的节点（No address known for this node）.</li> <li><code>noflags</code>: 连个标记都没有（No flags at all）.</li></ul></li> <li><code>master</code>: 如果节点是slave，并且已知master节点，则这里列出master节点ID,否则的话这里列出”-“。</li> <li><code>ping-sent</code>: 最近一次发送ping的时间，这个时间是一个unix毫秒时间戳，0代表没有发送过.</li> <li><code>pong-recv</code>: 最近一次收到pong的时间，使用unix时间戳表示.</li> <li><code>config-epoch</code>: 节点的epoch值（or of the current master if the node is a slave）。每当节点发生失败切换时，都会创建一个新的，独特的，递增的epoch。如果多个节点竞争同一个哈希槽时，epoch值更高的节点会抢夺到。</li> <li><code>link-state</code>: node-to-node集群总线使用的链接的状态，我们使用这个链接与集群中其他节点进行通信.值可以是 <code>connected</code> 和 <code>disconnected</code>.</li> <li><code>slot</code>: 哈希槽值或者一个哈希槽范围. 从第9个参数开始，后面最多可能有16384个 数(limit never reached)。代表当前节点可以提供服务的所有哈希槽值。如果只是一个值,那就是只有一个槽会被使用。如果是一个范围，这个值表示为<code>起始槽-结束槽</code>，节点将处理包括起始槽和结束槽在内的所有哈希槽。</li></ol> <blockquote><p>官方地址：http://www.redis.cn/commands/cluster-info.html</p></blockquote> <h4 id="_3、主从容错切换迁移案例"><a href="#_3、主从容错切换迁移案例" class="header-anchor">#</a> 3、主从容错切换迁移案例</h4> <h5 id="_1、数据读写存储"><a href="#_1、数据读写存储" class="header-anchor">#</a> 1、数据读写存储</h5> <h6 id="_1、启动6机构成的集群并通过exec进入"><a href="#_1、启动6机构成的集群并通过exec进入" class="header-anchor">#</a> 1、启动6机构成的集群并通过exec进入</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli -p 6381</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> MOVED <span class="token number">12706</span> <span class="token number">192.168</span>.130.132:6383
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token builtin class-name">set</span> k2 v2<span class="token punctuation">\</span>
OK
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token builtin class-name">set</span> k3 v3
OK
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token builtin class-name">set</span> k4 v4
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> MOVED <span class="token number">8455</span> <span class="token number">192.168</span>.130.132:6382
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>显示k1和k4没有存储进去</p> <p><code>(error) MOVED 12706 192.168.130.132:6383</code>：请转到6383的redis进行存储</p> <h6 id="_2、防止路由失效加参数-c并新增两个key"><a href="#_2、防止路由失效加参数-c并新增两个key" class="header-anchor">#</a> 2、防止路由失效加参数-c并新增两个key</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli -p 6381 -c</span>
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> <span class="token builtin class-name">set</span> k1 v1
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">12706</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.130.132:6383
OK
<span class="token number">192.168</span>.130.132:638<span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span> <span class="token builtin class-name">set</span> k4 v4
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">8455</span><span class="token punctuation">]</span> located at <span class="token number">192.168</span>.130.132:6382
OK
<span class="token number">192.168</span>.130.132:638<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> get k4
<span class="token string">&quot;v4&quot;</span>
<span class="token number">192.168</span>.130.132:638<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><code>Redirected to slot [8455] located at 192.168.130.132:6382</code>：重定向到6382</p> <h6 id="_3、查看集群状态"><a href="#_3、查看集群状态" class="header-anchor">#</a> 3、查看集群状态</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster check <span class="token number">192.168</span>.130.132:6381
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli --cluster check 192.168.130.132:6381</span>
<span class="token number">192.168</span>.130.132:6381 <span class="token punctuation">(</span>8335b534<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">2</span> keys <span class="token operator">|</span> <span class="token number">5461</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6383 <span class="token punctuation">(</span>8dbe8b34<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">5461</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6382 <span class="token punctuation">(</span>60fa7e08<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">5462</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token number">4</span> keys <span class="token keyword">in</span> <span class="token number">3</span> masters.
<span class="token number">0.00</span> keys per slot on average.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.130.132:6381<span class="token punctuation">)</span>
M: 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8dbe8b347410cf87d62933382b73693405535ba1
M: 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 60fa7e084483feca3af41f269de5a57b526c0ad7
M: 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8335b5349d781c11745ee129f5dbae370dbd3394
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
root@docker:/data<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h5 id="_2、容错切换迁移"><a href="#_2、容错切换迁移" class="header-anchor">#</a> 2、容错切换迁移</h5> <h6 id="_1、主6381和从机切换-先停止主机6381"><a href="#_1、主6381和从机切换-先停止主机6381" class="header-anchor">#</a> 1、主6381和从机切换，先停止主机6381</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker stop redis-node-1</span>
redis-node-1
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker ps</span>
CONTAINER ID   IMAGE     COMMAND                  CREATED        STATUS        PORTS     NAMES
d6fc3ef2855b   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">47</span> hours ago   Up <span class="token number">47</span> hours             redis-node-6
9c8868d69a50   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">47</span> hours ago   Up <span class="token number">47</span> hours             redis-node-5
7fbb5345951a   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">47</span> hours ago   Up <span class="token number">47</span> hours             redis-node-4
d53b9d5af1ac   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">47</span> hours ago   Up <span class="token number">47</span> hours             redis-node-3
fe0e430cb940   redis     <span class="token string">&quot;docker-entrypoint.s…&quot;</span>   <span class="token number">47</span> hours ago   Up <span class="token number">47</span> hours             redis-node-2
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>6381主机停了，对应的真实从机上位，也就是6号机变成了主机器</p> <h6 id="_2、查看集群情况"><a href="#_2、查看集群情况" class="header-anchor">#</a> 2、查看集群情况</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> cluster nodes
4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386@16386 master - <span class="token number">0</span> <span class="token number">1651158299456</span> <span class="token number">7</span> connected <span class="token number">0</span>-5460
c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384@16384 slave 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">0</span> <span class="token number">1651158300472</span> <span class="token number">2</span> connected
60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382@16382 myself,master - <span class="token number">0</span> <span class="token number">1651158298000</span> <span class="token number">2</span> connected <span class="token number">5461</span>-10922
8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383@16383 master - <span class="token number">0</span> <span class="token number">1651158298444</span> <span class="token number">3</span> connected <span class="token number">10923</span>-16383
8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381@16381 master,fail - <span class="token number">1651154146064</span> <span class="token number">1651154140969</span> <span class="token number">1</span> disconnected
b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385@16385 slave 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">0</span> <span class="token number">1651158297000</span> <span class="token number">3</span> connected
<span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h6 id="_3、恢复3主3从"><a href="#_3、恢复3主3从" class="header-anchor">#</a> 3、恢复3主3从</h6> <p>重新启动1号机之后，6号机还是主机，1号机器从之前的主机变成了从机</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> start redis-node-1
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20220428230839306.11d3dbf3.png" alt="image-20220428230839306"></p> <p>停掉6号机，再启动6号机</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> stop redis-node-6
<span class="token function">docker</span> start redis-node-6
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>查看集群状态</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli --cluster check 192.168.130.132:6381</span>
<span class="token number">192.168</span>.130.132:6381 <span class="token punctuation">(</span>8335b534<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">2</span> keys <span class="token operator">|</span> <span class="token number">5461</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6382 <span class="token punctuation">(</span>60fa7e08<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">5462</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6383 <span class="token punctuation">(</span>8dbe8b34<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">5461</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token number">4</span> keys <span class="token keyword">in</span> <span class="token number">3</span> masters.
<span class="token number">0.00</span> keys per slot on average.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.130.132:6381<span class="token punctuation">)</span>
M: 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 60fa7e084483feca3af41f269de5a57b526c0ad7
S: 4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8335b5349d781c11745ee129f5dbae370dbd3394
M: 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8dbe8b347410cf87d62933382b73693405535ba1
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
root@docker:/data<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h4 id="_4、主从扩容案例"><a href="#_4、主从扩容案例" class="header-anchor">#</a> 4、主从扩容案例</h4> <h5 id="_1、新建6387、6388两个节点-新建后启动-查看是否8节点"><a href="#_1、新建6387、6388两个节点-新建后启动-查看是否8节点" class="header-anchor">#</a> 1、新建6387、6388两个节点+新建后启动+查看是否8节点</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d --name redis-node-7 --net <span class="token function">host</span> --privileged<span class="token operator">=</span>true -v /data/redis/share/redis-node-7:/data redis --cluster-enabled <span class="token function">yes</span> --appendonly <span class="token function">yes</span> --port <span class="token number">6387</span>
<span class="token function">docker</span> run -d --name redis-node-8 --net <span class="token function">host</span> --privileged<span class="token operator">=</span>true -v /data/redis/share/redis-node-8:/data redis --cluster-enabled <span class="token function">yes</span> --appendonly <span class="token function">yes</span> --port <span class="token number">6388</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="_2、进入6387容器实例内部"><a href="#_2、进入6387容器实例内部" class="header-anchor">#</a> 2、进入6387容器实例内部</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it redis-node-7 /bin/bash
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_3、将新增的6387节点-空槽号-作为master节点加入原集群"><a href="#_3、将新增的6387节点-空槽号-作为master节点加入原集群" class="header-anchor">#</a> 3、将新增的6387节点(空槽号)作为master节点加入原集群</h5> <blockquote><p>将新增的6387作为master节点加入集群
redis-cli --cluster add-node 自己实际IP地址:6387 自己实际IP地址:6381
6387 就是将要作为master新增节点
6381 就是原来集群节点里面的领路人，相当于6387拜拜6381的码头从而找到组织加入集群</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster add-node <span class="token number">192.168</span>.130.132:6387 <span class="token number">192.168</span>.130.132:6381
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli --cluster add-node 192.168.130.132:6387 192.168.130.132:6381</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Adding <span class="token function">node</span> <span class="token number">192.168</span>.130.132:6387 to cluster <span class="token number">192.168</span>.130.132:6381
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.130.132:6381<span class="token punctuation">)</span>
M: 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 60fa7e084483feca3af41f269de5a57b526c0ad7
S: 4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8335b5349d781c11745ee129f5dbae370dbd3394
M: 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8dbe8b347410cf87d62933382b73693405535ba1
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Send CLUSTER MEET to <span class="token function">node</span> <span class="token number">192.168</span>.130.132:6387 to <span class="token function">make</span> it <span class="token function">join</span> the cluster.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> New <span class="token function">node</span> added correctly.
root@docker:/data<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h5 id="_4、检查集群情况"><a href="#_4、检查集群情况" class="header-anchor">#</a> 4、检查集群情况</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster check <span class="token number">192.168</span>.130.132:6381
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli --cluster check 192.168.130.132:6381</span>
<span class="token number">192.168</span>.130.132:6381 <span class="token punctuation">(</span>8335b534<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">2</span> keys <span class="token operator">|</span> <span class="token number">5461</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6382 <span class="token punctuation">(</span>60fa7e08<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">5462</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6383 <span class="token punctuation">(</span>8dbe8b34<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">5461</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6387 <span class="token punctuation">(</span>34b689b7<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">0</span> keys <span class="token operator">|</span> <span class="token number">0</span> slots <span class="token operator">|</span> <span class="token number">0</span> slaves.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>很明显，6387没有槽号</p> <h5 id="_5、重新分配槽号"><a href="#_5、重新分配槽号" class="header-anchor">#</a> 5、重新分配槽号</h5> <blockquote><p>重新分派槽号
命令：<code>redis-cli --cluster reshard IP地址:端口号</code></p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster reshard <span class="token number">192.168</span>.130.:6381
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>输入需要迁移的槽数量，此处我们输入4096。</p> <p>目标节点ID，只能指定一个，因为我们需要迁移到6387中，因此下面输入6387的ID。</p> <p><img src="/assets/img/1460000038771820.8c755712.jpeg" alt="img"></p> <p>之后输入源节点的ID，redis会从这些源节点中平均取出对应数量的槽，然后迁移到6385中。最后要输入<code>done</code>表示结束。</p> <p>最后输入yes即可。</p> <h5 id="_6、检查集群情况"><a href="#_6、检查集群情况" class="header-anchor">#</a> 6、检查集群情况</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster check <span class="token number">192.168</span>.130.132:6381
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli --cluster check 192.168.130.132:6381</span>
<span class="token number">192.168</span>.130.132:6381 <span class="token punctuation">(</span>8335b534<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6382 <span class="token punctuation">(</span>60fa7e08<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6383 <span class="token punctuation">(</span>8dbe8b34<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6387 <span class="token punctuation">(</span>34b689b7<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">0</span> slaves.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token number">4</span> keys <span class="token keyword">in</span> <span class="token number">4</span> masters.
<span class="token number">0.00</span> keys per slot on average.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.130.132:6381<span class="token punctuation">)</span>
M: 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381
   slots:<span class="token punctuation">[</span><span class="token number">1365</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 60fa7e084483feca3af41f269de5a57b526c0ad7
S: 4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8335b5349d781c11745ee129f5dbae370dbd3394
M: 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382
   slots:<span class="token punctuation">[</span><span class="token number">6827</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383
   slots:<span class="token punctuation">[</span><span class="token number">12288</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 34b689b791d9945a0b761349f1bc7b64f0be876f <span class="token number">192.168</span>.130.132:6387
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-1364<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">5461</span>-6826<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">10923</span>-12287<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
S: b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8dbe8b347410cf87d62933382b73693405535ba1
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
root@docker:/data<span class="token comment">## </span>
<span class="token punctuation">\</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>M: 34b689b791d9945a0b761349f1bc7b64f0be876f 192.168.130.132:6387
   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>为什么6387是3个新的区间，以前的还是连续？
重新分配成本太高，所以前3家各自匀出来一部分，从6381/6382/6383三个旧节点分别匀出1364个坑位给新节点6387</p> <h5 id="_7、为主节点6387分配从节点6388"><a href="#_7、为主节点6387分配从节点6388" class="header-anchor">#</a> 7、为主节点6387分配从节点6388</h5> <blockquote><p>命令：<code>redis-cli --cluster add-node ip:新slave端口 ip:新master端口 --cluster-slave --cluster-master-id 新主机节点ID</code></p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster add-node <span class="token number">192.168</span>.130.132:6388 <span class="token number">192.168</span>.130.132:6387 --cluster-slave --cluster-master-id 34b689b791d9945a0b761349f1bc7b64f0be876f
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_8、检查集群情况"><a href="#_8、检查集群情况" class="header-anchor">#</a> 8、检查集群情况</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster check <span class="token number">192.168</span>.130.132:6381
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli --cluster check 192.168.130.132:6381</span>
<span class="token number">192.168</span>.130.132:6381 <span class="token punctuation">(</span>8335b534<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6382 <span class="token punctuation">(</span>60fa7e08<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6383 <span class="token punctuation">(</span>8dbe8b34<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6387 <span class="token punctuation">(</span>34b689b7<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token number">4</span> keys <span class="token keyword">in</span> <span class="token number">4</span> masters.
<span class="token number">0.00</span> keys per slot on average.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.130.132:6381<span class="token punctuation">)</span>
M: 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381
   slots:<span class="token punctuation">[</span><span class="token number">1365</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 60fa7e084483feca3af41f269de5a57b526c0ad7
S: 4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8335b5349d781c11745ee129f5dbae370dbd3394
M: 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382
   slots:<span class="token punctuation">[</span><span class="token number">6827</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383
   slots:<span class="token punctuation">[</span><span class="token number">12288</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 4b4b4a8a4d50548e954b46e921ff8085ed555c39 <span class="token number">192.168</span>.130.132:6388
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 34b689b791d9945a0b761349f1bc7b64f0be876f
M: 34b689b791d9945a0b761349f1bc7b64f0be876f <span class="token number">192.168</span>.130.132:6387
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-1364<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">5461</span>-6826<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">10923</span>-12287<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8dbe8b347410cf87d62933382b73693405535ba1
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
root@docker:/data<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br></div></div><p>6387存在一个子机器</p> <h4 id="_5、主从缩容案例"><a href="#_5、主从缩容案例" class="header-anchor">#</a> 5、主从缩容案例</h4> <blockquote><p>目的：6387和6388下线</p></blockquote> <h5 id="_1、检查集群情况1获得6388的节点id"><a href="#_1、检查集群情况1获得6388的节点id" class="header-anchor">#</a> 1、检查集群情况1获得6388的节点ID</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster check <span class="token number">192.168</span>.130.132:6382
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>S: 4b4b4a8a4d50548e954b46e921ff8085ed555c39 <span class="token number">192.168</span>.130.132:6388
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 34b689b791d9945a0b761349f1bc7b64f0be876f
M: 34b689b791d9945a0b761349f1bc7b64f0be876f <span class="token number">192.168</span>.130.132:6387
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-1364<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">5461</span>-6826<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">10923</span>-12287<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8dbe8b347410cf87d62933382b73693405535ba1
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
root@docker:/data<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>节点ID为：<code>4b4b4a8a4d50548e954b46e921ff8085ed555c39</code></p> <h5 id="_2、从集群中将节点6388删除"><a href="#_2、从集群中将节点6388删除" class="header-anchor">#</a> 2、从集群中将节点6388删除</h5> <blockquote><p>命令：<code>redis-cli --cluster del-node ip:从机端口 从机6388节点ID</code></p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster del-node <span class="token number">192.168</span>.130.132:6388 4b4b4a8a4d50548e954b46e921ff8085ed555c39
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>oot@docker:/data<span class="token comment">## redis-cli --cluster del-node 192.168.130.132:6388 4b4b4a8a4d50548e954b46e921ff8085ed555c39</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Removing <span class="token function">node</span> 4b4b4a8a4d50548e954b46e921ff8085ed555c39 from cluster <span class="token number">192.168</span>.130.132:6388
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER FORGET messages to the cluster<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER RESET SOFT to the deleted node.
root@docker:/data<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>检查集群情况</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster check <span class="token number">192.168</span>.130.132:6381
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli --cluster check 192.168.130.132:6381</span>
<span class="token number">192.168</span>.130.132:6381 <span class="token punctuation">(</span>8335b534<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6382 <span class="token punctuation">(</span>60fa7e08<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6383 <span class="token punctuation">(</span>8dbe8b34<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6387 <span class="token punctuation">(</span>34b689b7<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">0</span> slaves.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token number">4</span> keys <span class="token keyword">in</span> <span class="token number">4</span> masters.
<span class="token number">0.00</span> keys per slot on average.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.130.132:6381<span class="token punctuation">)</span>
M: 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381
   slots:<span class="token punctuation">[</span><span class="token number">1365</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 60fa7e084483feca3af41f269de5a57b526c0ad7
S: 4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8335b5349d781c11745ee129f5dbae370dbd3394
M: 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382
   slots:<span class="token punctuation">[</span><span class="token number">6827</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383
   slots:<span class="token punctuation">[</span><span class="token number">12288</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 34b689b791d9945a0b761349f1bc7b64f0be876f <span class="token number">192.168</span>.130.132:6387
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-1364<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">5461</span>-6826<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">10923</span>-12287<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
S: b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8dbe8b347410cf87d62933382b73693405535ba1
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
root@docker:/data<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>很明显，6387的从机器已经被没了，6388机器也已经被删除了，只剩下7台机器了。</p> <h5 id="_3、将6387的槽号清空-重新分配-本例将清出来的槽号都给6381"><a href="#_3、将6387的槽号清空-重新分配-本例将清出来的槽号都给6381" class="header-anchor">#</a> 3、将6387的槽号清空，重新分配，本例将清出来的槽号都给6381</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster reshard <span class="token number">192.168</span>.130.132:6381
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这里我没有截到图，以阳哥的截图步骤</p> <p><img src="/assets/img/image-20220430204144560.9e7f0db5.png" alt="image-20220430204144560"></p> <p><img src="/assets/img/image-20220430204153835.51c85216.png" alt="image-20220430204153835"></p> <p><img src="data:image/png;base64,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" alt="image-20220430204205298"></p> <h5 id="_4、查看集群状态"><a href="#_4、查看集群状态" class="header-anchor">#</a> 4、查看集群状态</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster check <span class="token number">192.168</span>.130.132:6381
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli --cluster check 192.168.130.132:6381</span>
<span class="token number">192.168</span>.130.132:6381 <span class="token punctuation">(</span>8335b534<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">2</span> keys <span class="token operator">|</span> <span class="token number">8192</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6382 <span class="token punctuation">(</span>60fa7e08<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6383 <span class="token punctuation">(</span>8dbe8b34<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6387 <span class="token punctuation">(</span>34b689b7<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">0</span> keys <span class="token operator">|</span> <span class="token number">0</span> slots <span class="token operator">|</span> <span class="token number">0</span> slaves.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token number">4</span> keys <span class="token keyword">in</span> <span class="token number">4</span> masters.
<span class="token number">0.00</span> keys per slot on average.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.130.132:6381<span class="token punctuation">)</span>
M: 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-6826<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">10923</span>-12287<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">8192</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 60fa7e084483feca3af41f269de5a57b526c0ad7
S: 4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8335b5349d781c11745ee129f5dbae370dbd3394
M: 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382
   slots:<span class="token punctuation">[</span><span class="token number">6827</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383
   slots:<span class="token punctuation">[</span><span class="token number">12288</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 34b689b791d9945a0b761349f1bc7b64f0be876f <span class="token number">192.168</span>.130.132:6387
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> master
S: b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8dbe8b347410cf87d62933382b73693405535ba1
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>6381拥有8192个槽位</p> <h5 id="_5、将6387删除"><a href="#_5、将6387删除" class="header-anchor">#</a> 5、将6387删除</h5> <blockquote><p>命令：<code>redis-cli --cluster del-node ip:端口 6387节点ID</code></p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster del-node <span class="token number">192.168</span>.130.132:6387 34b689b791d9945a0b761349f1bc7b64f0be876f
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>再次检查集群情况</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>redis-cli --cluster check <span class="token number">192.168</span>.130.132:6381
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@docker:/data<span class="token comment">## redis-cli --cluster check 192.168.130.132:6381</span>
<span class="token number">192.168</span>.130.132:6381 <span class="token punctuation">(</span>8335b534<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">2</span> keys <span class="token operator">|</span> <span class="token number">8192</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6382 <span class="token punctuation">(</span>60fa7e08<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">192.168</span>.130.132:6383 <span class="token punctuation">(</span>8dbe8b34<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">1</span> keys <span class="token operator">|</span> <span class="token number">4096</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token number">4</span> keys <span class="token keyword">in</span> <span class="token number">3</span> masters.
<span class="token number">0.00</span> keys per slot on average.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using <span class="token function">node</span> <span class="token number">192.168</span>.130.132:6381<span class="token punctuation">)</span>
M: 8335b5349d781c11745ee129f5dbae370dbd3394 <span class="token number">192.168</span>.130.132:6381
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-6826<span class="token punctuation">]</span>,<span class="token punctuation">[</span><span class="token number">10923</span>-12287<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">8192</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: c366905ca5ec2472275bbea9b2ae9b642b92a737 <span class="token number">192.168</span>.130.132:6384
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 60fa7e084483feca3af41f269de5a57b526c0ad7
S: 4051766aa375f0ed4533cb729afa8daf8649f5d2 <span class="token number">192.168</span>.130.132:6386
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8335b5349d781c11745ee129f5dbae370dbd3394
M: 60fa7e084483feca3af41f269de5a57b526c0ad7 <span class="token number">192.168</span>.130.132:6382
   slots:<span class="token punctuation">[</span><span class="token number">6827</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: 8dbe8b347410cf87d62933382b73693405535ba1 <span class="token number">192.168</span>.130.132:6383
   slots:<span class="token punctuation">[</span><span class="token number">12288</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">4096</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: b5fd469dd1f8b5a64cacd5ecaed9dd396e1b9217 <span class="token number">192.168</span>.130.132:6385
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8dbe8b347410cf87d62933382b73693405535ba1
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
root@docker:/data<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>发现已经删除了</p> <h2 id="_10、dockerfile解析"><a href="#_10、dockerfile解析" class="header-anchor">#</a> 10、DockerFile解析</h2> <h3 id="_1、什么是dockerfile"><a href="#_1、什么是dockerfile" class="header-anchor">#</a> 1、什么是DockerFile</h3> <blockquote><p>DockerFile是用来构建Docker镜像的文本文件，是由一条条构建镜像所需的指令和参数构成的脚本。</p> <p>官网：https://docs.docker.com/engine/reference/builder/</p></blockquote> <p><img src="/assets/img/image-20220430222420653.2c772016.png" alt="image-20220430222420653"></p> <p>构建步骤：</p> <ul><li>编写Dockerfile文件</li> <li>docker build命令构建镜像</li> <li>docker run依镜像运行容器实例</li></ul> <h3 id="_2、dockerfile构建过程解析"><a href="#_2、dockerfile构建过程解析" class="header-anchor">#</a> 2、DockerFile构建过程解析</h3> <h4 id="_1、dockerfile内容基础知识"><a href="#_1、dockerfile内容基础知识" class="header-anchor">#</a> 1、Dockerfile内容基础知识</h4> <blockquote><ol><li>每条保留字指令都必须为大写字母且后面要跟随至少一个参数</li> <li>指令按照从上到下，顺序执行</li> <li>表示注释</li> <li>每条指令都会创建一个新的镜像层并对镜像进行提交</li></ol></blockquote> <h4 id="_2、docker执行dockerfile的大致流程"><a href="#_2、docker执行dockerfile的大致流程" class="header-anchor">#</a> 2、Docker执行Dockerfile的大致流程</h4> <blockquote><ol><li>docker从基础镜像运行一个容器</li> <li>执行一条指令并对容器作出修改</li> <li>执行类似docker commit的操作提交一个新的镜像层</li> <li>docker再基于刚提交的镜像运行一个新容器</li> <li>执行dockerfile中的下一条指令直到所有指令都执行完成</li></ol></blockquote> <h4 id="_3、总结-2"><a href="#_3、总结-2" class="header-anchor">#</a> 3、总结</h4> <p>从应用软件的角度来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段，</p> <ul><li>Dockerfile是软件的原材料</li> <li>Docker镜像是软件的交付品</li> <li>Docker容器则可以认为是软件镜像的运行态，也即依照镜像运行的容器实例</li></ul> <blockquote><p>Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。</p></blockquote> <p><img src="/assets/img/image-20220510225719141.789968ff.png" alt="image-20220510225719141"></p> <ul><li>Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;</li> <li>Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行 Docker镜像时会真正开始提供服务;</li> <li>Docker容器，容器是直接提供服务的。</li></ul> <h3 id="_3、docker常用保留字指令"><a href="#_3、docker常用保留字指令" class="header-anchor">#</a> 3、Docker常用保留字指令</h3> <blockquote><p><a href="http://www.dockerinfo.net/dockerfile%E4%BB%8B%E7%BB%8D" target="_blank" rel="noopener noreferrer">Docker中文文档 Dockerfile介绍-DockerInfo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <ul><li><p><code>FROM</code>：基础镜像，当前新镜像是基于哪个镜像的，指定一个已经存在的镜像作为模板，第一条必须是from</p></li> <li><p><code>MAINTAINER</code>：镜像维护者的姓名和邮箱地址</p></li> <li><p><code>RUN</code>：容器构建时需要运行的命令</p> <blockquote><p>RUN是在 docker build时运行</p></blockquote> <ul><li><p><code>shell格式</code>：例如 <code>RUN yum -y install vim</code></p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAecAAABSCAYAAABufRwmAAALG0lEQVR4nO3dT2iUdx7H8Y+rc3sQepAEEmsk0EBW2XZZTA4bStIedqFYA9UmgaToYi9xu9BDUNoMMrYoHtotm1wqrnQKpomHZO2hHmxK0UPiFtrFVrBgiFUhkoMgc0vL7CEzZvLkeZ75PX/meZ5J3i8I7czz/H6/rzPP8/vO788k24rFYlEAACA1fpd0AAAAYL0dkrSwsJB0HAAAoGSH24GGhoY44wAAACVMawMAkDIkZwAAUobkDABAypCcAQBIGZIzAAApQ3IGACBlSM4AAKQMyRkAgJQhOQMAkDIkZwAAUobkDABAyrj+bu3t27fHGQcAAChxTc47drgeAgAANcS0NgAAKUNyBgAgZUjOAACkDMnZwPBwJvbyYduMsq4oYwEAVEdyrmJ4OKPx8ZXACSpI+XKZysdOP7VqP8ryAAD/thWLxeLCwsKGA88//3wC4aSLU5KsfFyL8n7biLr9KMsDAIKJaeS8pIn+jDKZyp+zmrMdP/LF0vpSXxxRpn9CS5LmPlwtd3a+4oT5s8+OR6k8MrUnovII0mQU6VXepEyYkWpS8QMAohHrl5l7P3+gqb5GSavJtqu/RQ8m+tVoWsEbvfr++pzU0VmT+MqJxytB2o85jSTtSbbynHKCcyoXdlSadPwAgGgk9ptGOl/NSacXtTgh8+S8r1e9P36kiYdT6m8OH8MPFzO6oBsa/9tqsncaKbpxS2r2Y07JrHIEapIcvdjrTTb+OV0Y7pLeXtHxP3iGDQDwkFByXtLEP7PS6RvyNwbeq+7XpXduLqm/zzilO7Z/LbdbXyqv0Wx0o3A/o0m3c+3J2H5eLUet4ePv1PFsXmdyGZ157YFG/xrmPQKArSvW5Dw9uFuZwdKD0ze08p7/xNjY965e6v9GS30+psMrPZ7QmdyQlv64NmKu5DYV7DVFbFJHtaRbPifsum6S8UuSGvo1Or5XF4Z3a/i/eY1mA75PALCFJbLmPPdhRl2Ba+lU974uXZrv1ym/Rf93VsOfZvXi2ysa9Zh2te9Qrva8V3knbmWjGhEnFf+aTh0ff6Brud06M7yo4+On9GKVEgCANYl8z7nzrbx6T39TsVvbZ/lXc8pe91t6Sdf+kw3YYnTqfTOVefyNamySpKy+/Crq/fQAsLkl80tImvv17umsPvrCoNPet3fjtGjHUeV/9JvcG/WX7IrGs3ktfZrR8MWgHw2C2zqJeU4XhjO68Civ0fEV1p4BwKdEd2tP//mS5vpOqVON6n69V0OD5ceSHk7oncFp5W5OOZRuVPfr3+vS9Zf8N9zQr9Hxbl3L7dZwznlNNIrv8tqnk+NMzInGX1rT12sPNE5SBoBAkvujzR1HlX9jt7o+7NbKe51q7JvSjXsZdWXWpp5zN1d0qsO5eGPfu1KmS3ojH6Dx1VF048WMzlzcu2FjmNfarGniM13frYXk4p/ThdyQGvkqFQCEwq/vNBTFyNfru83V2nLb2OWn7bjiBwCEQ3IGACBl+KtUAACkDMkZAICUITkDAJAyJGcAAFKG5AwAQMq4fs/5119/jTMOAABQ4pqcf/vttzjjAAAAJUxrAwCQMiRnAABShuQMAEDKbInkPGZZsZcP22aUdUUZS5j2TOIYsyxfP2kX1bXjpx6vc03fA/tjv6975TlJvAZbUb31E/CW3F+lismYZelEofDsv3GUt5/rdtGb1JdE/FGo/Dd7vRZOMfl5nU2ecxPn6xEn+/vt9t77uSZMrmckp177Cbjb1Mm58kILcuEFKe90TtCLPYn4w3K7yU2SRRTCJqEwgswY2OPyitXtA08cajUq8/t+mXy422rqsZ9AdbEm5+UrA/pKH2vocIPunLP0Xes9DR1uiLyd8g3slCTdjjnV4Vbeq+OIIgElFX9Ybje5vU2TOKolgzR2Hn4SrRO368d0JsZpOtpv+05l/b7WTrGbxlKOwf5BxKl89CP4ec1Yr0izBR06ELCKR1PKtx3T09LD5g11rbbxsPRo56XgfWC99hMws6lGzvYL0unmtR+r9sndT2IJezEnHX9YfmYMqrVf7x2DWzIx6SydypgkOdMPO9VGsfbrp/J4HKN3+weRukoUTUc0VDiiZ4l+gw4dKhQkPda3g626H6CJeu8nYCbekfO9q1Lrx5Iea/knaWdPiFHzoynl22a05+5lvdy0+lTY5OB0IXuN/Lzq8bpx3OJIOv7lKwOavHpIb35+RLs8o/ZmshbMTb+RU0cZxXRl2NfaKSmbjN6j6ty5VtZLup9APOJJzrfOa6wnV3rQqrGjpf+dtjSmrHoKI2oPUF/zbOFZYo6Cnwsw6JpY3Outfs7ddfiyeu5ZmrQW/b8nHnWH2aRiUn+184PUFUaY6dZqm7dMl1VM4/Ez1VytvsoYneoO+wEtknvHNu0sx/6ncur5oPZXDAAk6c45S7MfeJVPtyj6OdRePMn5wIhOFN7St4OtevL3gg4dmNeM9Ymes130JlZvjIPaf9c5MbtN8XhN/ZjUYdKx2DunIJKMX5LaTxa0q3VAk5aln32uvdUiOfpZZ/SbtGrBfg14JTbTDzGmG3bcjrlNXZr8O5JYqvC6VsK9l/OaaTumnbMFDXlc1w97PtH+uwUdair1Nyen1F6aTbpzztLsT//Wm4XVx8tXBjRpnZdiTtBJ9xOovRintRf1ZPqgnjsn6dF9PdWLesFXYl5do7mttRvDjX3NqtrzXuWd1HoUllT8ZbsOX9aJPec11mMp72PDikm7m/lm90qMbsed6qgs67Vhx16/Wyxe680m15qf+KNgep0H9XB2XjrQ4Xq8eXZt0NDek9XsB4talrRL8/r5g4Paf3et/9l1+B9qPvqKfr41ovagm8gCSrqfqDxnM9/XSYklOVdOAz1ss3S79PysldN3pp3/rc90e1pSb62iNFPvCcY4/qYW7ZT09OhnunPYfFRQ7YaOY0NRFIJ0OlGs7bo9Z4/Hb1uVid5thsfeVhpHVuHa69ChwteasV7RWKk/8rVb+tF9PdXVdX1YWXOIqNLI9INkkFkZmIklObefLKh9cEr5tkX9qTCi9lvnNfavFn8bjw6M6ERhRHfOWZq0ZjasA8Wh3i9A0/iXrwxo8uhVNVeZ/nPiVX+Q168WI6d65Jak3c6LeiNWFB+q/Ey51k55t7RK68+tmtljuHzTtEc7dXDdJtTNqN77uc0i3q9S9baE2gUslRJ9z3mNtVl64rImGkWHbjK9WCtJxr86y5FVT+FyqDW0KF6vJDuIsHsHwnD7qozTGrBpHWHjcRp5+5W6Dr9pj3b6KtChF96/um4NOklJ93Ps5q6t+JLzo0U9VYskafn+D9LvXw5+cR8Y0Ym7Lcq3Dehbh0+xXmsuphd0rde9grZdy/iXrwys2+wSRtwfaKIWRex+p4XdOjrTUXPUSwZe8dSyU67Z/bZhp3ZpWtvH7FD7yYJ0ztKkdazi2bUd2+VZp2d6LI2pYvp83TdXJE2Xvr3y/tc6cdJ9HdxJGvq5er2/68G2YrFYXFhY2HCgoSH639yVpCg72yAbn8J2nHHGHzU///Ygm6aiaNdvDHHUEVXdXtdjLTaEubUXpKxp7FhVz/0E1tsyyRkAgHqxJf5kJAAA9YTkDABAypCcAQBIGZIzAAApQ3IGACBlXL/nvH379jjjAAAAJa7JeceOeH95GAAAWMW0NgAAKUNyBgAgZUjOAACkDMkZAICUITkDAJAyJGcAAFKG5AwAQMqQnAEASBmSMwAAKUNyBgAgZUjOAACkDMkZAICUcf3rFr/88kuccQAAgJJtxWKxmHQQAABgDdPaAACkzP8BNGUdOpFHEF4AAAAASUVORK5CYII=" alt="image-20220512215534789"></p></li> <li><p><code>exec格式</code>：</p> <p><img src="data:image/png;base64,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" alt="image-20220512215836552"></p></li></ul></li> <li><p><code>EXPOSE</code>：当前容器对外暴露出的端口</p></li> <li><p><code>WORKDIR</code>：指定在创建容器后，终端默认登陆的进来工作目录，一个落脚点</p></li> <li><p><code>USER</code>：指定该镜像以什么样的用户去执行，如果都不指定，默认是root</p></li> <li><p><code>ENV</code>：用来在构建镜像过程中设置环境变量</p> <blockquote><p>ENV MY_PATH /usr/mytest
这个环境变量可以在后续的任何RUN指令中使用，这就如同在命令前面指定了环境变量前缀一样；
也可以在其它指令中直接使用这些环境变量，</p> <p>比如：WORKDIR $MY_PATH</p></blockquote></li> <li><p><code>ADD</code>：将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包</p></li> <li><p><code>COPY</code>：类似ADD，拷贝文件和目录到镜像中。</p> <blockquote><p>将从构建上下文目录中 &lt;源路径&gt; 的文件/目录复制到新的一层的镜像内的 &lt;目标路径&gt; 位置</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>COPY src dest

COPY <span class="token punctuation">[</span><span class="token string">&quot;src&quot;</span>, <span class="token string">&quot;dest&quot;</span><span class="token punctuation">]</span>
<span class="token operator">&lt;</span>src源路径<span class="token operator">&gt;</span>：源文件或者源目录
<span class="token operator">&lt;</span>dest目标路径<span class="token operator">&gt;</span>：容器内的指定路径，该路径不用事先建好，路径不存在的话，会自动创建。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p><code>VOLUME</code>：容器数据卷，用于数据保存和持久化工作</p></li> <li><p><code>CMD</code>：指定容器启动后的要干的事情</p> <p><img src="/assets/img/image-20220512221804933.84d49a9c.png" alt="image-20220512221804933"></p> <ul><li>Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效，CMD 会被 docker run <strong>之后的参数替换</strong></li> <li>它和前面RUN命令的区别
<ul><li>CMD是在docker run 时运行。</li> <li>RUN是在 docker build时运行。</li></ul></li></ul></li> <li><p><code>ENTRYPOINT</code>：也是用来指定一个容器启动时要运行的命令</p> <ul><li><p>类似于 CMD 指令，但是ENTRYPOINT不会被docker run后面的命令覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序</p> <blockquote><p>命令格式：
ENTRYPOINT可以和CMD一起用，一般是变参才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参。
当指定了ENTRYPOINT后，CMD的含义就发生了变化，不再是直接运行其命令而是将CMD的内容作为参数传递给ENTRYPOINT指令，他两个组合会变成</p> <p>案例如下：假设已通过 Dockerfile 构建了 nginx:test 镜像：</p> <table><thead><tr><th>是否传参</th> <th>按照dockerfile编写执行</th> <th>传参运行</th></tr></thead> <tbody><tr><td>Docker命令</td> <td>docker run  nginx:test</td> <td>docker run  nginx:test -c /etc/nginx/new.conf</td></tr> <tr><td>衍生出的实际命令</td> <td>nginx -c /etc/nginx/nginx.conf</td> <td>nginx -c /etc/nginx/new.conf</td></tr></tbody></table></blockquote></li> <li><p>优点：在执行docker run的时候可以指定 ENTRYPOINT 运行所需的参数。</p></li> <li><p>注意：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</p></li></ul></li></ul> <p><img src="/assets/img/image-20220512231336016.41a399d1.png" alt="image-20220512231336016"></p> <h3 id="_4、构建案例"><a href="#_4、构建案例" class="header-anchor">#</a> 4、构建案例</h3> <h4 id="_1、实现目标"><a href="#_1、实现目标" class="header-anchor">#</a> 1、实现目标</h4> <blockquote><p>Centos7镜像具备vim+ifconfig+jdk8</p></blockquote> <p>准备JDK：<a href="https://www.oracle.com/java/technologies/downloads/#java8" target="_blank" rel="noopener noreferrer">下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="_2、编写dockerfile"><a href="#_2、编写dockerfile" class="header-anchor">#</a> 2、编写DockerFile</h4> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">FROM</span> centos</span>
<span class="token instruction"><span class="token keyword">MAINTAINER</span> xiaobear&lt;xiaobear@qq.com&gt;</span>
 
<span class="token instruction"><span class="token keyword">ENV</span> MYPATH /usr/local</span>
<span class="token instruction"><span class="token keyword">WORKDIR</span> <span class="token variable">$MYPATH</span></span>
 
<span class="token comment">#centos8 需加上</span>
<span class="token instruction"><span class="token keyword">RUN</span> sed -i -e <span class="token string">&quot;s|mirrorlist=|#mirrorlist=|g&quot;</span> /etc/yum.repos.d/CentOS-*</span>
<span class="token instruction"><span class="token keyword">RUN</span> sed -i -e <span class="token string">&quot;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&quot;</span> /etc/yum.repos.d/CentOS-*</span>
<span class="token comment">#安装vim编辑器</span>
<span class="token instruction"><span class="token keyword">RUN</span> yum -y install vim</span>
<span class="token comment">#安装ifconfig命令查看网络IP</span>
<span class="token instruction"><span class="token keyword">RUN</span> yum -y install net-tools</span>
<span class="token comment">#安装java8及lib库</span>
<span class="token instruction"><span class="token keyword">RUN</span> yum -y install glibc.i686</span>
<span class="token instruction"><span class="token keyword">RUN</span> mkdir /usr/local/java</span>
<span class="token comment">#ADD 是相对路径jar,把jdk-8u333-linux-x64.tar.gz添加到容器中,安装包必须要和Dockerfile文件在同一位置</span>
<span class="token instruction"><span class="token keyword">ADD</span> jdk-8u333-linux-x64.tar.gz /usr/local/java/</span>
<span class="token comment">#配置java环境变量</span>
<span class="token instruction"><span class="token keyword">ENV</span> JAVA_HOME /usr/local/java/jdk1.8.0_333</span>
<span class="token instruction"><span class="token keyword">ENV</span> JRE_HOME <span class="token variable">$JAVA_HOME</span>/jre</span>
<span class="token instruction"><span class="token keyword">ENV</span> CLASSPATH <span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar:<span class="token variable">$JRE_HOME</span>/lib:<span class="token variable">$CLASSPATH</span></span>
<span class="token instruction"><span class="token keyword">ENV</span> PATH <span class="token variable">$JAVA_HOME</span>/bin:<span class="token variable">$PATH</span></span>

<span class="token comment">#对外暴露端口 80</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 80</span>
 
<span class="token instruction"><span class="token keyword">CMD</span> echo <span class="token variable">$MYPATH</span></span>
<span class="token instruction"><span class="token keyword">CMD</span> echo <span class="token string">&quot;success--------------ok&quot;</span></span>
<span class="token instruction"><span class="token keyword">CMD</span> /bin/bash</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h4 id="_3、构建"><a href="#_3、构建" class="header-anchor">#</a> 3、构建</h4> <blockquote><p><code>docker build -t 新镜像名字:TAG .</code></p></blockquote> <p>PS：上面TAG后面有个空格，有个点</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> build -t centos_java8:2.0 <span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4、运行"><a href="#_4、运行" class="header-anchor">#</a> 4、运行</h4> <blockquote><p><code>docker run -it 新镜像名字:TAG</code></p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker myDockerFile<span class="token punctuation">]</span><span class="token comment">## docker run -it 1ca6615ca841 /bin/bash</span>
<span class="token punctuation">[</span>root@c73761eb0626 local<span class="token punctuation">]</span><span class="token comment">## ls</span>
bin  etc  games  include  java	lib  lib64  libexec  sbin  share  src
<span class="token punctuation">[</span>root@c73761eb0626 local<span class="token punctuation">]</span><span class="token comment">## cd java</span>
<span class="token punctuation">[</span>root@c73761eb0626 java<span class="token punctuation">]</span><span class="token comment">## ls</span>
jdk1.8.0_333
<span class="token punctuation">[</span>root@c73761eb0626 java<span class="token punctuation">]</span><span class="token comment">## java -version</span>
java version <span class="token string">&quot;1.8.0_333&quot;</span>
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_333-b02<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.333</span>-b02, mixed mode<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@c73761eb0626 java<span class="token punctuation">]</span><span class="token comment">## vim a.txt</span>
<span class="token punctuation">[</span>root@c73761eb0626 java<span class="token punctuation">]</span><span class="token comment">## cat a.txt </span>
hello Dockerfile
<span class="token punctuation">[</span>root@c73761eb0626 java<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="_5、体会unionfs"><a href="#_5、体会unionfs" class="header-anchor">#</a> 5、体会<code>UnionFS</code></h4> <blockquote><p>UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p> <p><img src="/assets/img/image-20220514161842221.1ce1ec5e.png" alt="image-20220514161842221"></p> <p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p></blockquote> <h3 id="_5、虚悬镜像"><a href="#_5、虚悬镜像" class="header-anchor">#</a> 5、虚悬镜像</h3> <blockquote><p>仓库名、标签都是<none>的镜像，俗称dangling image</none></p></blockquote> <h4 id="_1、编写dockerfile"><a href="#_1、编写dockerfile" class="header-anchor">#</a> 1、编写Dockerfile</h4> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token instruction"><span class="token keyword">from</span> ubuntu</span>
<span class="token instruction"><span class="token keyword">CMD</span> echo <span class="token string">'action is success'</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>构建</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> build <span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看镜像</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token punctuation">..</span>/images
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20220514225139910.fad45b19.png" alt="image-20220514225139910"></p> <h4 id="_2、查看"><a href="#_2、查看" class="header-anchor">#</a> 2、查看</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> image <span class="token function">ls</span> -f <span class="token assign-left variable">dangling</span><span class="token operator">=</span>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3、删除"><a href="#_3、删除" class="header-anchor">#</a> 3、删除</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> image prune
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>虚悬镜像已经失去存在价值，可以删除</p> <h2 id="_11、docker微服务实战"><a href="#_11、docker微服务实战" class="header-anchor">#</a> 11、Docker微服务实战</h2> <h3 id="_1、建立测试微服务模块"><a href="#_1、建立测试微服务模块" class="header-anchor">#</a> 1、建立测试微服务模块</h3> <h3 id="_2、通过dockerfile发布微服务部署到docker容器"><a href="#_2、通过dockerfile发布微服务部署到docker容器" class="header-anchor">#</a> 2、通过dockerfile发布微服务部署到docker容器</h3> <h4 id="_1、idea-进行打包"><a href="#_1、idea-进行打包" class="header-anchor">#</a> 1、IDEA 进行打包</h4> <h4 id="_2、编写dockerfile-2"><a href="#_2、编写dockerfile-2" class="header-anchor">#</a> 2、编写Dockerfile</h4> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment">## 基础镜像使用java</span>
<span class="token instruction"><span class="token keyword">FROM</span> java:8</span>
<span class="token comment">## 作者</span>
<span class="token instruction"><span class="token keyword">MAINTAINER</span> xiaobear</span>
<span class="token comment">## VOLUME 指定临时文件目录为/tmp，在主机/var/lib/docker目录下创建了一个临时文件并链接到容器的/tmp</span>
<span class="token instruction"><span class="token keyword">VOLUME</span> /tmp</span>
<span class="token comment">## 将jar包添加到容器中并更名为xiaobear_docker.jar</span>
<span class="token instruction"><span class="token keyword">ADD</span> Docker-Boot-0.0.1-SNAPSHOT.jar xiaobear_docker.jar</span>
<span class="token comment">## 运行jar包</span>
<span class="token instruction"><span class="token keyword">RUN</span> bash -c <span class="token string">'touch /xiaobear_docker.jar'</span></span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;java&quot;</span>,<span class="token string">&quot;-jar&quot;</span>,<span class="token string">&quot;/xiaobear_docker.jar&quot;</span>]</span>
<span class="token comment">#暴露6688端口作为微服务</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 6688</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>PS：将微服务jar包和Dockerfile文件上传到同一个目录下</p> <h4 id="_3、构建镜像"><a href="#_3、构建镜像" class="header-anchor">#</a> 3、构建镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> build -t docker_boot:1.0 <span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4、运行镜像"><a href="#_4、运行镜像" class="header-anchor">#</a> 4、运行镜像</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> <span class="token function">docker</span> run -d -p <span class="token number">6688</span>:6688 docker_boot:1.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_5、测试"><a href="#_5、测试" class="header-anchor">#</a> 5、测试</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">curl</span> <span class="token number">127.0</span>.0.1:6688/hello
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/assets/img/image-20220515153644202.636bee5e.png" alt="image-20220515153644202"></p> <h2 id="_12、docker网络"><a href="#_12、docker网络" class="header-anchor">#</a> 12、Docker网络</h2> <h3 id="_1、什么是docker网络"><a href="#_1、什么是docker网络" class="header-anchor">#</a> 1、什么是Docker网络</h3> <ul><li>没有开启Docker网络时的网络状态：</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether 00:0c:29:9e:80:10 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.130.132/24 brd <span class="token number">192.168</span>.130.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::987d:a504:45a9:2011/64 scope <span class="token function">link</span> noprefixroute 
       valid_lft forever preferred_lft forever
<span class="token number">39</span>: veth33b55fa@if38: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default 
    link/ether 2a:e3:37:b2:68:47 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet6 fe80::28e3:37ff:feb2:6847/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li>开启docker后</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether 00:0c:29:9e:80:10 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.130.132/24 brd <span class="token number">192.168</span>.130.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::987d:a504:45a9:2011/64 scope <span class="token function">link</span> noprefixroute 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default 
    link/ether 02:42:8a:3f:98:14 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:8aff:fe3f:9814/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">39</span>: veth33b55fa@if38: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default 
    link/ether 2a:e3:37:b2:68:47 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet6 fe80::28e3:37ff:feb2:6847/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><blockquote><p>会产生一个名为docker0的虚拟网桥</p></blockquote> <p>查看Docker网络的情况</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> network <span class="token function">ls</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
012ef5850c2b   bridge    bridge    <span class="token builtin class-name">local</span>
15bd0ffe79b0   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
28741f9b037c   none      null      <span class="token builtin class-name">local</span>
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2、基本命令"><a href="#_2、基本命令" class="header-anchor">#</a> 2、基本命令</h3> <h4 id="_1、所有命令"><a href="#_1、所有命令" class="header-anchor">#</a> 1、所有命令</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker network --help</span>

Usage:  <span class="token function">docker</span> network COMMAND

Manage networks

Commands:
  connect     Connect a container to a network
  create      Create a network
  disconnect  Disconnect a container from a network
  inspect     Display detailed information on one or <span class="token function">more</span> networks
  <span class="token function">ls</span>          List networks
  prune       Remove all unused networks
  <span class="token function">rm</span>          Remove one or <span class="token function">more</span> networks

Run <span class="token string">'docker network COMMAND --help'</span> <span class="token keyword">for</span> <span class="token function">more</span> information on a command.
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="_2、查看网络命令"><a href="#_2、查看网络命令" class="header-anchor">#</a> 2、查看网络命令</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> network <span class="token function">ls</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3、查看网络源"><a href="#_3、查看网络源" class="header-anchor">#</a> 3、查看网络源</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> network inspect  XXX网络名字
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4、删除网络"><a href="#_4、删除网络" class="header-anchor">#</a> 4、删除网络</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> network <span class="token function">rm</span> 网络名字
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>全程案例过程：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker network create test_network</span>
473cef3a3e4ca58d62898caa93ae97a3772ab0d90325fc7a107082ef8c5a5bce
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker network ls</span>
NETWORK ID     NAME           DRIVER    SCOPE
012ef5850c2b   bridge         bridge    <span class="token builtin class-name">local</span>
15bd0ffe79b0   <span class="token function">host</span>           <span class="token function">host</span>      <span class="token builtin class-name">local</span>
28741f9b037c   none           null      <span class="token builtin class-name">local</span>
473cef3a3e4c   test_network   bridge    <span class="token builtin class-name">local</span>
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker network rm test_network </span>
test_network
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
012ef5850c2b   bridge    bridge    <span class="token builtin class-name">local</span>
15bd0ffe79b0   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
28741f9b037c   none      null      <span class="token builtin class-name">local</span>
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_3、作用"><a href="#_3、作用" class="header-anchor">#</a> 3、作用</h3> <blockquote><ul><li>容器间的互联和通信以及端口映射</li> <li>容器IP变动时候可以通过服务名直接网络通信而不受到影响</li></ul></blockquote> <h3 id="_4、网络模式"><a href="#_4、网络模式" class="header-anchor">#</a> 4、网络模式</h3> <h4 id="_1、模式类型"><a href="#_1、模式类型" class="header-anchor">#</a> 1、模式类型</h4> <p><img src="/assets/img/image-20220515162316604.af4e0e65.png" alt="image-20220515162316604"></p> <ul><li><code>bridge模式</code>：使用--network  bridge指定，默认使用docker0</li> <li><code>host模式</code>：使用--network host指定</li> <li><code>none模式</code>：使用--network none指定</li> <li><code>container模式</code>：使用--network container:NAME或者容器ID指定</li></ul> <h4 id="_2、容器实例内默认网络ip生产规则"><a href="#_2、容器实例内默认网络ip生产规则" class="header-anchor">#</a> 2、容器实例内默认网络IP生产规则</h4> <h5 id="_1、先启动两个centos容器实例"><a href="#_1、先启动两个centos容器实例" class="header-anchor">#</a> 1、先启动两个centos容器实例</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -it -d --name c1 centos <span class="token function">bash</span>
<span class="token function">docker</span> run -it -d --name c2 centos <span class="token function">bash</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="_2、2-docker-inspect-容器id-or-容器名字"><a href="#_2、2-docker-inspect-容器id-or-容器名字" class="header-anchor">#</a> 2、2 docker inspect 容器ID or 容器名字</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker inspect c1 | tail -n 20</span>
            <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;bridge&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;IPAMConfig&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Links&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Aliases&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;012ef5850c2b3e380a1cb58d9365d60a6ee8ee4b943d8d6ab90aaebd22e1bf62&quot;</span>,
                    <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;257f45d018046dcfa90a5d201c436db20dea41cc9ec2bb58d88576c25143c62f&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.1&quot;</span>,
                    <span class="token string">&quot;IPAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.3&quot;</span>,
                    <span class="token string">&quot;IPPrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
                    <span class="token string">&quot;IPv6Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
                    <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:ac:11:00:03&quot;</span>,
                    <span class="token string">&quot;DriverOpts&quot;</span><span class="token builtin class-name">:</span> null
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker inspect c2 | tail -n 20</span>
            <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;bridge&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;IPAMConfig&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Links&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Aliases&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;012ef5850c2b3e380a1cb58d9365d60a6ee8ee4b943d8d6ab90aaebd22e1bf62&quot;</span>,
                    <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;3b2688b510738178d64344d97e245b38442fbe91e71d486da2fd1ccf1953ec92&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.1&quot;</span>,
                    <span class="token string">&quot;IPAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.4&quot;</span>,
                    <span class="token string">&quot;IPPrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
                    <span class="token string">&quot;IPv6Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
                    <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:ac:11:00:04&quot;</span>,
                    <span class="token string">&quot;DriverOpts&quot;</span><span class="token builtin class-name">:</span> null
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><p>两个示例对应的ip地址分别是：<code>172.17.0.4</code>和<code>172.17.0.3</code></p> <h5 id="_3、关闭其中一个实例"><a href="#_3、关闭其中一个实例" class="header-anchor">#</a> 3、关闭其中一个实例</h5> <blockquote><p>关闭c1，再新建一个c3实例</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker stop c1</span>
c1
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker ps</span>
CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                                       NAMES
010441413dc6   centos         <span class="token string">&quot;bash&quot;</span>                   <span class="token number">12</span> minutes ago   Up <span class="token number">12</span> minutes                                               c2
f1141e4f51b9   90c07658a4b1   <span class="token string">&quot;java -jar /xiaobear…&quot;</span>   <span class="token number">2</span> hours ago      Up <span class="token number">2</span> hours      <span class="token number">0.0</span>.0.0:6688-<span class="token operator">&gt;</span><span class="token number">6688</span>/tcp, :::6688-<span class="token operator">&gt;</span><span class="token number">6688</span>/tcp   zealous_shockley
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker run -it -d --name c3 centos bash</span>
70066a4f0735eea5a9d4f175bb4d4af4efe516f7d98e919bfbfe9a4699925515
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker inspect c3 | tail -n 20</span>
            <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;bridge&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;IPAMConfig&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Links&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Aliases&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;012ef5850c2b3e380a1cb58d9365d60a6ee8ee4b943d8d6ab90aaebd22e1bf62&quot;</span>,
                    <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;f1f8b9195c706b7e618953746be882c68a11bb36cd689519fc1a0b3ef580b6c9&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.1&quot;</span>,
                    <span class="token string">&quot;IPAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.3&quot;</span>,
                    <span class="token string">&quot;IPPrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
                    <span class="token string">&quot;IPv6Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
                    <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:ac:11:00:03&quot;</span>,
                    <span class="token string">&quot;DriverOpts&quot;</span><span class="token builtin class-name">:</span> null
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## docker inspect c2 | tail -n 20</span>
            <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;bridge&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;IPAMConfig&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Links&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Aliases&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;012ef5850c2b3e380a1cb58d9365d60a6ee8ee4b943d8d6ab90aaebd22e1bf62&quot;</span>,
                    <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;3b2688b510738178d64344d97e245b38442fbe91e71d486da2fd1ccf1953ec92&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.1&quot;</span>,
                    <span class="token string">&quot;IPAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;172.17.0.4&quot;</span>,
                    <span class="token string">&quot;IPPrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">16</span>,
                    <span class="token string">&quot;IPv6Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
                    <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;02:42:ac:11:00:04&quot;</span>,
                    <span class="token string">&quot;DriverOpts&quot;</span><span class="token builtin class-name">:</span> null
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@docker docker-boot<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>总结：<strong>docker容器内部的ip是有可能会发生改变的</strong></p> <h4 id="_3、模式案例"><a href="#_3、模式案例" class="header-anchor">#</a> 3、模式案例</h4> <h5 id="_1、bridge"><a href="#_1、bridge" class="header-anchor">#</a> 1、<code>bridge</code></h5> <blockquote><p>Docker 服务默认会创建一个 docker0 网桥（其上有一个 docker0 内部接口），该桥接网络的名称为docker0，它在内核层连通了其他的物理或虚拟网卡，这就将所有容器和本地主机都放到同一个物理网络。Docker 默认指定了 docker0 接口 的 IP 地址和子网掩码，让主机和容器之间可以通过网桥相互通信。</p></blockquote> <p><strong>查看 bridge 网络的详细信息，并通过 grep 获取名称项</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> network inspect bridge <span class="token operator">|</span> <span class="token function">grep</span> name
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker network inspect bridge | grep name</span>
            <span class="token string">&quot;com.docker.network.bridge.name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;docker0&quot;</span>,
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## ifconfig | grep docker</span>
docker0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">409</span><span class="token operator"><span class="token file-descriptor important">9</span>&lt;</span>UP,BROADCAST,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h6 id="说明"><a href="#说明" class="header-anchor">#</a> 说明</h6> <blockquote><p>Docker使用Linux桥接，在宿主机虚拟一个Docker容器网桥(docker0)，Docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的Container-IP直接通信。</p> <p>docker run 的时候，没有指定network的话默认使用的网桥模式就是bridge，使用的就是docker0。在宿主机ifconfig,就可以看到docker0和自己create的network(后面讲)eth0，eth1，eth2……代表网卡一，网卡二，网卡三……，lo代表127.0.0.1，即localhost，inet addr用来表示网卡的IP地址</p> <p>网桥docker0创建一对对等虚拟设备接口一个叫veth，另一个叫eth0，成对匹配。</p> <ul><li>整个宿主机的网桥模式都是docker0，类似一个交换机有一堆接口，每个接口叫veth，在本地主机和容器内分别创建一个虚拟接口，并让他们彼此联通（这样一对接口叫veth pair）；</li> <li>每个容器实例内部也有一块网卡，每个接口叫eth0；</li> <li>docker0上面的每个veth匹配某个容器实例内部的eth0，两两配对，一一匹配。</li></ul> <p>通过上述，将宿主机上的所有容器都连接到这个内部网络上，两个容器在同一个网络下,会从这个网关下各自拿到分配的ip，此时两个容器的网络是互通的。</p> <p><img src="/assets/img/image-20220516210809260.424d482a.png" alt="image-20220516210809260"></p></blockquote> <h6 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">8081</span>:8080   --name tomcat81 billygoo/tomcat8-jdk8
<span class="token function">docker</span> run -d -p <span class="token number">8082</span>:8080   --name tomcat81 billygoo/tomcat8-jdk8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>主机IP，新增了<code>5: veth2dc5f8a@if4</code> 和 <code>7: vethad18b38@if6</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope <span class="token function">host</span> 
       valid_lft forever preferred_lft forever
<span class="token number">2</span>: ens33: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc pfifo_fast state UP group default qlen <span class="token number">1000</span>
    link/ether 00:0c:29:9e:80:10 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">192.168</span>.130.132/24 brd <span class="token number">192.168</span>.130.255 scope global noprefixroute ens33
       valid_lft forever preferred_lft forever
    inet6 fe80::987d:a504:45a9:2011/64 scope <span class="token function">link</span> noprefixroute 
       valid_lft forever preferred_lft forever
<span class="token number">3</span>: docker0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default 
    link/ether 02:42:df:0e:5d:5b brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.1/16 brd <span class="token number">172.17</span>.255.255 scope global docker0
       valid_lft forever preferred_lft forever
    inet6 fe80::42:dfff:fe0e:5d5b/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">9</span>: vethe7bf9cb@if8: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default 
    link/ether 6a:23:3d:79:f7:ea brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet6 fe80::6823:3dff:fe79:f7ea/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
<span class="token number">11</span>: veth7e028d8@if10: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue master docker0 state UP group default 
    link/ether be:01:87:68:c7:c1 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">1</span>
    inet6 fe80::bc01:87ff:fe68:c7c1/64 scope <span class="token function">link</span> 
       valid_lft forever preferred_lft forever
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>进入容器内部，发现没有ip addr 和ifconfig命令</p> <p>可以拉取免修改版<code>docker pull billygoo/tomcat8-jdk8</code></p> <p>验证结果：</p> <p><img src="/assets/img/image-20220516223300944.a0f10059.png" alt="image-20220516223300944"></p> <h5 id="_2、host"><a href="#_2、host" class="header-anchor">#</a> 2、<code>host</code></h5> <blockquote><p>直接使用宿主机的 IP 地址与外界进行通信，不再需要额外进行NAT 转换。</p></blockquote> <h6 id="说明-2"><a href="#说明-2" class="header-anchor">#</a> 说明</h6> <blockquote><p>容器将不会获得一个独立的Network Namespace， 而是和宿主机共用一个Network Namespace。容器将不会虚拟出自己的网卡而是使用宿主机的IP和端口。</p> <p><img src="/assets/img/image-20220516223451044.097a935a.png" alt="image-20220516223451044"></p></blockquote> <h6 id="案例-2"><a href="#案例-2" class="header-anchor">#</a> 案例</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">8083</span>:8080 --network <span class="token function">host</span> --name tomcat83 billygoo/tomcat8-jdk8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>出现了警告，但是并不影响</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -d -p 8083:8080 --network host --name tomcat83 billygoo/tomcat8-jdk8</span>
WARNING: Published ports are discarded when using <span class="token function">host</span> network mode
3ef26b95ddc8a507fce7dd83becf360d1a3fe150b436a23246d68cf584b7e026
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><blockquote><p><strong>问题：</strong>
docke启动时总是遇见标题中的警告
<strong>原因：</strong>
docker启动时指定--network=host或-net=host，如果还指定了-p映射端口，那这个时候就会有此警告，
并且通过-p设置的参数将不会起到任何作用，端口号会以主机端口号为主，重复时则递增。
解决:
解决的办法就是使用docker的其他网络模式，例如--network=bridge，这样就可以解决问题，或者直接无视</p></blockquote> <p>若想不出现警告，正确的命令如下：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d                          --network <span class="token function">host</span> --name tomcat83 billygoo/tomcat8-jdk8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -d                          --network host --name tomcat83 billygoo/tomcat8-jdk8</span>
a4dd488fe6958bfe58c0064c7d9082bb86e37f6549592e6d0d7e26b30c222947
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>进入容器内部</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker inspect tomcat83 | tail -n 20</span>
            <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;IPAMConfig&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Links&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Aliases&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;15bd0ffe79b02f0d6afc16e32b9c4246befedde12b2ea733f1f87f02ec24ad83&quot;</span>,
                    <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;4f72c5950edc766e80d6dad4cd9c6798e0760e5eccd53dbab473e33718e3f765&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;IPAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;IPPrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
                    <span class="token string">&quot;IPv6Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
                    <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;DriverOpts&quot;</span><span class="token builtin class-name">:</span> null
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>发现ip地址是空的，则是访问的宿主机的ip</p> <h5 id="_3、none"><a href="#_3、none" class="header-anchor">#</a> 3、<code>none</code></h5> <blockquote><p>在none模式下，并不为Docker容器进行任何网络配置。
也就是说，这个Docker容器没有网卡、IP、路由等信息，只有一个lo
需要我们自己为Docker容器添加网卡、配置IP等。</p> <p><strong>禁用网络功能，只有lo标识(就是127.0.0.1表示本地回环)</strong></p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">8084</span>:8080 --network none --name tomcat84 billygoo/tomcat8-jdk8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -d -p 8084:8080 --network none --name tomcat84 billygoo/tomcat8-jdk8</span>
944253c3400d267e524f4235d0fc424e4ec9e37790e28cabf66a87014f1ff76d
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker exec -it tomcat84 bash</span>
root@944253c3400d:/usr/local/tomcat<span class="token comment">## ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在外部容器查看</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker inspect tomcat84 | tail -n 20</span>
            <span class="token string">&quot;Networks&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                <span class="token string">&quot;none&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
                    <span class="token string">&quot;IPAMConfig&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Links&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;Aliases&quot;</span><span class="token builtin class-name">:</span> null,
                    <span class="token string">&quot;NetworkID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;28741f9b037cace317ec9b6dfad0609fb39b7dcc17e88e617298b6185d25301c&quot;</span>,
                    <span class="token string">&quot;EndpointID&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;af0d382eee640ec36b20bd6109a9c9a5e46d4652904fd17253963751d4b41bd1&quot;</span>,
                    <span class="token string">&quot;Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;IPAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;IPPrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
                    <span class="token string">&quot;IPv6Gateway&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6Address&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;GlobalIPv6PrefixLen&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
                    <span class="token string">&quot;MacAddress&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>,
                    <span class="token string">&quot;DriverOpts&quot;</span><span class="token builtin class-name">:</span> null
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h5 id="_4、container"><a href="#_4、container" class="header-anchor">#</a> 4、<code>container</code></h5> <blockquote><p>新建的容器和已经存在的一个容器共享一个网络ip配置而不是和宿主机共享。新创建的容器不会创建自己的网卡，配置自己的IP，而是和一个指定的容器共享IP、端口范围等。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。</p></blockquote> <p><img src="/assets/img/image-20220517000356775.195352e0.png" alt="image-20220517000356775"></p> <h6 id="错误案例"><a href="#错误案例" class="header-anchor">#</a> 错误案例</h6> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -d -p 8085:8080                                     --name tomcat85 billygoo/tomcat8-jdk8</span>
fb05b8d4dc8af6f4da53c755a599a5184c80f5ae26944280c6b880698832ed6a
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -d -p 8086:8080 --network container:tomcat85 --name tomcat86 billygoo/tomcat8-jdk8</span>
docker: Error response from daemon: conflicting options: port publishing and the container <span class="token builtin class-name">type</span> network mode.
See <span class="token string">'docker run --help'</span><span class="token builtin class-name">.</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>相当于tomcat86和tomcat85公用同一个ip同一个端口，导致端口冲突
本案例用tomcat演示不合适。。。演示坑。。。。。。o(╥﹏╥)o</p> <p>换一个镜像给大家演示，</p></blockquote> <h6 id="正确案例"><a href="#正确案例" class="header-anchor">#</a> 正确案例</h6> <blockquote><p>Alpine Linux 是一款独立的、非商业的通用 Linux 发行版，专为追求安全性、简单性和资源效率的用户而设计。 可能很多人没听说过这个 Linux 发行版本，但是经常用 Docker 的朋友可能都用过，因为他小，简单，安全而著称，所以作为基础镜像是非常好的一个选择，可谓是麻雀虽小但五脏俱全，镜像非常小巧，不到 6M的大小，所以特别适合容器打包。</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -it                                                    --name alpine1  alpine /bin/sh</span>
Unable to <span class="token function">find</span> image <span class="token string">'alpine:latest'</span> locally
latest: Pulling from library/alpine
59bf1c3509f3: Pull complete 
Digest: sha256:21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300
Status: Downloaded newer image <span class="token keyword">for</span> alpine:latest
/ <span class="token comment">## ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">14</span>: eth0@if15: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP 
    link/ether 02:42:ac:11:00:05 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.5/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
/ <span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -it --network container:alpine1 --name alpine2  alpine /bin/sh</span>
/ <span class="token comment">## ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">14</span>: eth0@if15: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP 
    link/ether 02:42:ac:11:00:05 brd ff:ff:ff:ff:ff:ff
    inet <span class="token number">172.17</span>.0.5/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
/ <span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>关闭alpine1，再看看alpine2</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker exec -it alpine2 /bin/sh</span>
/ <span class="token comment">## ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
/ <span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="_5、自定义网络"><a href="#_5、自定义网络" class="header-anchor">#</a> 5、<code>自定义网络</code></h5> <h6 id="_1、过时的link"><a href="#_1、过时的link" class="header-anchor">#</a> 1、过时的<code>link</code></h6> <blockquote><p>官方文档：https://docs.docker.com/network/links/</p></blockquote> <h6 id="_2、自定义网络之前"><a href="#_2、自定义网络之前" class="header-anchor">#</a> 2、自定义网络之前</h6> <p>启动两个实例，然后互ping 对方的ip，发现可用ping通</p> <div class="language-shell\ line-numbers-mode"><pre class="language-text"><code>[root@docker ~]## docker exec -it tomcat81 bash
root@91a8a3567d11:/usr/local/tomcat## ip addr
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
8: eth0@if9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default 
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0
       valid_lft forever preferred_lft forever
root@91a8a3567d11:/usr/local/tomcat## ping 172.17.0.3
PING 172.17.0.3 (172.17.0.3) 56(84) bytes of data.
64 bytes from 172.17.0.3: icmp_seq=1 ttl=64 time=76.2 ms
64 bytes from 172.17.0.3: icmp_seq=2 ttl=64 time=0.096 ms
^C
--- 172.17.0.3 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 0.096/38.150/76.204/38.054 ms
root@91a8a3567d11:/usr/local/tomcat## 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>\</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker exec -it tomcat82 bash</span>
root@1cf3a8ebb134:/usr/local/tomcat<span class="token comment">## ip addr</span>
<span class="token number">1</span>: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">65536</span> qdisc noqueue state UNKNOWN group default qlen <span class="token number">1000</span>
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet <span class="token number">127.0</span>.0.1/8 scope <span class="token function">host</span> lo
       valid_lft forever preferred_lft forever
<span class="token number">10</span>: eth0@if11: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP<span class="token operator">&gt;</span> mtu <span class="token number">1500</span> qdisc noqueue state UP group default 
    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid <span class="token number">0</span>
    inet <span class="token number">172.17</span>.0.3/16 brd <span class="token number">172.17</span>.255.255 scope global eth0
       valid_lft forever preferred_lft forever
root@1cf3a8ebb134:/usr/local/tomcat<span class="token comment">## ping 172.17.0.2</span>
PING <span class="token number">172.17</span>.0.2 <span class="token punctuation">(</span><span class="token number">172.17</span>.0.2<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">9.62</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.139</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.139</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">4</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.139</span> ms
<span class="token number">64</span> bytes from <span class="token number">172.17</span>.0.2: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">5</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.145</span> ms
^Z
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>+  Stopped                 <span class="token function">ping</span> <span class="token number">172.17</span>.0.2
root@1cf3a8ebb134:/usr/local/tomcat<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>两个实例互ping服务名</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>root@91a8a3567d11:/usr/local/tomcat<span class="token comment">## ping tomcat82</span>
ping: tomcat82: Name or <span class="token function">service</span> not known
root@91a8a3567d11:/usr/local/tomcat<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h6 id="_3、自定义网络之后"><a href="#_3、自定义网络之后" class="header-anchor">#</a> 3、自定义网络之后</h6> <blockquote><p>自定义桥接网络,自定义网络默认使用的是桥接网络bridge</p></blockquote> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker network ls</span>
NETWORK ID     NAME      DRIVER    SCOPE
718aa0f569ac   bridge    bridge    <span class="token builtin class-name">local</span>
15bd0ffe79b0   <span class="token function">host</span>      <span class="token function">host</span>      <span class="token builtin class-name">local</span>
28741f9b037c   none      null      <span class="token builtin class-name">local</span>
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker network create xiaobear-network</span>
490b2d2ac003088758a7b0fa6cb8840ffe4c34b935d0e5b0d683ee55b42256b5
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker network ls</span>
NETWORK ID     NAME               DRIVER    SCOPE
718aa0f569ac   bridge             bridge    <span class="token builtin class-name">local</span>
15bd0ffe79b0   <span class="token function">host</span>               <span class="token function">host</span>      <span class="token builtin class-name">local</span>
28741f9b037c   none               null      <span class="token builtin class-name">local</span>
490b2d2ac003   xiaobear-network   bridge    <span class="token builtin class-name">local</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>新建容器加入上一步新建的自定义网络</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">8081</span>:8080 --network xiaobear-network  --name tomcat81 billygoo/tomcat8-jdk8
<span class="token function">docker</span> run -d -p <span class="token number">8082</span>:8080 --network xiaobear-network  --name tomcat82 billygoo/tomcat8-jdk8
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>互相ping测试</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -d -p 8081:8080 --network xiaobear-network  --name tomcat81 billygoo/tomcat8-jdk8</span>
d39d6f0c02b99566a12dbbe05f3f94e4bd63de4103e19b676fa81001bd33e378
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker run -d -p 8082:8080 --network xiaobear-network  --name tomcat82 billygoo/tomcat8-jdk8</span>
8a84293be606ff235d9c24372703dc48db3da4e84903d0e85b7120e855082b5f
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker exec -it tomcat81 bash</span>
root@d39d6f0c02b9:/usr/local/tomcat<span class="token comment">## ping tomcat82</span>
PING tomcat82 <span class="token punctuation">(</span><span class="token number">172.18</span>.0.3<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.
<span class="token number">64</span> bytes from tomcat82.xiaobear-network <span class="token punctuation">(</span><span class="token number">172.18</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.699</span> ms
<span class="token number">64</span> bytes from tomcat82.xiaobear-network <span class="token punctuation">(</span><span class="token number">172.18</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.173</span> ms
<span class="token number">64</span> bytes from tomcat82.xiaobear-network <span class="token punctuation">(</span><span class="token number">172.18</span>.0.3<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">3</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">64</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">0.140</span> ms
^C
--- tomcat82 <span class="token function">ping</span> statistics ---
<span class="token number">3</span> packets transmitted, <span class="token number">3</span> received, <span class="token number">0</span>% packet loss, <span class="token function">time</span> 2003ms
rtt min/avg/max/mdev <span class="token operator">=</span> <span class="token number">0.140</span>/0.337/0.699/0.256 ms
root@d39d6f0c02b9:/usr/local/tomcat<span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>总结：<strong>自定义网络本身就维护好了主机名和ip的对应关系（ip和域名都能通）</strong></p> <h3 id="_5、docker平台架构图解"><a href="#_5、docker平台架构图解" class="header-anchor">#</a> 5、Docker平台架构图解</h3> <h4 id="_1、整体说明"><a href="#_1、整体说明" class="header-anchor">#</a> 1、整体说明</h4> <blockquote><p>从其架构和运行流程来看，Docker 是一个 C/S 模式的架构，后端是一个松耦合架构，众多模块各司其职。</p></blockquote> <p>Docker 运行的基本流程为：</p> <ol><li>用户是使用 Docker Client 与 Docker Daemon 建立通信，并发送请求给后者。</li> <li>Docker Daemon 作为 Docker 架构中的主体部分，首先提供 Docker Server 的功能使其可以接受 Docker Client 的请求。</li> <li>Docker Engine 执行 Docker 内部的一系列工作，每一项工作都是以一个 Job 的形式的存在。</li> <li>Job 的运行过程中，当需要容器镜像时，则从 Docker Registry 中下载镜像，并通过镜像管理驱动 Graph driver将下载镜像以Graph的形式存储。</li> <li>当需要为 Docker 创建网络环境时，通过网络管理驱动 Network driver 创建并配置 Docker 容器网络环境。</li> <li>当需要限制 Docker 容器运行资源或执行用户指令等操作时，则通过 Execdriver 来完成。</li> <li>Libcontainer是一项独立的容器管理包，Network driver以及Exec driver都是通过Libcontainer来实现具体对容器进行的操作。</li></ol> <h4 id="_2、整体架构"><a href="#_2、整体架构" class="header-anchor">#</a> 2、整体架构</h4> <p><img src="/assets/img/image-20220517220507212.02fd2ae1.png" alt="image-20220517220507212"></p> <h2 id="_13、docker-compose容器编排"><a href="#_13、docker-compose容器编排" class="header-anchor">#</a> 13、Docker-compose容器编排</h2> <h3 id="_1、什么是compose"><a href="#_1、什么是compose" class="header-anchor">#</a> 1、什么是compose</h3> <blockquote><p>Compose 是 Docker 公司推出的一个工具软件，可以管理多个 Docker 容器组成一个应用。你需要定义一个 YAML 格式的配置文件docker-compose.yml，写好多个容器之间的调用关系。然后，只要一个命令，就能同时启动/关闭这些容器.</p> <p>Docker-Compose是Docker官方的开源项目，负责实现对Docker容器集群的快速编排。</p></blockquote> <h3 id="_2、作用-2"><a href="#_2、作用-2" class="header-anchor">#</a> 2、作用</h3> <p>docker建议我们每一个容器中只运行一个服务,因为docker容器本身占用资源极少,所以最好是将每个服务单独的分割开来但是这样我们又面临了一个问题？</p> <p>如果我需要同时部署好多个服务,难道要每个服务单独写Dockerfile然后在构建镜像,构建容器,这样累都累死了,所以docker官方给我们提供了docker-compose多服务部署的工具</p> <p>例如要实现一个Web微服务项目，除了Web服务容器本身，往往还需要再加上后端的数据库mysql服务容器，redis服务器，注册中心eureka，甚至还包括负载均衡容器等等。。。。。。</p> <blockquote><p>Compose允许用户通过一个单独的docker-compose.yml模板文件（YAML 格式）来定义一组相关联的应用容器为一个项目（project）。</p> <p>可以很容易地用一个配置文件定义一个多容器的应用，然后使用一条指令安装这个应用的所有依赖，完成构建。Docker-Compose 解决了容器与容器之间如何管理编排的问题。</p></blockquote> <h3 id="_3、安装"><a href="#_3、安装" class="header-anchor">#</a> 3、安装</h3> <p>官网地址：https://docs.docker.com/compose/compose-file/compose-file-v3/、</p> <p>官网下载：https://docs.docker.com/compose/install/</p> <p>安装步骤：</p> <p>官网教程：https://docs.docker.com/compose/install/</p> <ol><li><p>下载二进制文件</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">curl</span> -L <span class="token string">&quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -s<span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> -m<span class="token variable">)</span></span>&quot;</span> -o /usr/local/bin/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>对二进制文件应用可执行权限</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">## 为所有用户安装 </span>
<span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>测试</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker-compose</span> --version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ol> <h4 id="卸载🔗"><a href="#卸载🔗" class="header-anchor">#</a> 卸载<a href="https://docs.docker.com/compose/install/#uninstallation" target="_blank" rel="noopener noreferrer">🔗<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></h4> <p>如果您使用以下方式安装 Docker Compose，请卸载<code>curl</code>：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">rm</span> <span class="token variable">$DOCKER_CONFIG</span>/cli-plugins/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>或者如果您选择为所有用户安装 Compose</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>$ <span class="token function">sudo</span> <span class="token function">rm</span> /usr/local/lib/docker/cli-plugins/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_4、compose核心概念"><a href="#_4、compose核心概念" class="header-anchor">#</a> 4、Compose核心概念</h3> <blockquote><p>主要是：一文件和两要素</p> <p>一文件：<code>docker-compose.yml</code></p> <p>两要素：</p> <ul><li>服务（service）：一个个应用容器实例，比如订单微服务、库存微服务、mysql容器、nginx容器或者redis容器</li> <li>工程（project）：由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义。</li></ul></blockquote> <h3 id="_5、compose使用的三个步骤"><a href="#_5、compose使用的三个步骤" class="header-anchor">#</a> 5、Compose使用的三个步骤</h3> <ol><li>编写Dockerfile定义各个微服务应用并构建出对应的镜像文件</li> <li>使用 docker-compose.yml 定义一个完整业务单元，安排好整体应用中的各个容器服务。</li> <li>最后，执行docker-compose up命令 来启动并运行整个应用程序，完成一键部署上线</li></ol> <h3 id="_6、compose常用命令"><a href="#_6、compose常用命令" class="header-anchor">#</a> 6、Compose常用命令</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker-compose</span> -h                           <span class="token comment">## 查看帮助</span>
<span class="token function">docker-compose</span> up                           <span class="token comment">## 启动所有docker-compose服务</span>
<span class="token function">docker-compose</span> up -d                        <span class="token comment">## 启动所有docker-compose服务并后台运行</span>
<span class="token function">docker-compose</span> down                         <span class="token comment">## 停止并删除容器、网络、卷、镜像。</span>
<span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span>  yml里面的服务id                 <span class="token comment">## 进入容器实例内部  docker-compose exec docker-compose.yml文件中写的服务id /bin/bash</span>
<span class="token function">docker-compose</span> <span class="token function">ps</span>                      <span class="token comment">## 展示当前docker-compose编排过的运行的所有容器</span>
<span class="token function">docker-compose</span> <span class="token function">top</span>                     <span class="token comment">## 展示当前docker-compose编排过的容器进程</span>
 
<span class="token function">docker-compose</span> logs  yml里面的服务id     <span class="token comment">## 查看容器输出日志</span>
<span class="token function">docker-compose</span> config     <span class="token comment">## 检查配置</span>
<span class="token function">docker-compose</span> config -q  <span class="token comment">## 检查配置，有问题才有输出</span>
<span class="token function">docker-compose</span> restart   <span class="token comment">## 重启服务</span>
<span class="token function">docker-compose</span> start     <span class="token comment">## 启动服务</span>
<span class="token function">docker-compose</span> stop      <span class="token comment">## 停止服务</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_7、compose编排微服务"><a href="#_7、compose编排微服务" class="header-anchor">#</a> 7、Compose编排微服务</h3> <h4 id="_1、修改之前的微服务项目"><a href="#_1、修改之前的微服务项目" class="header-anchor">#</a> 1、修改之前的微服务项目</h4> <h5 id="_1、sql建库建表"><a href="#_1、sql建库建表" class="header-anchor">#</a> 1、SQL建库建表</h5> <div class="language-sql line-numbers-mode"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>t_user<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>sex<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'性别 0=女 1=男 '</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>deleted<span class="token punctuation">`</span></span> <span class="token keyword">tinyint</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'0'</span> <span class="token keyword">COMMENT</span> <span class="token string">'删除标志，默认0不删除，1删除'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>update_time<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新时间'</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>create_time<span class="token punctuation">`</span></span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'用户表'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="_2、利用mybatisx一键生成代码"><a href="#_2、利用mybatisx一键生成代码" class="header-anchor">#</a> 2、利用MybatisX一键生成代码</h5> <h5 id="_3、改pom"><a href="#_3、改pom" class="header-anchor">#</a> 3、改pom</h5> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>druid.version</span><span class="token punctuation">&gt;</span></span>1.1.16<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>druid.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mybatis.spring.boot.version</span><span class="token punctuation">&gt;</span></span>1.3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mybatis.spring.boot.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log4j.version</span><span class="token punctuation">&gt;</span></span>1.2.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log4j.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lombok.version</span><span class="token punctuation">&gt;</span></span>1.16.18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>lombok.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--guava Google 开源的 Guava 中自带的布隆过滤器--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.guava<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>guava<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>23.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- redisson --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.13.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--springCache--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--SpringBoot集成druid连接池--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>druid<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${druid.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--mybatis和springboot整合--&gt;</span>
<span class="token comment">&lt;!--        &lt;dependency&gt;--&gt;</span>
<span class="token comment">&lt;!--            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;--&gt;</span>
<span class="token comment">&lt;!--            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;--&gt;</span>
<span class="token comment">&lt;!--            &lt;version&gt;${mybatis.spring.boot.version}&lt;/version&gt;--&gt;</span>
<span class="token comment">&lt;!--        &lt;/dependency&gt;--&gt;</span>
        <span class="token comment">&lt;!--mybatis-plus--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--需要添加这个依耐--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-extension<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 添加springboot对amqp的支持 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-amqp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${log4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${lombok.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>


        <span class="token comment">&lt;!--hutool--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.hutool<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hutool-all<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${junit.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--springCache连接池依赖包--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- jedis --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br></div></div><h5 id="_4、写yaml"><a href="#_4、写yaml" class="header-anchor">#</a> 4、写yaml</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6688</span>
<span class="token comment">#数据库连接配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.130.132<span class="token punctuation">:</span>3306/docker<span class="token punctuation">-</span>compose<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf-8&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>
      <span class="token key atrule">test-while-idle</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment">#redis配置</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.130.132
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>1ms
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">swagger2</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token comment">#myabtis配置</span>
<span class="token comment">#mybatis:</span>
<span class="token comment">##  mapper-locations: classpath:mapper/*.xml</span>
<span class="token comment">##  type-aliases-package: com.xiaobear.dockerboot.domain</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h5 id="_5、业务类"><a href="#_5、业务类" class="header-anchor">#</a> 5、业务类</h5> <h6 id="_1、配置类"><a href="#_1、配置类" class="header-anchor">#</a> 1、配置类</h6> <p><code>RedisConfig</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">LettuceConnectionFactory</span> connectionFactory<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置key序列化方式string</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置value序列化方式string</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p><code>SwaggerConfig</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableSwagger2</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebMvcConfigurationSupport</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.swagger2.enabled}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> enable<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">addResourceHandlers</span><span class="token punctuation">(</span><span class="token class-name">ResourceHandlerRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">&quot;doc.html&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/META-INF/resources/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">&quot;swagger-ui.html&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/META-INF/resources/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        registry<span class="token punctuation">.</span><span class="token function">addResourceHandler</span><span class="token punctuation">(</span><span class="token string">&quot;/webjars/**&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addResourceLocations</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/META-INF/resources/webjars/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">addResourceHandlers</span><span class="token punctuation">(</span>registry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">Docket</span> <span class="token function">createRestApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span><span class="token class-name">DocumentationType</span><span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>enable<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">//你自己的package</span>
                <span class="token punctuation">.</span><span class="token function">apis</span><span class="token punctuation">(</span><span class="token class-name">RequestHandlerSelectors</span><span class="token punctuation">.</span><span class="token function">basePackage</span><span class="token punctuation">(</span><span class="token string">&quot;com.xiaobear.dockerboot.controller&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ApiInfo</span> <span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">&quot;xiaobear学Java&quot;</span><span class="token operator">+</span><span class="token string">&quot;\t&quot;</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">&quot;docker-compose&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">&quot;1.0&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">termsOfServiceUrl</span><span class="token punctuation">(</span><span class="token string">&quot;https://www.xiaobear.com/&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><ul><li>SpringBoot集成swagger后出现: Failed to start bean ‘documentationPluginsBootstrapper‘的解决方法</li></ul> <blockquote><p>解决办法：在启动类加一个注解：@EnableWebMvc</p></blockquote> <ul><li><p>访问swagger出现404，后端没有异常报错信息</p> <blockquote><p>原因：swagger版本与spring boot版本不兼容 建议降低版本</p></blockquote></li></ul> <h6 id="_2、domain"><a href="#_2、domain" class="header-anchor">#</a> 2、domain</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span>value <span class="token operator">=</span><span class="token string">&quot;t_user&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TUser</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
     * 
     */</span>
    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 用户名
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 密码
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 性别 0=女 1=男 
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> sex<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 删除标志，默认0不删除，1删除
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> deleted<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 更新时间
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updateTime<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 创建时间
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h6 id="_3、service"><a href="#_3、service" class="header-anchor">#</a> 3、service</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">TUserService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TUser</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 新增用户
     * @param user
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token class-name">TUser</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 查询用户通过Id
     * @param id
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">TUser</span> <span class="token function">selectUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TUserServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TUserMapper</span><span class="token punctuation">,</span> <span class="token class-name">TUser</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">TUserService</span><span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> CACHE_KEY_USER <span class="token operator">=</span> <span class="token string">&quot;user:&quot;</span><span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">TUserMapper</span> userMapper<span class="token punctuation">;</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token class-name">TUser</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1 先插入mysql并成功</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//2 需要再次查询一下mysql将数据捞回来并ok</span>
            user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//3 将捞出来的user存进redis，完成新增功能的数据一致性。</span>
            <span class="token class-name">String</span> key <span class="token operator">=</span> CACHE_KEY_USER<span class="token operator">+</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">TUser</span> <span class="token function">selectUserById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">TUser</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> key <span class="token operator">=</span> CACHE_KEY_USER<span class="token operator">+</span>id<span class="token punctuation">;</span>

        <span class="token comment">//1 先从redis里面查询，如果有直接返回结果，如果没有再去查询mysql</span>
        user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TUser</span><span class="token punctuation">)</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">//2 redis里面无，继续查询mysql</span>
            user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token comment">//3.1 redis+mysql 都无数据</span>
                <span class="token comment">//你具体细化，防止多次穿透，我们规定，记录下导致穿透的这个key回写redis</span>
                <span class="token keyword">return</span> user<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                <span class="token comment">//3.2 mysql有，需要将数据写回redis，保证下一次的缓存命中率</span>
                redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> user<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><h6 id="_4、mapper-xml"><a href="#_4、mapper-xml" class="header-anchor">#</a> 4、Mapper.xml</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">&quot;1.0&quot;</span> encoding<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE mapper
        PUBLIC <span class="token string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
        <span class="token string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>mapper namespace<span class="token operator">=</span><span class="token string">&quot;com.xiaobear.dockerboot.mapper.TUserMapper&quot;</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>resultMap id<span class="token operator">=</span><span class="token string">&quot;BaseResultMap&quot;</span> type<span class="token operator">=</span><span class="token string">&quot;com.xiaobear.dockerboot.domain.TUser&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>id property<span class="token operator">=</span><span class="token string">&quot;id&quot;</span> column<span class="token operator">=</span><span class="token string">&quot;id&quot;</span> jdbcType<span class="token operator">=</span><span class="token string">&quot;INTEGER&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;username&quot;</span> column<span class="token operator">=</span><span class="token string">&quot;username&quot;</span> jdbcType<span class="token operator">=</span><span class="token string">&quot;VARCHAR&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> column<span class="token operator">=</span><span class="token string">&quot;password&quot;</span> jdbcType<span class="token operator">=</span><span class="token string">&quot;VARCHAR&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;sex&quot;</span> column<span class="token operator">=</span><span class="token string">&quot;sex&quot;</span> jdbcType<span class="token operator">=</span><span class="token string">&quot;TINYINT&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;deleted&quot;</span> column<span class="token operator">=</span><span class="token string">&quot;deleted&quot;</span> jdbcType<span class="token operator">=</span><span class="token string">&quot;TINYINT&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;updateTime&quot;</span> column<span class="token operator">=</span><span class="token string">&quot;update_time&quot;</span> jdbcType<span class="token operator">=</span><span class="token string">&quot;TIMESTAMP&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;createTime&quot;</span> column<span class="token operator">=</span><span class="token string">&quot;create_time&quot;</span> jdbcType<span class="token operator">=</span><span class="token string">&quot;TIMESTAMP&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>resultMap<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>sql id<span class="token operator">=</span><span class="token string">&quot;Base_Column_List&quot;</span><span class="token operator">&gt;</span>
        id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">,</span>
        sex<span class="token punctuation">,</span>deleted<span class="token punctuation">,</span>update_time<span class="token punctuation">,</span>
        create_time
    <span class="token operator">&lt;</span><span class="token operator">/</span>sql<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>mapper<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h6 id="_5、controller"><a href="#_5、controller" class="header-anchor">#</a> 5、controller</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>description <span class="token operator">=</span> <span class="token string">&quot;用户User接口&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DockerController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${server.port}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> port<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">TUserService</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/hello&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;hello, docker-boot&quot;</span> <span class="token operator">+</span> port <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;新增用户&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/insert/user&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TUser</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">&quot;xiaobear-&quot;</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">IdUtil</span><span class="token punctuation">.</span><span class="token function">simpleUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            user<span class="token punctuation">.</span><span class="token function">setSex</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            userService<span class="token punctuation">.</span><span class="token function">insertUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">&quot;查询1条记录&quot;</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/user/find/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">TUser</span> <span class="token function">findUserById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> userService<span class="token punctuation">.</span><span class="token function">selectUserById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><h6 id="_6、主启动类"><a href="#_6、主启动类" class="header-anchor">#</a> 6、主启动类</h6> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableWebMvc</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.xiaobear.dockerboot.mapper&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DockerBootApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">DockerBootApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="_6、本地测试完进行打包"><a href="#_6、本地测试完进行打包" class="header-anchor">#</a> 6、本地测试完进行打包</h5> <blockquote><p>mvn package命令将微服务形成新的jar包
并上传到Linux服务器/mydocker目录下</p></blockquote> <h5 id="_7、编写dockerfile"><a href="#_7、编写dockerfile" class="header-anchor">#</a> 7、编写Dockerfile</h5> <div class="language-dockerfile line-numbers-mode"><pre class="language-dockerfile"><code><span class="token comment">## 基础镜像使用java</span>
<span class="token instruction"><span class="token keyword">FROM</span> java:8</span>
<span class="token comment">## 作者</span>
<span class="token instruction"><span class="token keyword">MAINTAINER</span> xiaobear</span>
<span class="token comment">## VOLUME 指定临时文件目录为/tmp，在主机/var/lib/docker目录下创建了一个临时文件并链接到容器的/tmp</span>
<span class="token instruction"><span class="token keyword">VOLUME</span> /tmp</span>
<span class="token comment">## 将jar包添加到容器中并更名为xiaobear_docker.jar</span>
<span class="token instruction"><span class="token keyword">ADD</span> Docker-Boot-0.0.1-SNAPSHOT.jar xiaobear_docker.jar</span>
<span class="token comment">## 运行jar包</span>
<span class="token instruction"><span class="token keyword">RUN</span> bash -c <span class="token string">'touch /xiaobear_docker.jar'</span></span>
<span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [<span class="token string">&quot;java&quot;</span>,<span class="token string">&quot;-jar&quot;</span>,<span class="token string">&quot;/xiaobear_docker.jar&quot;</span>]</span>
<span class="token comment">#暴露6688端口作为微服务</span>
<span class="token instruction"><span class="token keyword">EXPOSE</span> 6688</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="_8、构建镜像"><a href="#_8、构建镜像" class="header-anchor">#</a> 8、构建镜像</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> build -t xiaobear-docker-boot:2.0 <span class="token builtin class-name">.</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2、不适用compose编排"><a href="#_2、不适用compose编排" class="header-anchor">#</a> 2、不适用Compose编排</h4> <h5 id="_1、启动mysql实例"><a href="#_1、启动mysql实例" class="header-anchor">#</a> 1、启动mysql实例</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -p <span class="token number">3306</span>:3306 --name mysql-master <span class="token punctuation">\</span>
-v /mydata/mysql-master/log:/var/log/mysql <span class="token punctuation">\</span>
-v /mydata/mysql-master/data:/var/lib/mysql <span class="token punctuation">\</span>
-v /mydata/mysql-master/conf:/etc/mysql <span class="token punctuation">\</span>
-e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root  <span class="token punctuation">\</span>
-d mysql:5.7
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>进入mysql容器实例并新建库docker-compose+新建表t_user</p> <h5 id="_2、启动redis实例"><a href="#_2、启动redis实例" class="header-anchor">#</a> 2、启动redis实例</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run  -p <span class="token number">6379</span>:6379 --name myredis --privileged<span class="token operator">=</span>true -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis redis-server /etc/redis/redis.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_3、启动微服务实例"><a href="#_3、启动微服务实例" class="header-anchor">#</a> 3、启动微服务实例</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -it -d -p <span class="token number">6688</span>:6688 xiaobear-docker-boot:2.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_4、测试微服务"><a href="#_4、测试微服务" class="header-anchor">#</a> 4、测试微服务</h5> <p>http://localhost:你的微服务端口/swagger-ui.html#/</p> <h5 id="_5、存在的问题"><a href="#_5、存在的问题" class="header-anchor">#</a> 5、存在的问题</h5> <ul><li>先后顺序要求固定，先mysql+redis才能微服务访问成功</li> <li>多个run命令......</li> <li>容器间的启停或宕机，有可能导致IP地址对应的容器实例变化，映射出错，要么生产IP写死(可以但是不推荐)，要么通过服务调用</li></ul> <h4 id="_3、使用compose"><a href="#_3、使用compose" class="header-anchor">#</a> 3、使用Compose</h4> <blockquote><p>服务编排，一套带走，安排</p></blockquote> <h5 id="_1、编写docker-compose-yml"><a href="#_1、编写docker-compose-yml" class="header-anchor">#</a> 1、编写docker-compose.yml</h5> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&quot;3&quot;</span>
 
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">microService</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> xiaobear<span class="token punctuation">-</span>docker<span class="token punctuation">-</span>boot<span class="token punctuation">:</span><span class="token number">2.0</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> ms01
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;6688:6688&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /app/microService<span class="token punctuation">:</span>/data
    <span class="token key atrule">networks</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> xiaobear<span class="token punctuation">-</span>network 
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> redis
      <span class="token punctuation">-</span> mysql
 
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;6379:6379&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> /app/redis/redis.conf<span class="token punctuation">:</span>/etc/redis/redis.conf
      <span class="token punctuation">-</span> /app/redis/data<span class="token punctuation">:</span>/data
    <span class="token key atrule">networks</span><span class="token punctuation">:</span> 
      <span class="token punctuation">-</span> xiaobear<span class="token punctuation">-</span>network
    <span class="token key atrule">command</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>server /etc/redis/redis.conf
 
  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">'123456'</span>
      <span class="token key atrule">MYSQL_ALLOW_EMPTY_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">'no'</span>
      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> <span class="token string">'docker-compose'</span>
      <span class="token key atrule">MYSQL_USER</span><span class="token punctuation">:</span> <span class="token string">'xiaobear'</span>
      <span class="token key atrule">MYSQL_PASSWORD</span><span class="token punctuation">:</span> <span class="token string">'zzyy123'</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> <span class="token string">&quot;3306:3306&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
       <span class="token punctuation">-</span> /app/mysql/db<span class="token punctuation">:</span>/var/lib/mysql
       <span class="token punctuation">-</span> /app/mysql/conf/my.cnf<span class="token punctuation">:</span>/etc/my.cnf
       <span class="token punctuation">-</span> /app/mysql/init<span class="token punctuation">:</span>/docker<span class="token punctuation">-</span>entrypoint<span class="token punctuation">-</span>initdb.d
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> xiaobear<span class="token punctuation">-</span>network
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>default<span class="token punctuation">-</span>authentication<span class="token punctuation">-</span>plugin=mysql_native_password <span class="token comment">#解决外部无法访问</span>
 
<span class="token key atrule">networks</span><span class="token punctuation">:</span> 
   <span class="token key atrule">xiaobear-network</span><span class="token punctuation">:</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h5 id="_2、改造微服务"><a href="#_2、改造微服务" class="header-anchor">#</a> 2、改造微服务</h5> <blockquote><p>通过服务名访问，IP无关</p></blockquote> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6688</span>
<span class="token comment">#数据库连接配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//mysql<span class="token punctuation">:</span>3306/docker<span class="token punctuation">-</span>compose<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf-8&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>
      <span class="token key atrule">test-while-idle</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment">#redis配置</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>1ms
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">swagger2</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token comment">#myabtis配置</span>
<span class="token comment">#mybatis:</span>
<span class="token comment">##  mapper-locations: classpath:mapper/*.xml</span>
<span class="token comment">##  type-aliases-package: com.xiaobear.dockerboot.domain</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>上传构建镜像</p> <h5 id="_3、执行docker-compose"><a href="#_3、执行docker-compose" class="header-anchor">#</a> 3、执行docker-compose</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker-compose</span> up
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_4、测试-2"><a href="#_4、测试-2" class="header-anchor">#</a> 4、测试</h5> <p>访问：http://localhost:你的微服务端口/swagger-ui.html#/</p> <h5 id="_5、关停"><a href="#_5、关停" class="header-anchor">#</a> 5、关停</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker mydocker<span class="token punctuation">]</span><span class="token comment">## docker-compose stop</span>
Stopping ms01             <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Stopping mydocker_mysql_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
Stopping mydocker_redis_1 <span class="token punctuation">..</span>. <span class="token keyword">done</span>
<span class="token punctuation">[</span>root@docker mydocker<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="_14、docker轻量级可视化工具portainer"><a href="#_14、docker轻量级可视化工具portainer" class="header-anchor">#</a> 14、Docker轻量级可视化工具Portainer</h2> <blockquote><p>Portainer 是一款轻量级的应用，它提供了图形化界面，用于方便地管理Docker环境，包括单机环境和集群环境。</p></blockquote> <p>官网地址：https://www.portainer.io/</p> <h3 id="_1、安装"><a href="#_1、安装" class="header-anchor">#</a> 1、安装</h3> <h4 id="_1、docker命令安装"><a href="#_1、docker命令安装" class="header-anchor">#</a> 1、docker命令安装</h4> <p>首次没有安装，系统会自己下载镜像并运行</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run -d -p <span class="token number">8000</span>:8000 -p <span class="token number">9000</span>:9000 --name portainer     --restart<span class="token operator">=</span>always     -v /var/run/docker.sock:/var/run/docker.sock     -v portainer_data:/data     portainer/portainer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2、访问"><a href="#_2、访问" class="header-anchor">#</a> 2、访问</h4> <p>第一次登录需创建admin，访问地址：xxx.xxx.xxx.xxx:9000，然后设置用户名和密码（<strong>密码需8位</strong>）登录</p> <p><img src="/assets/img/image-20220520112525713.7657ca21.png" alt="image-20220520112525713"></p> <h4 id="_3、图形化界面-一顿操作"><a href="#_3、图形化界面-一顿操作" class="header-anchor">#</a> 3、图形化界面，一顿操作</h4> <p><img src="/assets/img/image-20220520112851418.12cdfb88.png" alt="image-20220520112851418"></p> <h4 id="_4、安装镜像示例nginx"><a href="#_4、安装镜像示例nginx" class="header-anchor">#</a> 4、安装镜像示例<code>nginx</code></h4> <p><img src="/assets/img/image-20220520112957022.ba2915cd.png" alt="image-20220520112957022"></p> <h2 id="_15、docker容器监控之cadvisor-influxdb-granfana"><a href="#_15、docker容器监控之cadvisor-influxdb-granfana" class="header-anchor">#</a> 15、Docker容器监控之<code>CAdvisor</code>+<code>InfluxDB</code>+<code>Granfana</code></h2> <h3 id="_1、原生监控"><a href="#_1、原生监控" class="header-anchor">#</a> 1、原生监控</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> stats
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="data:image/png;base64,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" alt="image-20220520113151905"></p> <p>通过docker stats命令可以很方便的看到当前宿主机上所有容器的CPU,内存以及网络流量等数据，一般小公司够用了。。。。但是，</p> <p>docker stats统计结果只能是当前宿主机的全部容器，数据资料是实时的，没有地方存储、没有健康指标过线预警等功能。</p> <p>docker容器监控三剑客就可很好的解决上述问题;</p> <h3 id="_2、容器监控三剑客"><a href="#_2、容器监控三剑客" class="header-anchor">#</a> 2、容器监控三剑客</h3> <p><img src="/assets/img/image-20220520113330562.985e3724.png" alt="image-20220520113330562"></p> <blockquote><p><code>CAdvisor</code>：监控收集</p> <p><code>InfluxDB</code>：存储数据</p> <p><code>Granfana</code>：展示图表</p></blockquote> <h4 id="_1、cadvisor"><a href="#_1、cadvisor" class="header-anchor">#</a> 1、<code>CAdvisor</code></h4> <blockquote><p>CAdvisor是Google开源的一款用于展示和分析容器运行状态的可视化工具。通过在主机上运行CAdvisor用户可以轻松的获取到当前主机上容器的运行统计信息，并以图表的形式向用户展示。</p></blockquote> <p><img src="/assets/img/image-20220520113435507.e739fb5a.png" alt="image-20220520113435507"></p> <h4 id="_2、influxdb"><a href="#_2、influxdb" class="header-anchor">#</a> 2、<code>InfluxDB</code></h4> <blockquote><p>InfluxDB是一个用于存储和分析时间序列数据的开源数据库。</p> <p>InfluxDB是用Go语言编写的一个开源分布式时序、事件和指标数据库，无需外部依赖。CAdvⅵso默认只在本机保存最近2分钟的数据，为了持久化存储数据和统一收集展示监控数据，需要将数据存储到InfluxDB中。InfluxDB是一个时序数据库，专门用于存储时序相关数据，很适合存储CAdvisorE的数据。而且，CAdvisorz本身已经提供了InfluxDB的集成方法，丰启动容器时指定配置即可。</p></blockquote> <p>主要特性有：</p> <ul><li>内置HTTP接口，使用方便</li> <li>数据可以打标记，这样查询可以很灵活</li> <li>类SQL的查询语句</li> <li>安装管理很简单，并且读写数据很高效</li> <li>能够实时查询，数据在写入时被索引后就能够被立即查出</li> <li>基于时间序列，支持与时间有关的相关函数（如最大、最小、求和等）：</li> <li>可度量性：你可以实时对大量数据进行计算：</li> <li>基于事件：它支持任意的事件数据：</li></ul> <h4 id="_3、granfana"><a href="#_3、granfana" class="header-anchor">#</a> 3、<code>Granfana</code></h4> <blockquote><p>Grafana是一个开源的数据监控分析可视化平台，支持多种数据源配置（支持的数据源包括InfluxDB,MySQL,Elasticsearch,OpenTSDB,Graphite等）和丰富的插件及模板功能，支持图表权限控制和报警。
Grafan主要特性：</p> <ul><li>灵活丰富的图形化选项</li> <li>可以混合多种风格</li> <li>支持白天和夜间模式</li> <li>多个数据源</li></ul></blockquote> <h3 id="_3、compose容器编排安装"><a href="#_3、compose容器编排安装" class="header-anchor">#</a> 3、compose容器编排安装</h3> <h4 id="_1、编写docker-compose-yml-2"><a href="#_1、编写docker-compose-yml-2" class="header-anchor">#</a> 1、编写docker-compose.yml</h4> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span>
 
<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">grafana_data</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
 
<span class="token key atrule">services</span><span class="token punctuation">:</span>
 <span class="token key atrule">influxdb</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> tutum/influxdb<span class="token punctuation">:</span><span class="token number">0.9</span>
  <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
  <span class="token key atrule">environment</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> PRE_CREATE_DB=cadvisor
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8083:8083&quot;</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8086:8086&quot;</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ./data/influxdb<span class="token punctuation">:</span>/data
 
 <span class="token key atrule">cadvisor</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> google/cadvisor
  <span class="token key atrule">links</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> influxdb<span class="token punctuation">:</span>influxsrv
  <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">-</span>storage_driver=influxdb <span class="token punctuation">-</span>storage_driver_db=cadvisor <span class="token punctuation">-</span>storage_driver_host=influxsrv<span class="token punctuation">:</span><span class="token number">8086</span>
  <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;8080:8080&quot;</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /<span class="token punctuation">:</span>/rootfs<span class="token punctuation">:</span>ro
    <span class="token punctuation">-</span> /var/run<span class="token punctuation">:</span>/var/run<span class="token punctuation">:</span>rw
    <span class="token punctuation">-</span> /sys<span class="token punctuation">:</span>/sys<span class="token punctuation">:</span>ro
    <span class="token punctuation">-</span> /var/lib/docker/<span class="token punctuation">:</span>/var/lib/docker<span class="token punctuation">:</span>ro
 
 <span class="token key atrule">grafana</span><span class="token punctuation">:</span>
  <span class="token key atrule">user</span><span class="token punctuation">:</span> <span class="token string">&quot;104&quot;</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span> grafana/grafana
  <span class="token key atrule">user</span><span class="token punctuation">:</span> <span class="token string">&quot;104&quot;</span>
  <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
  <span class="token key atrule">links</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> influxdb<span class="token punctuation">:</span>influxsrv
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token string">&quot;3000:3000&quot;</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> grafana_data<span class="token punctuation">:</span>/var/lib/grafana
  <span class="token key atrule">environment</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> HTTP_USER=admin
    <span class="token punctuation">-</span> HTTP_PASS=admin
    <span class="token punctuation">-</span> INFLUXDB_HOST=influxsrv
    <span class="token punctuation">-</span> INFLUXDB_PORT=8086
    <span class="token punctuation">-</span> INFLUXDB_NAME=cadvisor
    <span class="token punctuation">-</span> INFLUXDB_USER=root
    <span class="token punctuation">-</span> INFLUXDB_PASS=root
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h4 id="_2、启动docker-compose文件"><a href="#_2、启动docker-compose文件" class="header-anchor">#</a> 2、启动docker-compose文件</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker-compose</span> up
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_3、查看是否启动成功"><a href="#_3、查看是否启动成功" class="header-anchor">#</a> 3、查看是否启动成功</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## docker ps</span>
CONTAINER ID   IMAGE                COMMAND                  CREATED         STATUS         PORTS                                                                                  NAMES
e30c3fe24f81   grafana/grafana      <span class="token string">&quot;/run.sh&quot;</span>                <span class="token number">5</span> minutes ago   Up <span class="token number">5</span> minutes   <span class="token number">0.0</span>.0.0:3000-<span class="token operator">&gt;</span><span class="token number">3000</span>/tcp, :::3000-<span class="token operator">&gt;</span><span class="token number">3000</span>/tcp                                              cig_grafana_1
a5b68648ee70   google/cadvisor      <span class="token string">&quot;/usr/bin/cadvisor -…&quot;</span>   <span class="token number">5</span> minutes ago   Up <span class="token number">5</span> minutes   <span class="token number">0.0</span>.0.0:8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp, :::8080-<span class="token operator">&gt;</span><span class="token number">8080</span>/tcp                                              cig_cadvisor_1
9c1a8f34b02d   tutum/influxdb:0.9   <span class="token string">&quot;/run.sh&quot;</span>                <span class="token number">5</span> minutes ago   Up <span class="token number">5</span> minutes   <span class="token number">0.0</span>.0.0:8083-<span class="token operator">&gt;</span><span class="token number">8083</span>/tcp, :::8083-<span class="token operator">&gt;</span><span class="token number">8083</span>/tcp, <span class="token number">0.0</span>.0.0:8086-<span class="token operator">&gt;</span><span class="token number">8086</span>/tcp, :::8086-<span class="token operator">&gt;</span><span class="token number">8086</span>/tcp   cig_influxdb_1
<span class="token punctuation">[</span>root@docker ~<span class="token punctuation">]</span><span class="token comment">## </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_4、测试-3"><a href="#_4、测试-3" class="header-anchor">#</a> 4、测试</h4> <h5 id="_1、cadvisor收集服务"><a href="#_1、cadvisor收集服务" class="header-anchor">#</a> 1、<code>CAdvisor</code>收集服务</h5> <p>访问：http://ip:8080/</p> <p>cadvisor也有基础的图形展现功能，这里主要用它来作数据采集</p> <p><img src="/assets/img/image-20220520154218640.6a66a49b.png" alt="image-20220520154218640"></p> <h5 id="_2、influxdb存储服务"><a href="#_2、influxdb存储服务" class="header-anchor">#</a> 2、<code>influxdb</code>存储服务</h5> <p><img src="/assets/img/image-20220520154446373.6d5ce017.png" alt="image-20220520154446373"></p> <h5 id="_3、grafana展现服务"><a href="#_3、grafana展现服务" class="header-anchor">#</a> 3、<code>grafana</code>展现服务</h5> <p>访问地址：http://ip:3000</p> <blockquote><p>ip+3000端口的方式访问,默认帐户密码（admin/admin）</p></blockquote> <p><img src="/assets/img/image-20220520154435756.dd2e57b9.png" alt="image-20220520154435756"></p> <h5 id="配置步骤"><a href="#配置步骤" class="header-anchor">#</a> 配置步骤</h5> <h6 id="_1、选择数据源"><a href="#_1、选择数据源" class="header-anchor">#</a> 1、选择数据源</h6> <p><img src="/assets/img/image-20220520154609642.8e8e9f82.png" alt="image-20220520154609642"></p> <h6 id="_2、选择influxdb"><a href="#_2、选择influxdb" class="header-anchor">#</a> 2、选择<code>influxdb</code></h6> <p><img src="/assets/img/image-20220520154719077.84f20f3b.png" alt="image-20220520154719077"></p> <h6 id="_3、数据库配置"><a href="#_3、数据库配置" class="header-anchor">#</a> 3、数据库配置</h6> <p>1.配置连接</p> <p><img src="/assets/img/image-20220520154911839.6d283361.png" alt="image-20220520154911839"></p> <p>2.配置数据库用户名和密码，在docker-compose.yml的时候就已经初始化了</p> <p><img src="/assets/img/image-20220520155027713.b3d661df.png" alt="image-20220520155027713"></p> <h6 id="_4、配置面板-展示信息"><a href="#_4、配置面板-展示信息" class="header-anchor">#</a> 4、配置面板（展示信息）</h6> <p>1、新建首页</p> <p><img src="/assets/img/image-20220520155513285.950954b7.png" alt="image-20220520155513285"></p> <p>2、添加一个新面板</p> <p><img src="/assets/img/image-20220520155546766.b8b3fa50.png" alt="image-20220520155546766"></p> <p>3、选择展示服务</p> <p><img src="/assets/img/image-20220520155712050.fe322f76.png" alt="image-20220520155712050"></p> <p><img src="/assets/img/image-20220520160314311.bdd05f6e.png" alt="image-20220520160314311"></p> <p><img src="/assets/img/image-20220520160350437.04284b73.png" alt="image-20220520160350437"></p> <p>到这里cAdvisor+InfluxDB+Grafana容器监控系统就部署完成了</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022-8-12</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/notes/frame/SpringCloudNote.html" class="prev">
        Spring Cloud
      </a></span> <span class="next"><a href="/notes/frame/RabbitMQ.html">
        RabbitMQ
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div id="goTop" class="hide-cat" data-v-bf92849a></div><canvas id="vuepress-canvas-cursor"></canvas></div></div>
    <script src="/assets/js/app.37f96e4a.js" defer></script><script src="/assets/js/8.bb74f850.js" defer></script><script src="/assets/js/4.e3bae0aa.js" defer></script>
  </body>
</html>
