import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as l,c,a as n,b as a,d as t,e}from"./app-aeb4ead9.js";const i="/assets/image-20210531221223001-0eb4bcb8.png",u="/assets/image-20210527085255502-064f4812.png",r="/assets/image-20210527090616495-b43c8cf6.png",d={},k=e('<h3 id="_1、概述" tabindex="-1"><a class="header-anchor" href="#_1、概述" aria-hidden="true">#</a> 1、概述</h3><p>分布式系统面临的问题--配置问题</p><blockquote><p>微服务意味着要将单体应用中的业务拆分成一个个子服务，每个服务的粒度相对较小，因此系统中会出现大量的服务。由于每个服务都需要必要的配置信息才能运行，所以一套集中式的、动态的配置管理设施是必不可少的。</p><p>SpringCloud提供了ConfigServer来解决这个问题，我们每一个微服务自己带着一个application.yml，上百个配置文件的管理......</p></blockquote><h4 id="_1、什么是spring-cloud-config" tabindex="-1"><a class="header-anchor" href="#_1、什么是spring-cloud-config" aria-hidden="true">#</a> 1、什么是<code>Spring Cloud Config</code></h4><p><strong>SpringCloud Config为微服务架构中的微服务提供集中化的外部配置支持，配置服务器为各个不同微服务应用的所有环境提供了一个中心化的外部配置。</strong></p><p>SpringCloud Config分为<strong>服务端</strong>和<strong>客户端</strong>两部分。</p><ul><li><p>服务端也称为分布式配置中心，它是一个独立的微服务应用，用来连接配置服务器并为客户端提供获取配置信息，加密/解密信息等访问接口</p></li><li><p>客户端则是通过指定的配置中心来管理应用资源，以及与业务相关的配置内容，并在启动的时候从配置中心获取和加载配置信息配置服务器默认采用git来存储配置信息，这样就有助于对环境配置进行版本管理，并且可以通过git客户端工具来方便的管理和访问配置内容。</p></li></ul><h5 id="_1、作用" tabindex="-1"><a class="header-anchor" href="#_1、作用" aria-hidden="true">#</a> 1、作用</h5><ul><li>集中管理配置文件</li><li>不同环境不同配置，动态化的配置更新，分环境部署，比如/dev、/test、/prod、/beta、/release</li><li>运行期间动态调整配置，不再需要在每个服务部署的机器上编写配置文件，服务会向配置中心统一拉取配置自己的信息</li><li>当配置发生变动时，服务不需要重启即可感知到配置的变化并应用新的配置</li><li>将配置信息以REST接口的形式暴露 <ul><li>post、curl访问刷新即可</li></ul></li></ul><h5 id="_2、与github的整合" tabindex="-1"><a class="header-anchor" href="#_2、与github的整合" aria-hidden="true">#</a> 2、与<code>GitHub</code>的整合</h5><p><code>Spring Cloud Config</code>默认使用<code>Git</code>来存储配置文件（也有其他方式，比如SVN和本地文件），但最推荐还是<code>Git</code>，而且使用的是<code>http/https</code>访问的形式。</p><p><img src="'+i+'" alt="image-20210531221223001" loading="lazy"></p><h5 id="_3、官网" tabindex="-1"><a class="header-anchor" href="#_3、官网" aria-hidden="true">#</a> 3、官网</h5>',13),g={href:"https://docs.spring.io/spring-cloud-config/docs/current/reference/html/",target:"_blank",rel:"noopener noreferrer"},v=e('<h3 id="_2、config服务端配置与测试" tabindex="-1"><a class="header-anchor" href="#_2、config服务端配置与测试" aria-hidden="true">#</a> 2、Config服务端配置与测试</h3><h4 id="_1、在github创建仓库" tabindex="-1"><a class="header-anchor" href="#_1、在github创建仓库" aria-hidden="true">#</a> 1、在GitHub创建仓库</h4><p><img src="'+u+`" alt="image-20210527085255502" loading="lazy"></p><p>同时，新建分支dev，yml的内容随便填写</p><h4 id="_2、整合" tabindex="-1"><a class="header-anchor" href="#_2、整合" aria-hidden="true">#</a> 2、整合</h4><h5 id="_1、新建module" tabindex="-1"><a class="header-anchor" href="#_1、新建module" aria-hidden="true">#</a> 1、新建module</h5><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>xiaobear-cloud-config-center-3344
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_2、改pom-xml" tabindex="-1"><a class="header-anchor" href="#_2、改pom-xml" aria-hidden="true">#</a> 2、改pom.xml</h5><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-config-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3、写yaml" tabindex="-1"><a class="header-anchor" href="#_3、写yaml" aria-hidden="true">#</a> 3、写yaml</h5><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3344</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> cloud<span class="token punctuation">-</span>config<span class="token punctuation">-</span>center <span class="token comment">#注册进Eureka服务器的微服务名</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">server</span><span class="token punctuation">:</span>
        <span class="token key atrule">git</span><span class="token punctuation">:</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//github.com/yhx1001/Spring<span class="token punctuation">-</span>Cloud<span class="token punctuation">-</span>Config<span class="token punctuation">-</span>Test.git <span class="token comment">#GitHub上面的git仓库名字</span>

<span class="token comment">#服务注册到eureka地址</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7001/eureka
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4、主启动类" tabindex="-1"><a class="header-anchor" href="#_4、主启动类" aria-hidden="true">#</a> 4、主启动类</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@EnableConfigServer</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigApplication3344</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ConfigApplication3344</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5、测试" tabindex="-1"><a class="header-anchor" href="#_5、测试" aria-hidden="true">#</a> 5、测试</h5>`,14),h={href:"http://localhost:3344/master/config-dev.yml",target:"_blank",rel:"noopener noreferrer"},m={href:"http://localhost:3344/config-dev.yml",target:"_blank",rel:"noopener noreferrer"},b={href:"http://localhost:3344/config/dev/dev",target:"_blank",rel:"noopener noreferrer"},f=e('<p><img src="'+r+`" alt="image-20210527090616495" loading="lazy"></p><h4 id="_3、配置读取规则" tabindex="-1"><a class="header-anchor" href="#_3、配置读取规则" aria-hidden="true">#</a> 3、配置读取规则</h4><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>/{application}/{profile}[/{label}]
/{application}-{profile}.yml
/{label}/{application}-{profile}.yml
/{application}-{profile}.properties
/{label}/{application}-{profile}.properti
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>其中“应用程序”作为<code>SpringApplication</code>中的<code>spring.config.name</code>注入（即常规Spring Boot应用程序中通常为“应用程序”），“配置文件”是活动配置文件（或逗号分隔列表）的属性），“label”是可选的git标签（默认为“master”）。</p></blockquote><h5 id="_1、-application-profile-label" tabindex="-1"><a class="header-anchor" href="#_1、-application-profile-label" aria-hidden="true">#</a> 1、<code>/{application}/{profile}[/{label}]</code></h5><p>以刚刚测试的地址来测试：</p>`,6),_={href:"http://localhost:3344/config/dev/master",target:"_blank",rel:"noopener noreferrer"},y={href:"http://localhost:3344/config/pro/master",target:"_blank",rel:"noopener noreferrer"},x={href:"http://localhost:3344/config/test/master",target:"_blank",rel:"noopener noreferrer"},I={href:"http://localhost:3344/config/dev/dev",target:"_blank",rel:"noopener noreferrer"},C={href:"http://localhost:3344/config/pro/dev",target:"_blank",rel:"noopener noreferrer"},w={href:"http://localhost:3344/config/test/dev",target:"_blank",rel:"noopener noreferrer"},S=n("h5",{id:"_2、-application-profile-yml",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2、-application-profile-yml","aria-hidden":"true"},"#"),a(" 2、"),n("code",null,"/{application}-{profile}.yml")],-1),q={href:"http://localhost:3344/config-dev.yml",target:"_blank",rel:"noopener noreferrer"},A={href:"http://localhost:3344/config-pro.yml",target:"_blank",rel:"noopener noreferrer"},j={href:"http://localhost:3344/config-test.yml",target:"_blank",rel:"noopener noreferrer"},B=n("h5",{id:"_3、-label-application-profile-yml",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_3、-label-application-profile-yml","aria-hidden":"true"},"#"),a(" 3、"),n("code",null,"/{label}/{application}-{profile}.yml")],-1),E={href:"http://localhost:3344/master/config-dev.yml",target:"_blank",rel:"noopener noreferrer"},G={href:"http://localhost:3344/master/config-pro.yml",target:"_blank",rel:"noopener noreferrer"},H={href:"http://localhost:3344/master/config-test.yml",target:"_blank",rel:"noopener noreferrer"},V={href:"http://localhost:3344/dev/config-dev.yml",target:"_blank",rel:"noopener noreferrer"},N={href:"http://localhost:3344/dev/config-pro.yml",target:"_blank",rel:"noopener noreferrer"},T={href:"http://localhost:3344/dev/config-test.yml",target:"_blank",rel:"noopener noreferrer"},z=e(`<h5 id="_4、总结" tabindex="-1"><a class="header-anchor" href="#_4、总结" aria-hidden="true">#</a> 4、总结</h5><p>/{name}-{profiles}.yml</p><p>/{label}-{name}-{profiles}.yml</p><p>label：分支(branch)</p><p>name ：服务名</p><p>profiles：环境(dev/test/prod)</p><h3 id="_3、config客户端配置与测试" tabindex="-1"><a class="header-anchor" href="#_3、config客户端配置与测试" aria-hidden="true">#</a> 3、config客户端配置与测试</h3><h4 id="_1、案例" tabindex="-1"><a class="header-anchor" href="#_1、案例" aria-hidden="true">#</a> 1、案例</h4><h5 id="_1、新建module-1" tabindex="-1"><a class="header-anchor" href="#_1、新建module-1" aria-hidden="true">#</a> 1、新建module</h5><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>xiaobear-cloud-config-client-3355
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h5 id="_2、改pom-xml-1" tabindex="-1"><a class="header-anchor" href="#_2、改pom-xml-1" aria-hidden="true">#</a> 2、改pom.xml</h5><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-devtools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>optional</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>optional</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3、写yaml-1" tabindex="-1"><a class="header-anchor" href="#_3、写yaml-1" aria-hidden="true">#</a> 3、写yaml</h5><p>这里写的是<code>bootstrap.yaml</code></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">3355</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> config<span class="token punctuation">-</span>client
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token comment">#Config客户端配置</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token key atrule">label</span><span class="token punctuation">:</span> master <span class="token comment">#分支名称</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> config <span class="token comment">#配置文件名称</span>
      <span class="token key atrule">profile</span><span class="token punctuation">:</span> dev <span class="token comment">#读取后缀名称   上述3个综合：master分支上config-dev.yml的配置文件被读取http://config-3344.com:3344/master/config-dev.yml</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">3344</span> <span class="token comment">#配置中心地址k</span>

<span class="token comment">#服务注册到eureka地址</span>
<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>7001/eureka
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="_1、什么是bootstrap-yml" tabindex="-1"><a class="header-anchor" href="#_1、什么是bootstrap-yml" aria-hidden="true">#</a> 1、什么是bootstrap.yml</h6><ul><li><p>applicaiton.yml是用户级的资源配置项</p></li><li><p>bootstrap.yml是系统级的，优先级更加高</p></li></ul><blockquote><p>Spring Cloud会创建一个“Bootstrap Context”，作为Spring应用的<code>Application Context</code>的父上下文。初始化的时候，<code>Bootstrap Context</code>负责从外部源加载配置属性并解析配置。这两个上下文共享一个从外部获取的<code>Environment</code>。</p><p><code>Bootstrap</code>属性有高优先级，默认情况下，它们不会被本地配置覆盖。 <code>Bootstrap context</code>和<code>Application Context</code>有着不同的约定，所以新增了一个<code>bootstrap.yml</code>文件，保证<code>Bootstrap Context</code>和<code>Application Context</code>配置的分离。</p><p>要将Client模块下的application.yml文件改为bootstrap.yml,这是很关键的，</p><p>因为bootstrap.yml是比application.yml先加载的。bootstrap.yml优先级高于application.yml</p></blockquote><h5 id="_4、主启动类-1" tabindex="-1"><a class="header-anchor" href="#_4、主启动类-1" aria-hidden="true">#</a> 4、主启动类</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableEurekaClient</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigClientApplication3355</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ConfigClientApplication3355</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_5、业务类" tabindex="-1"><a class="header-anchor" href="#_5、业务类" aria-hidden="true">#</a> 5、业务类</h5><ul><li><p>controller</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigClientController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${spring.cloud.nacos.config.server-addr}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> configInfo<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/configInfo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getConfigInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> configInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h5 id="_6、测试" tabindex="-1"><a class="header-anchor" href="#_6、测试" aria-hidden="true">#</a> 6、测试</h5><ul><li>启动3344自测</li><li>启动3355</li></ul>`,24),L={href:"http://localhost:3344/config/dev/master",target:"_blank",rel:"noopener noreferrer"},O={href:"http://localhost:3355/configInfo",target:"_blank",rel:"noopener noreferrer"},P=e(`<p>成功实现了客户端3355访问3344通过GitHub获取配置信息</p><p>存在的问题：<strong>动态刷新</strong></p><ol><li>运维人员修改GitHub的配置</li><li>刷新3344，发现config server立即响应</li><li>刷新3355，发现没有任何反应</li><li>3355除非重新启动</li></ol><h3 id="_4、config客户端动态刷新" tabindex="-1"><a class="header-anchor" href="#_4、config客户端动态刷新" aria-hidden="true">#</a> 4、config客户端动态刷新</h3><h4 id="_1、动态刷新" tabindex="-1"><a class="header-anchor" href="#_1、动态刷新" aria-hidden="true">#</a> 1、动态刷新</h4><h5 id="_1、修改3355pom" tabindex="-1"><a class="header-anchor" href="#_1、修改3355pom" aria-hidden="true">#</a> 1、修改3355pom</h5><p>引入spring-boot-starter-actuator</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2、修改yml-暴露监控端口" tabindex="-1"><a class="header-anchor" href="#_2、修改yml-暴露监控端口" aria-hidden="true">#</a> 2、修改yml，暴露监控端口</h5><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment">## 暴露监控端点</span>
<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3、修改github文件" tabindex="-1"><a class="header-anchor" href="#_3、修改github文件" aria-hidden="true">#</a> 3、修改GitHub文件</h5>`,11),R={href:"http://localhost:3355/configInfo",target:"_blank",rel:"noopener noreferrer"},Z=n("h5",{id:"_4、运维人员激活3355",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_4、运维人员激活3355","aria-hidden":"true"},"#"),a(" 4、运维人员激活3355")],-1),M=n("p",null,"发送POST请求",-1),X={href:"http://localhost:3355/actuator/refresh",target:"_blank",rel:"noopener noreferrer"},$=n("h5",{id:"_5、再次请求",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_5、再次请求","aria-hidden":"true"},"#"),a(" 5、再次请求")],-1),D={href:"http://localhost:3355/configInfo",target:"_blank",rel:"noopener noreferrer"},F=n("p",null,"成功刷到最新配置内容--避免了服务重启",-1),J=n("p",null,[n("strong",null,"可否广播，一次通知，处处生效？")],-1);function K(Q,U){const s=o("ExternalLinkIcon");return l(),c("div",null,[k,n("p",null,[n("a",g,[a("https://docs.spring.io/spring-cloud-config/docs/current/reference/html/"),t(s)])]),v,n("ul",null,[n("li",null,[n("p",null,[n("a",h,[a("http://localhost:3344/master/config-dev.yml"),t(s)])])]),n("li",null,[n("p",null,[n("a",m,[a("http://localhost:3344/config-dev.yml"),t(s)])])]),n("li",null,[n("p",null,[n("a",b,[a("http://localhost:3344/config/dev/dev"),t(s)])])])]),f,n("ul",null,[n("li",null,[a("master分支 "),n("ul",null,[n("li",null,[n("a",_,[a("http://localhost:3344/config/dev/master"),t(s)])]),n("li",null,[n("a",y,[a("http://localhost:3344/config/pro/master"),t(s)])]),n("li",null,[n("a",x,[a("http://localhost:3344/config/test/master"),t(s)])])])]),n("li",null,[a("dev分支 "),n("ul",null,[n("li",null,[n("a",I,[a("http://localhost:3344/config/dev/dev"),t(s)])]),n("li",null,[n("a",C,[a("http://localhost:3344/config/pro/dev"),t(s)])]),n("li",null,[n("a",w,[a("http://localhost:3344/config/test/dev"),t(s)])])])])]),S,n("ul",null,[n("li",null,[n("a",q,[a("http://localhost:3344/config-dev.yml"),t(s)])]),n("li",null,[n("a",A,[a("http://localhost:3344/config-pro.yml"),t(s)])]),n("li",null,[n("a",j,[a("http://localhost:3344/config-test.yml"),t(s)])])]),B,n("ul",null,[n("li",null,[a("master "),n("ul",null,[n("li",null,[n("a",E,[a("http://localhost:3344/master/config-dev.yml"),t(s)])]),n("li",null,[n("a",G,[a("http://localhost:3344/master/config-pro.yml"),t(s)])]),n("li",null,[n("a",H,[a("http://localhost:3344/master/config-test.yml"),t(s)])])])]),n("li",null,[a("dev分支 "),n("ul",null,[n("li",null,[n("a",V,[a("http://localhost:3344/dev/config-dev.yml"),t(s)])]),n("li",null,[n("a",N,[a("http://localhost:3344/dev/config-pro.yml"),t(s)])]),n("li",null,[n("a",T,[a("http://localhost:3344/dev/config-test.yml"),t(s)])])])])]),z,n("p",null,[a("测试地址："),n("a",L,[a("http://localhost:3344/config/dev/master"),t(s)])]),n("p",null,[n("a",O,[a("http://localhost:3355/configInfo"),t(s)])]),P,n("p",null,[n("a",R,[a("http://localhost:3355/configInfo"),t(s)]),a(" 没有任何反应")]),Z,M,n("p",null,[a('curl -X POST "'),n("a",X,[a("http://localhost:3355/actuator/refresh"),t(s)]),a('"')]),$,n("p",null,[n("a",D,[a("http://localhost:3355/configInfo"),t(s)])]),F,J])}const nn=p(d,[["render",K],["__file","spring_cloud_config.html.vue"]]);export{nn as default};
