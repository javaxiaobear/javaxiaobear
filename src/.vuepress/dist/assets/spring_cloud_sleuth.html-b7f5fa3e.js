import{_ as t}from"./plugin-vue_export-helper-c27b6911.js";import{r as p,o as l,c as i,a as n,b as a,d as e,e as o}from"./app-f55ccf80.js";const c="/assets/image-20210528105453232-a5459ddf.png",r="/assets/image-20210528105545825-3e281cd0.png",u="/assets/image-20210528105558691-9dba472e.png",d="/assets/image-20210528120003999-cee9aa40.png",k={},m=n("h3",{id:"_1、概述",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_1、概述","aria-hidden":"true"},"#"),a(" 1、概述")],-1),h=n("blockquote",null,[n("p",null,"在微服务框架中，一个由客户端发起的请求在后端系统中会经过多个不同的的服务节点调用来协同产生最后的请求结果，每一个前段请求都会形成一条复杂的分布式服务调用链路，链路中的任何一环出现高延时或错误都会引起整个请求最后的失败。")],-1),v={href:"https://github.com/spring-cloud/spring-cloud-sleuth",target:"_blank",rel:"noopener noreferrer"},g=n("p",null,[n("strong",null,"Spring Cloud Sleuth提供了一套完整的服务跟踪的解决方案，在分布式系统中提供追踪解决方案并且兼容支持了zipkin。")],-1),b=n("h3",{id:"_2、搭建链路监控",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2、搭建链路监控","aria-hidden":"true"},"#"),a(" 2、搭建链路监控")],-1),_=n("blockquote",null,[n("p",null,"SpringCloud从F版起已不需要自己构建Zipkin Server了，只需调用jar包即可")],-1),y={href:"https://search.maven.org/remote_content?g=io.zipkin.java&a=zipkin-server&v=LATEST&c=exec",target:"_blank",rel:"noopener noreferrer"},x=n("p",null,[n("code",null,"zipkin-server-2.12.9-exec.jar")],-1),f=n("p",null,[a("运行："),n("code",null,"java -jar zipkin-server-2.12.9-exec.jar ")],-1),z={href:"http://localhost:9411/zipkin/",target:"_blank",rel:"noopener noreferrer"},j=o('<h4 id="_1、完整的链路图" tabindex="-1"><a class="header-anchor" href="#_1、完整的链路图" aria-hidden="true">#</a> 1、完整的链路图</h4><blockquote><p>表示一请求链路，一条链路通过Trace Id唯一标识，Span标识发起的请求信息，各span通过parent id 关联起来</p><p><img src="'+c+'" alt="image-20210528105453232" loading="lazy"></p></blockquote><h4 id="_2、解释" tabindex="-1"><a class="header-anchor" href="#_2、解释" aria-hidden="true">#</a> 2、解释</h4><p>一条链路通过Trace Id唯一标识，Span标识发起的请求信息，各span通过parent id 关联起来</p><p><img src="'+r+'" alt="image-20210528105545825" loading="lazy"></p><p><img src="'+u+`" alt="image-20210528105558691" loading="lazy"></p><h4 id="_3、名词" tabindex="-1"><a class="header-anchor" href="#_3、名词" aria-hidden="true">#</a> 3、名词</h4><p>**Trace：**类似于树结构的Span集合，表示一条调用链路，存在唯一标识</p><p>**span：**表示调用链路来源，通俗的理解span就是一次请求信息</p><h3 id="_3、监控案例" tabindex="-1"><a class="header-anchor" href="#_3、监控案例" aria-hidden="true">#</a> 3、监控案例</h3><p>这里以起初的<code>xiaobear-provider-payment8001</code>和<code>xiaobear-consumer-order80-2</code>进行监控</p><h4 id="_1、修改xiaobear-consumer-order80-2" tabindex="-1"><a class="header-anchor" href="#_1、修改xiaobear-consumer-order80-2" aria-hidden="true">#</a> 1、修改<code>xiaobear-consumer-order80-2</code></h4><h5 id="_1、pom文件增加监控依赖" tabindex="-1"><a class="header-anchor" href="#_1、pom文件增加监控依赖" aria-hidden="true">#</a> 1、pom文件增加监控依赖</h5><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token comment">&lt;!--包含了sleuth+zipkin--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-zipkin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2、yaml增加配置" tabindex="-1"><a class="header-anchor" href="#_2、yaml增加配置" aria-hidden="true">#</a> 2、yaml增加配置</h5><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaobear<span class="token punctuation">-</span>consumer<span class="token punctuation">-</span>order
  <span class="token key atrule">zipkin</span><span class="token punctuation">:</span>
    <span class="token key atrule">base-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9411</span>
    <span class="token key atrule">sleuth</span><span class="token punctuation">:</span>
      <span class="token key atrule">sampler</span><span class="token punctuation">:</span>
        <span class="token key atrule">probability</span><span class="token punctuation">:</span> <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3、业务层controller" tabindex="-1"><a class="header-anchor" href="#_3、业务层controller" aria-hidden="true">#</a> 3、业务层controller</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/payment/zipkin&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">paymentZipkin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hi ,i&#39;am paymentzipkin server fall back，O(∩_∩)O哈哈~&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2、修改xiaobear-provider-payment8001" tabindex="-1"><a class="header-anchor" href="#_2、修改xiaobear-provider-payment8001" aria-hidden="true">#</a> 2、修改xiaobear-provider-payment8001</h4><h5 id="_1、pom文件增加监控依赖-1" tabindex="-1"><a class="header-anchor" href="#_1、pom文件增加监控依赖-1" aria-hidden="true">#</a> 1、pom文件增加监控依赖</h5><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code> <span class="token comment">&lt;!--包含了sleuth+zipkin--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-zipkin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_2、yaml增加配置-1" tabindex="-1"><a class="header-anchor" href="#_2、yaml增加配置-1" aria-hidden="true">#</a> 2、yaml增加配置</h5><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaobear<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>payment<span class="token punctuation">-</span>service
  <span class="token key atrule">zipkin</span><span class="token punctuation">:</span>
    <span class="token key atrule">base-url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">9411</span>
    <span class="token key atrule">sleuth</span><span class="token punctuation">:</span>
      <span class="token key atrule">sampler</span><span class="token punctuation">:</span>
        <span class="token comment">#采样率值介于 0 到 1 之间，1 则表示全部采集</span>
        <span class="token key atrule">probability</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>xiaobear<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=true&amp;serverTimezone=GMT%2B8</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> 密码
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3、业务层controller-1" tabindex="-1"><a class="header-anchor" href="#_3、业务层controller-1" aria-hidden="true">#</a> 3、业务层controller</h5><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/payment/zipkin&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">paymentZipkin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;hi ,i&#39;am paymentzipkin server fall back，O(∩_∩)O哈哈~&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3、测试" tabindex="-1"><a class="header-anchor" href="#_3、测试" aria-hidden="true">#</a> 3、测试</h4><p>启动：</p><ul><li>7001</li><li>8001</li><li>80</li></ul><p>分别访问：</p>`,29),S={href:"http://localhost:8001/payment/payment/zipkin",target:"_blank",rel:"noopener noreferrer"},q={href:"http://localhost/payment/zipkin",target:"_blank",rel:"noopener noreferrer"},I=n("p",null,[n("img",{src:d,alt:"image-20210528120003999",loading:"lazy"})],-1);function T(w,E){const s=p("ExternalLinkIcon");return l(),i("div",null,[m,h,n("p",null,[a("官网资料："),n("a",v,[a("https://github.com/spring-cloud/spring-cloud-sleuth"),e(s)])]),g,b,_,n("p",null,[a("下载地址："),n("a",y,[a("https://search.maven.org/remote_content?g=io.zipkin.java&a=zipkin-server&v=LATEST&c=exec"),e(s)])]),x,f,n("p",null,[a("访问地址："),n("a",z,[a("http://localhost:9411/zipkin/"),e(s)])]),j,n("ul",null,[n("li",null,[n("a",S,[a("http://localhost:8001/payment/payment/zipkin"),e(s)])]),n("li",null,[n("a",q,[a("http://localhost/payment/zipkin"),e(s)])])]),I])}const N=t(k,[["render",T],["__file","spring_cloud_sleuth.html.vue"]]);export{N as default};
