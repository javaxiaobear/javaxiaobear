---
title: Spring Cloud 62é“é¢è¯•é¢˜
---
## 1ã€ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ï¼Ÿ

> ```
> The microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API. These services are built around business capabilities and independently deployable by fully automated deployment machinery. There is a bare minimum of centralized management of these services , which may be written in different programming languages and use different data storage technologies.
> ```
>
> é¦–å…ˆå¾®æœåŠ¡å¹¶æ²¡æœ‰ä¸€ä¸ªå®˜æ–¹çš„å®šä¹‰ï¼Œæƒ³è¦ç›´æ¥æè¿°å¾®æœåŠ¡æ¯”è¾ƒå›°éš¾ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹æ¯”ä¼ ç»ŸWEBåº”ç”¨ï¼Œæ¥ç†è§£ä»€ä¹ˆæ˜¯å¾®æœåŠ¡ã€‚
>
> ## 1ã€ä¼ ç»Ÿçš„webé¡¹ç›®VSå¾®æœåŠ¡
>
> ### 1ã€ä¼ ç»Ÿçš„Webé¡¹ç›®
>
> ä¼ ç»Ÿçš„WEBåº”ç”¨æ ¸å¿ƒåˆ†ä¸ºä¸šåŠ¡é€»è¾‘ã€é€‚é…å™¨ä»¥åŠAPIæˆ–é€šè¿‡UIè®¿é—®çš„WEBç•Œé¢ã€‚ä¸šåŠ¡é€»è¾‘å®šä¹‰ä¸šåŠ¡æµç¨‹ã€ä¸šåŠ¡è§„åˆ™ä»¥åŠé¢†åŸŸå®ä½“ã€‚é€‚é…å™¨åŒ…æ‹¬æ•°æ®åº“è®¿é—®ç»„ä»¶ã€æ¶ˆæ¯ç»„ä»¶ä»¥åŠè®¿é—®æ¥å£ç­‰ã€‚
>
> å°½ç®¡ä¹Ÿæ˜¯éµå¾ªæ¨¡å—åŒ–å¼€å‘ï¼Œä½†æœ€ç»ˆå®ƒä»¬ä¼šæ‰“åŒ…å¹¶éƒ¨ç½²ä¸ºå•ä½“å¼åº”ç”¨ã€‚ä¾‹å¦‚Javaåº”ç”¨ç¨‹åºä¼šè¢«æ‰“åŒ…æˆWARï¼Œéƒ¨ç½²åœ¨Tomcatæˆ–è€…Jettyä¸Šã€‚
>
> è¿™ç§å•ä½“åº”ç”¨æ¯”è¾ƒé€‚åˆäºå°é¡¹ç›®ï¼Œä¼˜ç‚¹æ˜¯ï¼š
>
> - å¼€å‘ç®€å•ç›´æ¥ï¼Œé›†ä¸­å¼ç®¡ç†
> - åŸºæœ¬ä¸ä¼šé‡å¤å¼€å‘
> - åŠŸèƒ½éƒ½åœ¨æœ¬åœ°ï¼Œæ²¡æœ‰åˆ†å¸ƒå¼çš„ç®¡ç†å¼€é”€å’Œè°ƒç”¨å¼€é”€
>
> å®ƒçš„ç¼ºç‚¹ä¹Ÿååˆ†æ˜æ˜¾ï¼Œç‰¹åˆ«å¯¹äºäº’è”ç½‘å…¬å¸æ¥è¯´ï¼š
>
> - å¼€å‘æ•ˆç‡ä½ï¼šæ‰€æœ‰çš„å¼€å‘åœ¨ä¸€ä¸ªé¡¹ç›®æ”¹ä»£ç ï¼Œé€’äº¤ä»£ç ç›¸äº’ç­‰å¾…ï¼Œä»£ç å†²çªä¸æ–­
> - ä»£ç ç»´æŠ¤éš¾ï¼šä»£ç åŠŸèƒ½è€¦åˆåœ¨ä¸€èµ·ï¼Œæ–°äººä¸çŸ¥é“ä½•ä»ä¸‹æ‰‹
> - éƒ¨ç½²ä¸çµæ´»ï¼šæ„å»ºæ—¶é—´é•¿ï¼Œä»»ä½•å°ä¿®æ”¹å¿…é¡»é‡æ–°æ„å»ºæ•´ä¸ªé¡¹ç›®ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾€å¾€å¾ˆé•¿
> - ç¨³å®šæ€§ä¸é«˜ï¼šä¸€ä¸ªå¾®ä¸è¶³é“çš„å°é—®é¢˜ï¼Œå¯ä»¥å¯¼è‡´æ•´ä¸ªåº”ç”¨æŒ‚æ‰
> - æ‰©å±•æ€§ä¸å¤Ÿï¼šæ— æ³•æ»¡è¶³é«˜å¹¶å‘æƒ…å†µä¸‹çš„ä¸šåŠ¡éœ€æ±‚
>
> ### 2ã€å¾®æœåŠ¡é¡¹ç›®
>
> ç°åœ¨ä¸»æµçš„è®¾è®¡ä¸€èˆ¬ä¼šé‡‡ç”¨å¾®æœåŠ¡æ¶æ„ã€‚å…¶æ€è·¯ä¸æ˜¯å¼€å‘ä¸€ä¸ªå·¨å¤§çš„å•ä½“å¼åº”ç”¨ï¼Œè€Œæ˜¯å°†åº”ç”¨åˆ†è§£ä¸ºå°çš„ã€äº’ç›¸è¿æ¥çš„å¾®æœåŠ¡ã€‚ä¸€ä¸ªå¾®æœåŠ¡å®ŒæˆæŸä¸ªç‰¹å®šåŠŸèƒ½ï¼Œæ¯”å¦‚ä¹˜å®¢ç®¡ç†å’Œä¸‹å•ç®¡ç†ç­‰ã€‚æ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å’Œé€‚é…å™¨ã€‚ä¸€äº›å¾®æœåŠ¡è¿˜ä¼šæä¾›APIæ¥å£ç»™å…¶ä»–å¾®æœåŠ¡å’Œåº”ç”¨å®¢æˆ·ç«¯ä½¿ç”¨
>
> **å¾®æœåŠ¡æ¶æ„çš„ä¼˜ç‚¹**
>
> - è§£å†³äº†å¤æ‚æ€§é—®é¢˜
    >
    > å®ƒå°†å•ä½“åº”ç”¨åˆ†è§£ä¸ºä¸€ç»„æœåŠ¡ã€‚è™½ç„¶åŠŸèƒ½æ€»é‡ä¸å˜ï¼Œä½†åº”ç”¨ç¨‹åºå·²è¢«åˆ†è§£ä¸ºå¯ç®¡ç†çš„æ¨¡å—æˆ–æœåŠ¡ã€‚è¿™äº›æœåŠ¡å®šä¹‰äº†æ˜ç¡®çš„RPCæˆ–æ¶ˆæ¯é©±åŠ¨çš„APIè¾¹ç•Œã€‚å¾®æœåŠ¡æ¶æ„å¼ºåŒ–äº†åº”ç”¨æ¨¡å—åŒ–çš„æ°´å¹³ï¼Œè€Œè¿™é€šè¿‡å•ä½“ä»£ç åº“å¾ˆéš¾å®ç°ã€‚å› æ­¤ï¼Œå¾®æœåŠ¡å¼€å‘çš„é€Ÿåº¦è¦å¿«å¾ˆå¤šï¼Œæ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚
>
> - å•ç‹¬å¼€å‘æ¯ä¸ªæœåŠ¡ï¼Œä¸å…¶ä»–æœåŠ¡äº’ä¸å¹²æ‰°
    >
    > åªè¦ç¬¦åˆæœåŠ¡APIå¥‘çº¦ï¼Œå¼€å‘äººå‘˜å¯ä»¥è‡ªç”±é€‰æ‹©å¼€å‘æŠ€æœ¯ã€‚è¿™å°±æ„å‘³ç€å¼€å‘äººå‘˜å¯ä»¥é‡‡ç”¨æ–°æŠ€æœ¯ç¼–å†™æˆ–é‡æ„æœåŠ¡ï¼Œç”±äºæœåŠ¡ç›¸å¯¹è¾ƒå°ï¼Œæ‰€ä»¥è¿™å¹¶ä¸ä¼šå¯¹æ•´ä½“åº”ç”¨é€ æˆå¤ªå¤§å½±å“ã€‚
>
> - å¯ä»¥ç‹¬ç«‹éƒ¨ç½²æ¯ä¸ªå¾®æœåŠ¡
    >
    > å¼€å‘äººå‘˜æ— éœ€åè°ƒå¯¹æœåŠ¡å‡çº§æˆ–æ›´æ”¹çš„éƒ¨ç½²ã€‚è¿™äº›æ›´æ”¹å¯ä»¥åœ¨æµ‹è¯•é€šè¿‡åç«‹å³éƒ¨ç½²ã€‚æ‰€ä»¥å¾®æœåŠ¡æ¶æ„ä¹Ÿä½¿å¾—CIï¼CDæˆä¸ºå¯èƒ½ã€‚
>
> **å¾®æœåŠ¡çš„ç¼ºç‚¹**
>
> - å¤šæœåŠ¡è¿ç»´éš¾åº¦
> - ç³»ç»Ÿéƒ¨ç½²ä¾èµ–
> - æœåŠ¡é—´é€šä¿¡æˆæœ¬
> - æ•°æ®ä¸€è‡´æ€§
> - ç³»ç»Ÿé›†æˆæµ‹è¯•
> - é‡å¤å·¥ä½œ
> - æ€§èƒ½ç›‘æ§

## 2ã€å®ç°å¾®æœåŠ¡è¦è§£å†³çš„å››ä¸ªé—®é¢˜ï¼Ÿ

> 1. å®¢æˆ·ç«¯å¦‚ä½•è®¿é—®è¿™äº›æœåŠ¡ï¼Ÿ
> 2. æœåŠ¡ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ
> 3. è¿™ä¹ˆå¤šæœåŠ¡ï¼Œæ€ä¹ˆæ‰¾?
> 4. æœåŠ¡æŒ‚äº†æ€ä¹ˆåŠï¼Ÿ

### 1ã€å®¢æˆ·ç«¯å¦‚ä½•è®¿é—®è¿™äº›æœåŠ¡

åŸæ¥çš„æœåŠ¡éƒ½æ˜¯å¯ä»¥è¿›è¡Œå•ç‹¬è°ƒç”¨ï¼Œç°åœ¨æŒ‰åŠŸèƒ½æ‹†åˆ†æˆç‹¬ç«‹çš„æœåŠ¡ï¼Œå˜æˆäº†ä¸€ä¸ªç‹¬ç«‹çš„Javaè¿›ç¨‹äº†ã€‚å®¢æˆ·ç«¯UIå¦‚ä½•è®¿é—®ä»–çš„ï¼Ÿåå°æœ‰Nä¸ªæœåŠ¡ï¼Œå‰å°å°±éœ€è¦è®°ä½ç®¡ç†Nä¸ªæœåŠ¡ï¼Œä¸€ä¸ªæœåŠ¡ä¸‹çº¿/æ›´æ–°/å‡çº§ï¼Œå‰å°å°±è¦é‡æ–°éƒ¨ç½²ï¼Œè¿™æ˜æ˜¾ä¸æœåŠ¡æˆ‘ä»¬æ‹†åˆ†çš„ç†å¿µï¼Œç‰¹åˆ«å½“å‰å°æ˜¯ç§»åŠ¨åº”ç”¨çš„æ—¶å€™ï¼Œé€šå¸¸ä¸šåŠ¡å˜åŒ–çš„èŠ‚å¥æ›´å¿«ã€‚å¦å¤–ï¼ŒNä¸ªå°æœåŠ¡çš„è°ƒç”¨ä¹Ÿæ˜¯ä¸€ä¸ªä¸å°çš„ç½‘ç»œå¼€é”€ã€‚è¿˜æœ‰ä¸€èˆ¬å¾®æœåŠ¡åœ¨ç³»ç»Ÿå†…éƒ¨ï¼Œé€šå¸¸æ˜¯æ— çŠ¶æ€çš„ï¼Œç”¨æˆ·ç™»å½•ä¿¡æ¯å’Œæƒé™ç®¡ç†æœ€å¥½æœ‰ä¸€ä¸ªç»Ÿä¸€çš„åœ°æ–¹ç»´æŠ¤ç®¡ç†ï¼ˆOAuthï¼‰ã€‚

æ‰€ä»¥ï¼Œä¸€èˆ¬åœ¨åå°Nä¸ªæœåŠ¡å’ŒUIä¹‹é—´ä¸€èˆ¬ä¼šä¸€ä¸ªä»£ç†æˆ–è€…å«`API Gateway`ï¼Œä»–çš„ä½œç”¨åŒ…æ‹¬

- æä¾›ç»Ÿä¸€æœåŠ¡å…¥å£ï¼Œè®©å¾®æœåŠ¡å¯¹å‰å°é€æ˜
- èšåˆåå°çš„æœåŠ¡ï¼ŒèŠ‚çœæµé‡ï¼Œæå‡æ€§èƒ½
- æä¾›å®‰å…¨ï¼Œè¿‡æ»¤ï¼Œæµæ§ç­‰APIç®¡ç†åŠŸèƒ½

æˆ‘çš„ç†è§£å…¶å®è¿™ä¸ªAPI Gatewayå¯ä»¥æœ‰å¾ˆå¤šå¹¿ä¹‰çš„å®ç°åŠæ³•ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªè½¯ç¡¬ä¸€ä½“çš„ç›’å­ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç®€å•MVCæ¡†æ¶ï¼Œç”šè‡³æ˜¯ä¸€ä¸ªNode.jsçš„æœåŠ¡ç«¯ã€‚ä»–ä»¬æœ€é‡è¦çš„ä½œç”¨æ˜¯ä¸ºå‰å°ï¼ˆé€šå¸¸æ˜¯ç§»åŠ¨åº”ç”¨ï¼‰æä¾›åå°æœåŠ¡çš„èšåˆï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„æœåŠ¡å‡ºå£ï¼Œè§£é™¤ä»–ä»¬ä¹‹é—´çš„è€¦åˆï¼Œä¸è¿‡API Gatewayä¹Ÿæœ‰å¯èƒ½æˆä¸ºå•ç‚¹æ•…éšœç‚¹æˆ–è€…æ€§èƒ½çš„ç“¶é¢ˆã€‚

### 2ã€ æœåŠ¡ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ

å› ä¸ºæ‰€æœ‰çš„å¾®æœåŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„Javaè¿›ç¨‹è·‘åœ¨ç‹¬ç«‹çš„è™šæ‹Ÿæœºä¸Šï¼Œæ‰€ä»¥æœåŠ¡é—´çš„é€šè¡Œå°±æ˜¯IPCï¼ˆinter process communicationï¼‰ï¼Œå·²ç»æœ‰å¾ˆå¤šæˆç†Ÿçš„æ–¹æ¡ˆã€‚ç°åœ¨åŸºæœ¬æœ€é€šç”¨çš„æœ‰ä¸¤ç§æ–¹å¼ã€‚

- åŒæ­¥è°ƒç”¨

- - RESTï¼ˆJAX-RSï¼‰
- RPCï¼ˆDubboï¼‰

- å¼‚æ­¥æ¶ˆæ¯è°ƒç”¨(Kafka, Notify, MetaQ)

> ä¸€èˆ¬åŒæ­¥è°ƒç”¨æ¯”è¾ƒç®€å•ï¼Œä¸€è‡´æ€§å¼ºï¼Œä½†æ˜¯å®¹æ˜“å‡ºè°ƒç”¨é—®é¢˜ï¼Œæ€§èƒ½ä½“éªŒä¸Šä¹Ÿä¼šå·®äº›ï¼Œç‰¹åˆ«æ˜¯è°ƒç”¨å±‚æ¬¡å¤šçš„æ—¶å€™ã€‚RESTfulå’ŒRPCçš„æ¯”è¾ƒä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„è¯é¢˜ã€‚ä¸€èˆ¬RESTåŸºäºHTTPï¼Œæ›´å®¹æ˜“å®ç°ï¼Œæ›´å®¹æ˜“è¢«æ¥å—ï¼ŒæœåŠ¡ç«¯å®ç°æŠ€æœ¯ä¹Ÿæ›´çµæ´»äº›ï¼Œå„ä¸ªè¯­è¨€éƒ½èƒ½æ”¯æŒï¼ŒåŒæ—¶èƒ½è·¨å®¢æˆ·ç«¯ï¼Œå¯¹å®¢æˆ·ç«¯æ²¡æœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œåªè¦å°è£…äº†HTTPçš„SDKå°±èƒ½è°ƒç”¨ï¼Œæ‰€ä»¥ç›¸å¯¹ä½¿ç”¨çš„å¹¿ä¸€äº›ã€‚RPCä¹Ÿæœ‰è‡ªå·±çš„ä¼˜ç‚¹ï¼Œä¼ è¾“åè®®æ›´é«˜æ•ˆï¼Œå®‰å…¨æ›´å¯æ§ï¼Œç‰¹åˆ«åœ¨ä¸€ä¸ªå…¬å¸å†…éƒ¨ï¼Œå¦‚æœæœ‰ç»Ÿä¸€ä¸ªçš„å¼€å‘è§„èŒƒå’Œç»Ÿä¸€çš„æœåŠ¡æ¡†æ¶æ—¶ï¼Œä»–çš„å¼€å‘æ•ˆç‡ä¼˜åŠ¿æ›´æ˜æ˜¾äº›ã€‚å°±çœ‹å„è‡ªçš„æŠ€æœ¯ç§¯ç´¯å®é™…æ¡ä»¶ï¼Œè‡ªå·±çš„é€‰æ‹©äº†ã€‚
>
> è€Œå¼‚æ­¥æ¶ˆæ¯çš„æ–¹å¼åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰ç‰¹åˆ«å¹¿æ³›çš„åº”ç”¨ï¼Œä»–æ—¢èƒ½å‡ä½è°ƒç”¨æœåŠ¡ä¹‹é—´çš„è€¦åˆï¼Œåˆèƒ½æˆä¸ºè°ƒç”¨ä¹‹é—´çš„ç¼“å†²ï¼Œç¡®ä¿æ¶ˆæ¯ç§¯å‹ä¸ä¼šå†²å®è¢«è°ƒç”¨æ–¹ï¼ŒåŒæ—¶èƒ½ä¿è¯è°ƒç”¨æ–¹çš„æœåŠ¡ä½“éªŒï¼Œç»§ç»­å¹²è‡ªå·±è¯¥å¹²çš„æ´»ï¼Œä¸è‡³äºè¢«åå°æ€§èƒ½æ‹–æ…¢ã€‚ä¸è¿‡éœ€è¦ä»˜å‡ºçš„ä»£ä»·æ˜¯ä¸€è‡´æ€§çš„å‡å¼±ï¼Œéœ€è¦æ¥å—æ•°æ®æœ€ç»ˆä¸€è‡´æ€§ï¼›è¿˜æœ‰å°±æ˜¯åå°æœåŠ¡ä¸€èˆ¬è¦å®ç°å¹‚ç­‰æ€§ï¼Œå› ä¸ºæ¶ˆæ¯å‘é€å‡ºäºæ€§èƒ½çš„è€ƒè™‘ä¸€èˆ¬ä¼šæœ‰é‡å¤ï¼ˆä¿è¯æ¶ˆæ¯çš„è¢«æ”¶åˆ°ä¸”ä»…æ”¶åˆ°ä¸€æ¬¡å¯¹æ€§èƒ½æ˜¯å¾ˆå¤§çš„è€ƒéªŒï¼‰ï¼›æœ€åå°±æ˜¯å¿…é¡»å¼•å…¥ä¸€ä¸ªç‹¬ç«‹çš„brokerï¼Œå¦‚æœå…¬å¸å†…éƒ¨æ²¡æœ‰æŠ€æœ¯ç§¯ç´¯ï¼Œå¯¹brokeråˆ†å¸ƒå¼ç®¡ç†ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æŒ‘æˆ˜ã€‚

### 3ã€è¿™ä¹ˆå¤šæœåŠ¡ï¼Œæ€ä¹ˆæ‰¾?

åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€èˆ¬æ¯ä¸€ä¸ªæœåŠ¡éƒ½æ˜¯æœ‰å¤šä¸ªæ‹·è´ï¼Œæ¥åšè´Ÿè½½å‡è¡¡ã€‚ä¸€ä¸ªæœåŠ¡éšæ—¶å¯èƒ½ä¸‹çº¿ï¼Œä¹Ÿå¯èƒ½åº”å¯¹ä¸´æ—¶è®¿é—®å‹åŠ›å¢åŠ æ–°çš„æœåŠ¡èŠ‚ç‚¹ã€‚æœåŠ¡ä¹‹é—´å¦‚ä½•ç›¸äº’æ„ŸçŸ¥ï¼ŸæœåŠ¡å¦‚ä½•ç®¡ç†ï¼Ÿè¿™å°±æ˜¯æœåŠ¡å‘ç°çš„é—®é¢˜äº†ã€‚ä¸€èˆ¬æœ‰ä¸¤ç±»åšæ³•ï¼Œä¹Ÿå„æœ‰ä¼˜ç¼ºç‚¹ã€‚åŸºæœ¬éƒ½æ˜¯é€šè¿‡zookeeperç­‰ç±»ä¼¼æŠ€æœ¯åšæœåŠ¡æ³¨å†Œä¿¡æ¯çš„åˆ†å¸ƒå¼ç®¡ç†ã€‚å½“æœåŠ¡ä¸Šçº¿æ—¶ï¼ŒæœåŠ¡æä¾›è€…å°†è‡ªå·±çš„æœåŠ¡ä¿¡æ¯æ³¨å†Œåˆ°ZKï¼ˆæˆ–ç±»ä¼¼æ¡†æ¶ï¼‰ï¼Œå¹¶é€šè¿‡å¿ƒè·³ç»´æŒé•¿é“¾æ¥ï¼Œå®æ—¶æ›´æ–°é“¾æ¥ä¿¡æ¯ã€‚æœåŠ¡è°ƒç”¨è€…é€šè¿‡ZKå¯»å€ï¼Œæ ¹æ®å¯å®šåˆ¶ç®—æ³•ï¼Œæ‰¾åˆ°ä¸€ä¸ªæœåŠ¡ï¼Œè¿˜å¯ä»¥å°†æœåŠ¡ä¿¡æ¯ç¼“å­˜åœ¨æœ¬åœ°ä»¥æé«˜æ€§èƒ½ã€‚å½“æœåŠ¡ä¸‹çº¿æ—¶ï¼ŒZKä¼šå‘é€šçŸ¥ç»™æœåŠ¡

å®¢æˆ·ç«¯ã€‚

- å®¢æˆ·ç«¯åšï¼šä¼˜ç‚¹æ˜¯æ¶æ„ç®€å•ï¼Œæ‰©å±•çµæ´»ï¼Œåªå¯¹æœåŠ¡æ³¨å†Œå™¨ä¾èµ–ã€‚ç¼ºç‚¹æ˜¯å®¢æˆ·ç«¯è¦ç»´æŠ¤æ‰€æœ‰è°ƒç”¨æœåŠ¡çš„åœ°å€ï¼Œæœ‰

  æŠ€æœ¯éš¾åº¦ï¼Œä¸€èˆ¬å¤§å…¬å¸éƒ½æœ‰æˆç†Ÿçš„å†…éƒ¨æ¡†æ¶æ”¯æŒï¼Œæ¯”å¦‚Dubboã€‚

- æœåŠ¡ç«¯åšï¼šä¼˜ç‚¹æ˜¯ç®€å•ï¼Œæ‰€æœ‰æœåŠ¡å¯¹äºå‰å°è°ƒç”¨æ–¹é€æ˜ï¼Œä¸€èˆ¬åœ¨å°å…¬å¸åœ¨äº‘æœåŠ¡ä¸Šéƒ¨ç½²çš„åº”ç”¨é‡‡ç”¨çš„æ¯”è¾ƒå¤šã€‚

### 4ã€è¿™ä¹ˆå¤šæœåŠ¡ï¼ŒæœåŠ¡æŒ‚äº†æ€ä¹ˆåŠï¼Ÿ

å‰é¢æåˆ°ï¼ŒMonolithicæ–¹å¼å¼€å‘ä¸€ä¸ªå¾ˆå¤§çš„é£é™©æ˜¯ï¼ŒæŠŠæ‰€æœ‰é¸¡è›‹æ”¾åœ¨ä¸€ä¸ªç¯®å­é‡Œï¼Œä¸€è£ä¿±è£ï¼Œä¸€æŸä¿±æŸã€‚è€Œåˆ†å¸ƒå¼æœ€å¤§çš„ç‰¹æ€§å°±æ˜¯ç½‘ç»œæ˜¯ä¸å¯é çš„ã€‚é€šè¿‡å¾®æœåŠ¡æ‹†åˆ†èƒ½é™ä½è¿™ä¸ªé£é™©ï¼Œä¸è¿‡å¦‚æœæ²¡æœ‰ç‰¹åˆ«çš„ä¿éšœï¼Œç»“å±€è‚¯å®šæ˜¯å™©æ¢¦ã€‚æˆ‘ä»¬åˆšé‡åˆ°ä¸€ä¸ªçº¿ä¸Šæ•…éšœå°±æ˜¯ä¸€ä¸ªå¾ˆä¸èµ·çœ¼çš„SQLè®¡æ•°åŠŸèƒ½ï¼Œåœ¨è®¿é—®é‡ä¸Šå‡æ—¶ï¼Œå¯¼è‡´æ•°æ®åº“loadå½ªé«˜ï¼Œå½±å“äº†æ‰€åœ¨åº”ç”¨çš„æ€§èƒ½ï¼Œä»è€Œå½±å“æ‰€æœ‰è°ƒç”¨è¿™ä¸ªåº”ç”¨æœåŠ¡çš„å‰å°åº”ç”¨ã€‚æ‰€ä»¥å½“æˆ‘ä»¬çš„ç³»ç»Ÿæ˜¯ç”±ä¸€ç³»åˆ—çš„æœåŠ¡è°ƒç”¨é“¾ç»„æˆçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿ä»»ä¸€ç¯èŠ‚å‡ºé—®é¢˜éƒ½ä¸è‡³äºå½±å“æ•´ä½“é“¾è·¯ã€‚ç›¸åº”çš„æ‰‹æ®µæœ‰å¾ˆå¤šï¼š

- é‡è¯•æœºåˆ¶
- é™æµ
- ç†”æ–­æœºåˆ¶
- è´Ÿè½½å‡è¡¡
- é™çº§ï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰

## 3ã€åˆ†å¸ƒå¼å’Œå¾®æœåŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

> åˆ†å¸ƒå¼ï¼Œå°±æ˜¯å°†å·¨å¤§çš„ä¸€ä¸ªç³»ç»Ÿåˆ’åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œè¿™ä¸€ç‚¹å’Œå¾®æœåŠ¡æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯è¦æŠŠç³»ç»Ÿè¿›è¡Œæ‹†åˆ†ï¼Œéƒ¨ç½²åˆ°ä¸åŒæœºå™¨ä¸Šï¼Œå› ä¸ºä¸€å°æœºå™¨å¯èƒ½æ‰¿å—ä¸äº†è¿™ä¹ˆå¤§çš„è®¿é—®å‹åŠ›ï¼Œæˆ–è€…è¯´è¦æ”¯æ’‘è¿™ä¹ˆå¤§çš„è®¿é—®å‹åŠ›éœ€è¦é‡‡è´­ä¸€å°æ€§èƒ½è¶…çº§å¥½çš„æœåŠ¡å™¨ï¼Œå…¶è´¢åŠ¡æˆæœ¬éå¸¸é«˜ï¼Œæœ‰è¿™äº›é¢„ç®—å®Œå…¨å¯ä»¥é‡‡è´­å¾ˆå¤šå°æ™®é€šçš„æœåŠ¡å™¨äº†ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿå„ä¸ªæ¨¡å—é€šè¿‡æ¥å£è¿›è¡Œæ•°æ®äº¤äº’ï¼Œå…¶å®åˆ†å¸ƒå¼ä¹Ÿæ˜¯ä¸€ç§å¾®æœåŠ¡ï¼Œå› ä¸ºéƒ½æ˜¯æŠŠæ¨¡å—æ‹†åˆ†å˜ä¸ºç‹¬ç«‹çš„å•å…ƒï¼Œæä¾›æ¥å£æ¥è°ƒç”¨ï¼Œé‚£ä¹ˆå®ƒä»¬æœ¬è´¨çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ
>
> å®ƒä»¬çš„æœ¬è´¨çš„åŒºåˆ«ä½“ç°åœ¨â€œç›®æ ‡â€ä¸Šï¼Œ ä½•ä¸ºç›®æ ‡ï¼Œå°±æ˜¯ä½ é‡‡ç”¨åˆ†å¸ƒå¼æ¶æ„æˆ–è€…é‡‡ç”¨å¾®æœåŠ¡æ¶æ„ï¼Œä½ æœ€ç»ˆæ˜¯ä¸ºäº†ä»€ä¹ˆï¼Œè¦è¾¾åˆ°ä»€ä¹ˆç›®çš„ï¼Ÿ
>
> åˆ†å¸ƒå¼æ¶æ„çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿå°±æ˜¯è®¿é—®é‡å¾ˆå¤§ä¸€å°æœºå™¨æ‰¿å—ä¸äº†ï¼Œæˆ–è€…æ˜¯æˆæœ¬é—®é¢˜ï¼Œä¸å¾—ä¸ä½¿ç”¨å¤šå°æœºå™¨æ¥å®ŒæˆæœåŠ¡çš„éƒ¨ç½²ï¼›
>
> è€Œå¾®æœåŠ¡çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿåªæ˜¯è®©å„ä¸ªæ¨¡å—æ‹†åˆ†å¼€æ¥ï¼Œä¸ä¼šè¢«äº’ç›¸å½±å“ï¼Œæ¯”å¦‚æ¨¡å—çš„å‡çº§æˆ–è€…å‡ºç°BUGæˆ–è€…æ˜¯é‡æ„ç­‰ç­‰éƒ½ä¸è¦å½±å“åˆ°å…¶ä»–æ¨¡å—ï¼Œå¾®æœåŠ¡å®ƒæ˜¯å¯ä»¥åœ¨ä¸€å°æœºå™¨ä¸Šéƒ¨ç½²ï¼›
>
> ä½†æ˜¯ï¼šåˆ†å¸ƒå¼ä¹Ÿæ˜¯å¾®æœåŠ¡çš„ä¸€ç§ï¼Œå¾®æœåŠ¡ä¹Ÿå±äºåˆ†å¸ƒå¼ï¼›

## 4ã€å¾®æœåŠ¡ä¸Spring Cloudçš„å…³ç³»æˆ–åŒºåˆ«ï¼Ÿ

> å¾®æœåŠ¡åªæ˜¯ä¸€ç§é¡¹ç›®çš„æ¶æ„æ–¹å¼ã€æ¶æ„ç†å¿µï¼Œæˆ–è€…è¯´æ˜¯ä¸€ç§æ¦‚å¿µï¼Œå°±å¦‚åŒæˆ‘ä»¬çš„MVCæ¶æ„ä¸€æ ·ï¼Œ é‚£ä¹ˆSpring Cloudä¾¿æ˜¯å¯¹è¿™ç§æ¶æ„æ–¹å¼çš„æŠ€æœ¯è½åœ°å®ç°ï¼›

## 5ã€å¾®æœåŠ¡ä¸€å®šè¦ä½¿ç”¨Spring Cloudå—ï¼Ÿ

> å¾®æœåŠ¡åªæ˜¯ä¸€ç§é¡¹ç›®çš„æ¶æ„æ–¹å¼ã€æ¶æ„ç†å¿µï¼Œæ‰€ä»¥ä»»ä½•æŠ€æœ¯éƒ½å¯ä»¥å®ç°è¿™ç§æ¶æ„ç†å¿µï¼Œåªæ˜¯å¾®æœåŠ¡æ¶æ„é‡Œé¢æœ‰å¾ˆå¤šé—®é¢˜éœ€è¦æˆ‘ä»¬å»è§£å†³ï¼Œæ¯”å¦‚ï¼šè´Ÿè½½å‡è¡¡ï¼ŒæœåŠ¡çš„æ³¨å†Œä¸å‘ç°ï¼ŒæœåŠ¡è°ƒç”¨ï¼ŒæœåŠ¡è·¯ç”±ï¼ŒæœåŠ¡ç†”æ–­ç­‰ç­‰ä¸€ç³»åˆ—é—®é¢˜ï¼Œå¦‚æœä½ è‡ªå·±ä»0å¼€å§‹å®ç°å¾®æœåŠ¡çš„æ¶æ„ç†å¿µï¼Œé‚£å¤´å‘éƒ½æ‰å…‰äº†ï¼Œæ‰€ä»¥Spring Cloud å¸®æˆ‘ä»¬åšäº†è¿™äº›äº‹æƒ…ï¼ŒSpring Cloudå°†å¤„ç†è¿™äº›é—®é¢˜çš„çš„æŠ€æœ¯å…¨éƒ¨æ‰“åŒ…å¥½äº†ï¼Œæˆ‘ä»¬åªéœ€è¦å¼€ç®±å³ç”¨ï¼›

## 6ã€ä»€ä¹ˆæ˜¯Spring Cloud?

> å®˜æ–¹è§£é‡Šï¼šSpring Cloudæ˜¯ä¸€ç³»åˆ—æ¡†æ¶çš„æœ‰åºé›†åˆã€‚å®ƒåˆ©ç”¨Spring Bootçš„å¼€å‘ä¾¿åˆ©æ€§å·§å¦™åœ°ç®€åŒ–äº†åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€è®¾æ–½çš„å¼€å‘ï¼Œå¦‚æœåŠ¡å‘ç°æ³¨å†Œã€é…ç½®ä¸­å¿ƒã€æ¶ˆæ¯æ€»çº¿ã€è´Ÿè½½å‡è¡¡ã€æ–­è·¯å™¨ã€æ•°æ®ç›‘æ§ç­‰ï¼Œéƒ½å¯ä»¥ç”¨Spring Bootçš„å¼€å‘é£æ ¼åšåˆ°ä¸€é”®å¯åŠ¨å’Œéƒ¨ç½²ã€‚Spring Cloudå¹¶æ²¡æœ‰é‡å¤åˆ¶é€ è½®å­ï¼Œå®ƒåªæ˜¯å°†å„å®¶å…¬å¸å¼€å‘çš„æ¯”è¾ƒæˆç†Ÿã€ç»å¾—èµ·å®é™…è€ƒéªŒçš„æœåŠ¡æ¡†æ¶ç»„åˆèµ·æ¥ï¼Œé€šè¿‡Spring Booté£æ ¼è¿›è¡Œå†å°è£…å±è”½æ‰äº†å¤æ‚çš„é…ç½®å’Œå®ç°åŸç†ï¼Œæœ€ç»ˆç»™å¼€å‘è€…ç•™å‡ºäº†ä¸€å¥—ç®€å•æ˜“æ‡‚ã€æ˜“éƒ¨ç½²å’Œæ˜“ç»´æŠ¤çš„åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘å·¥å…·åŒ…ã€‚

## 7ã€Spring Cloudçš„ä¼˜ç¼ºç‚¹æœ‰å“ªäº›ï¼Ÿ

> **ä¼˜ç‚¹ï¼š**
>
> 1. æœåŠ¡æ‹†åˆ†ç²’åº¦æ›´ç»†ï¼Œæœ‰åˆ©äºèµ„æºé‡å¤åˆ©ç”¨ï¼Œæœ‰åˆ©äºæé«˜å¼€å‘æ•ˆç‡
> 2. å¯ä»¥æ›´ç²¾å‡†çš„åˆ¶å®šä¼˜åŒ–æœåŠ¡æ–¹æ¡ˆï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§
> 3. å¾®æœåŠ¡æ¶æ„é‡‡ç”¨å»ä¸­å¿ƒåŒ–æ€æƒ³ï¼ŒæœåŠ¡ä¹‹é—´é‡‡ç”¨Restfulç­‰è½»é‡çº§é€šè®¯ï¼Œæ¯”ESBæ›´è½»é‡
> 4. é€‚äºäº’è”ç½‘æ—¶ä»£ï¼Œäº§å“è¿­ä»£å‘¨æœŸæ›´çŸ­
>
> **ç¼ºç‚¹ï¼š**
>
> 1. å¾®æœåŠ¡è¿‡å¤šï¼Œæ²»ç†æˆæœ¬é«˜ï¼Œä¸åˆ©äºç»´æŠ¤ç³»ç»Ÿ
> 2. åˆ†å¸ƒå¼ç³»ç»Ÿå¼€å‘çš„æˆæœ¬é«˜ï¼ˆå®¹é”™ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡ç­‰ï¼‰å¯¹å›¢é˜ŸæŒ‘æˆ˜å¤§
>
> æ€»çš„æ¥è¯´ä¼˜ç‚¹å¤§è¿‡äºç¼ºç‚¹ï¼Œç›®å‰çœ‹æ¥SpringCloudæ˜¯ä¸€å¥—éå¸¸å®Œå–„çš„åˆ†å¸ƒå¼æ¡†æ¶ï¼Œç›®å‰å¾ˆå¤šä¼ä¸šå¼€å§‹ç”¨å¾®æœåŠ¡ã€Spring Cloudçš„ä¼˜åŠ¿æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚å› æ­¤å¯¹äºæƒ³ç ”ç©¶å¾®æœåŠ¡æ¶æ„çš„åŒå­¦æ¥è¯´ï¼Œå­¦ä¹  Spring Cloud æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚

## 8ã€Spring Cloudç‰ˆæœ¬å·äº†è§£å—ï¼Ÿ

> pring Cloud é‡‡ç”¨äº†è‹±å›½ä¼¦æ•¦åœ°é“ç«™çš„åç§°æ¥å‘½åï¼Œå¹¶ç”±åœ°é“ç«™åç§°å­—æ¯A-Zä¾æ¬¡ç±»æ¨çš„å½¢å¼æ¥å‘å¸ƒè¿­ä»£ç‰ˆæœ¬
>
> SpringCloudæ˜¯ä¸€ä¸ªç”±è®¸å¤šå­é¡¹ç›®ç»„æˆçš„ç»¼åˆé¡¹ç›®ï¼Œå„å­é¡¹ç›®æœ‰ä¸åŒçš„å‘å¸ƒèŠ‚å¥ã€‚ä¸ºäº†ç®¡ç†SpringCloudä¸å„å­é¡¹ç›®çš„ç‰ˆæœ¬ä¾èµ–å…³ç³»ï¼Œå‘å¸ƒäº†ä¸€ä¸ªæ¸…å•ï¼Œå…¶ä¸­åŒ…æ‹¬äº†æŸä¸ªSpringCloudç‰ˆæœ¬å¯¹åº”çš„å­é¡¹ç›®ç‰ˆæœ¬ã€‚ä¸ºäº†é¿å…SpringCloudç‰ˆæœ¬å·ä¸å­é¡¹ç›®ç‰ˆæœ¬å·æ··æ·†ï¼ŒSpringCloudç‰ˆæœ¬é‡‡ç”¨äº†åç§°è€Œéç‰ˆæœ¬å·çš„å‘½åï¼Œè¿™äº›ç‰ˆæœ¬çš„åå­—é‡‡ç”¨äº†ä¼¦æ•¦åœ°é“ç«™çš„åå­—ï¼Œæ ¹æ®å­—æ¯è¡¨çš„é¡ºåºæ¥å¯¹åº”ç‰ˆæœ¬æ—¶é—´é¡ºåºã€‚ä¾‹å¦‚Angelæ˜¯ç¬¬ä¸€ä¸ªç‰ˆæœ¬, Brixtonæ˜¯ç¬¬äºŒä¸ªç‰ˆæœ¬ã€‚
>
> å½“SpringCloudçš„å‘å¸ƒå†…å®¹ç§¯ç´¯åˆ°ä¸´ç•Œç‚¹æˆ–è€…ä¸€ä¸ªé‡å¤§BUGè¢«è§£å†³åï¼Œä¼šå‘å¸ƒä¸€ä¸ª"service releases"ç‰ˆæœ¬ï¼Œç®€ç§°SRXç‰ˆæœ¬ï¼Œæ¯”å¦‚Greenwich.SR2å°±æ˜¯SpringCloudå‘å¸ƒçš„Greenwichç‰ˆæœ¬çš„ç¬¬2ä¸ªSRXç‰ˆæœ¬ã€‚

## 9ã€Spring Cloudä¸Spring Bootä¾èµ–å…³ç³»ï¼Ÿ

> å®˜æ–¹æä¾›ç‰ˆæœ¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œè¯·å‚è€ƒå®˜æ–¹ï¼šhttps://spring.io/projects/spring-cloud#overview
>
> æ›´è¯¦ç»†ç‰ˆæœ¬å¯¹åº”çš„æŸ¥çœ‹ï¼šhttps://start.spring.io/actuator/info

## 10ã€ SpringBootå’ŒSpringCloudçš„åŒºåˆ«ï¼Ÿ

> - SpringBootä¸“æ³¨äºå¿«é€Ÿæ–¹ä¾¿çš„å¼€å‘å•ä¸ªä¸ªä½“å¾®æœåŠ¡ï¼›SpringCloudæ˜¯å…³æ³¨å…¨å±€çš„å¾®æœåŠ¡åè°ƒæ•´ç†æ²»ç†æ¡†æ¶ï¼Œå®ƒå°†SpringBootå¼€å‘çš„ä¸€ä¸ªä¸ªå•ä½“å¾®æœåŠ¡æ•´åˆå¹¶ç®¡ç†èµ·æ¥ï¼Œä¸ºå„ä¸ªå¾®æœåŠ¡ä¹‹é—´æä¾›ï¼Œé…ç½®ç®¡ç†ã€æœåŠ¡å‘ç°ã€æ–­è·¯å™¨ã€è·¯ç”±ã€å¾®ä»£ç†ã€äº‹ä»¶æ€»çº¿ã€å…¨å±€é”ã€å†³ç­–ç«é€‰ã€åˆ†å¸ƒå¼ä¼šè¯ç­‰ç­‰é›†æˆæœåŠ¡
>
> - SpringBootå¯ä»¥ç¦»å¼€SpringCloudç‹¬ç«‹ä½¿ç”¨å¼€å‘é¡¹ç›®ï¼Œ ä½†æ˜¯SpringCloudç¦»ä¸å¼€SpringBoot ï¼Œå±äºä¾èµ–çš„å…³ç³»
>
> - SpringBootä¸“æ³¨äºå¿«é€Ÿã€æ–¹ä¾¿çš„å¼€å‘å•ä¸ªå¾®æœåŠ¡ä¸ªä½“ï¼›SpringCloudå…³æ³¨å…¨å±€çš„æœåŠ¡æ²»ç†æ¡†æ¶ã€‚

## 11ã€ Spring Cloud å’ŒDubboåŒºåˆ«?

> |              | Spring Cloud                     | Dubbo      |
> | ------------ | -------------------------------- | ---------- |
> | æœåŠ¡è°ƒç”¨æ–¹å¼ | Rest APi                         | RPC        |
> | æ³¨å†Œä¸­å¿ƒ     | Eurekaã€Zookeeperã€Nacosã€Consul | Zookeeper  |
> | æœåŠ¡ç½‘å…³     | Zuulã€GateWay                    | ç¬¬ä¸‰æ–¹æ•´åˆ |

## 12ã€Spring Cloudæœ‰å“ªäº›ç»„ä»¶?

> - æœåŠ¡å‘ç°--Netflix Eureka
> - å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡--Netflix Ribbon
> - æ–­è·¯å™¨--Netflix Hystrix
> - æœåŠ¡ç½‘å…³--Netflix Zuul
> - åˆ†å¸ƒå¼é…ç½®--Spring Cloud Config

## 13ã€Eurekaçš„æœåŠ¡æ²»ç†æ˜¯ä»€ä¹ˆï¼Ÿ

> Spring Cloud å°è£…äº† Netflix å…¬å¸å¼€å‘çš„ Eureka æ¨¡å—æ¥å®ç°æœåŠ¡æ²»ç†ã€‚
>
> åœ¨ä¼ ç»Ÿçš„rpcè¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œç®¡ç†æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨æœåŠ¡æ²»ç†ï¼Œç®¡ç†æœåŠ¡äºæœåŠ¡ä¹‹é—´ä¾èµ–å…³ç³»ï¼Œå¯ä»¥å®ç°æœåŠ¡è°ƒç”¨ã€è´Ÿè½½å‡è¡¡ã€å®¹é”™ç­‰ï¼Œå®ç°æœåŠ¡å‘ç°ä¸æ³¨å†Œã€‚

## 14ã€Eurekaçš„æœåŠ¡æ³¨å†Œæ˜¯ä»€ä¹ˆï¼Ÿ

> Eurekaé‡‡ç”¨äº†CSçš„è®¾è®¡æ¶æ„ï¼ŒEureka Server ä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚è€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨ Eurekaçš„å®¢æˆ·ç«¯è¿æ¥åˆ° Eureka Serverå¹¶ç»´æŒå¿ƒè·³è¿æ¥ã€‚è¿™æ ·ç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡ Eureka Server æ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚
>
> åœ¨æœåŠ¡æ³¨å†Œä¸å‘ç°ä¸­ï¼Œæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒã€‚å½“æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šæŠŠå½“å‰è‡ªå·±æœåŠ¡å™¨çš„ä¿¡æ¯ æ¯”å¦‚ æœåŠ¡åœ°å€é€šè®¯åœ°å€ç­‰ä»¥åˆ«åæ–¹å¼æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šã€‚å¦ä¸€æ–¹ï¼ˆæ¶ˆè´¹è€…|æœåŠ¡æä¾›è€…ï¼‰ï¼Œä»¥è¯¥åˆ«åçš„æ–¹å¼å»æ³¨å†Œä¸­å¿ƒä¸Šè·å–åˆ°å®é™…çš„æœåŠ¡é€šè®¯åœ°å€ï¼Œç„¶åå†å®ç°æœ¬åœ°RPCè°ƒç”¨RPCè¿œç¨‹è°ƒç”¨æ¡†æ¶æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šåœ¨äºæ³¨å†Œä¸­å¿ƒï¼Œå› ä¸ºä½¿ç”¨æ³¨å†Œä¸­å¿ƒç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¸€ä¸ªä¾èµ–å…³ç³»(æœåŠ¡æ²»ç†æ¦‚å¿µ)ã€‚åœ¨ä»»ä½•rpcè¿œç¨‹æ¡†æ¶ä¸­ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ(å­˜æ”¾æœåŠ¡åœ°å€ç›¸å…³ä¿¡æ¯(æ¥å£åœ°å€))
>
> ![å›¾ç‰‡](../images/640.png)

## 15ã€Eurekaå¦‚ä½•å®ç°é«˜å¯ç”¨ï¼Ÿ

> æ­å»ºé›†ç¾¤ç¯å¢ƒï¼ŒæœåŠ¡ä¹‹é—´ç›¸äº’æ³¨å†Œ

## 16ã€Eurekaå¦‚ä½•è·å–æœåŠ¡ä¿¡æ¯ï¼Ÿ

> é€šè¿‡æœåŠ¡å‘ç°çš„æ–¹å¼è·å–ï¼Œè‡ªåŠ¨è£…é…`DiscoveryClient`ï¼Œè°ƒç”¨é‡Œé¢æ–¹æ³•å³å¯
>
> ```
> //è·å–æ‰€æœ‰æœåŠ¡
> List<String> services = discoveryClient.getServices();
> //æŒ‡å®šæœåŠ¡åè·å–å¯¹åº”çš„ä¿¡æ¯
> List<ServiceInstance> instances = discoveryClient.getInstances("XIAOBEAR-CLOUD-PAYMENT-SERVICE");
> ```

## 17ã€Eurekaçš„è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ

> é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœEurekaServeråœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°æŸä¸ªå¾®æœåŠ¡å®ä¾‹çš„å¿ƒè·³ï¼ŒEurekaServerå°†ä¼šæ³¨é”€è¯¥å®ä¾‹ï¼ˆé»˜è®¤90ç§’ï¼‰ã€‚ä½†æ˜¯å½“ç½‘ç»œåˆ†åŒºæ•…éšœå‘ç”Ÿ(å»¶æ—¶ã€å¡é¡¿ã€æ‹¥æŒ¤)æ—¶ï¼Œå¾®æœåŠ¡ä¸EurekaServerä¹‹é—´æ— æ³•æ­£å¸¸é€šä¿¡ï¼Œä»¥ä¸Šè¡Œä¸ºå¯èƒ½å˜å¾—éå¸¸å±é™©äº†â€”â€”å› ä¸ºå¾®æœåŠ¡æœ¬èº«å…¶å®æ˜¯å¥åº·çš„ï¼Œæ­¤æ—¶æœ¬ä¸åº”è¯¥æ³¨é”€è¿™ä¸ªå¾®æœåŠ¡ã€‚Eurekaé€šè¿‡â€œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼â€æ¥è§£å†³è¿™ä¸ªé—®é¢˜â€”â€”å½“EurekaServerèŠ‚ç‚¹åœ¨çŸ­æ—¶é—´å†…ä¸¢å¤±è¿‡å¤šå®¢æˆ·ç«¯æ—¶ï¼ˆå¯èƒ½å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºæ•…éšœï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªèŠ‚ç‚¹å°±ä¼šè¿›å…¥è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ã€‚
>
> **åœ¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ä¸­ï¼ŒEureka Serverä¼šä¿æŠ¤æœåŠ¡æ³¨å†Œè¡¨ä¸­çš„ä¿¡æ¯ï¼Œä¸å†æ³¨é”€ä»»ä½•æœåŠ¡å®ä¾‹ã€‚**
>
> å®ƒçš„è®¾è®¡å“²å­¦å°±æ˜¯å®å¯ä¿ç•™é”™è¯¯çš„æœåŠ¡æ³¨å†Œä¿¡æ¯ï¼Œä¹Ÿä¸ç›²ç›®æ³¨é”€ä»»ä½•å¯èƒ½å¥åº·çš„æœåŠ¡å®ä¾‹ã€‚ä¸€å¥è¯è®²è§£ï¼šå¥½æ­»ä¸å¦‚èµ–æ´»ç€.
>
> ç»¼ä¸Šï¼Œè‡ªæˆ‘ä¿æŠ¤æ¨¡å¼æ˜¯ä¸€ç§åº”å¯¹ç½‘ç»œå¼‚å¸¸çš„å®‰å…¨ä¿æŠ¤æªæ–½ã€‚å®ƒçš„æ¶æ„å“²å­¦æ˜¯å®å¯åŒæ—¶ä¿ç•™æ‰€æœ‰å¾®æœåŠ¡ï¼ˆå¥åº·çš„å¾®æœåŠ¡å’Œä¸å¥åº·çš„å¾®æœåŠ¡éƒ½ä¼šä¿ç•™ï¼‰ä¹Ÿä¸ç›²ç›®æ³¨é”€ä»»ä½•å¥åº·çš„å¾®æœåŠ¡ã€‚ä½¿ç”¨è‡ªæˆ‘ä¿æŠ¤æ¨¡å¼ï¼Œå¯ä»¥è®©Eurekaé›†ç¾¤æ›´åŠ çš„å¥å£®ã€ç¨³å®šã€‚

## 18ã€ä¸ºä»€ä¹ˆä¼šäº§ç”ŸEurekaçš„è‡ªæˆ‘ä¿æŠ¤å‘¢ï¼Ÿ

> ä¸ºäº†é˜²æ­¢EurekaClientå¯ä»¥æ­£å¸¸è¿è¡Œï¼Œä½†æ˜¯ ä¸ EurekaServerç½‘ç»œä¸é€šæƒ…å†µä¸‹ï¼ŒEurekaServerä¸ä¼šç«‹åˆ»å°†EurekaClientæœåŠ¡å‰”é™¤.

## 19ã€å¦‚ä½•å…³é—­Eurekaçš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Ÿ

> **å‡ºå‚é»˜è®¤ï¼Œè‡ªæˆ‘ä¿æŠ¤æœºåˆ¶æ˜¯å¼€å¯çš„**
>
> å…³é—­å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶è¿›è¡Œå…³é—­ğŸ‘‡
>
> ```
> eureka:
> instance:
>  hostname: eureka7001.com  #eurekaæœåŠ¡ç«¯çš„å®ä¾‹åç§°
> client:
>  register-with-eureka: false   #falseè¡¨ç¤ºä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±ã€‚
>  fetch-registry: false      #falseè¡¨ç¤ºè‡ªå·±ç«¯å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæˆ‘çš„èŒè´£å°±æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡
>  service-url:
>    defaultZone: http://eureka7002.com:7002/eureka/
>     #è®¾ç½®ä¸Eureka Serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€ã€‚
> server:
>   #å…³é—­è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼Œä¿è¯ä¸å¯ç”¨æœåŠ¡è¢«åŠæ—¶è¸¢é™¤
>  enable-self-preservation: false
>  eviction-interval-timer-in-ms: 1000
> ```

## 20ã€Consulæ˜¯ä»€ä¹ˆï¼Ÿ

> Consul æ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ç³»ç»Ÿï¼Œç”± HashiCorp å…¬å¸ç”¨ Go è¯­è¨€å¼€å‘ã€‚æä¾›äº†å¾®æœåŠ¡ç³»ç»Ÿä¸­çš„æœåŠ¡æ²»ç†ã€é…ç½®ä¸­å¿ƒã€æ§åˆ¶æ€»çº¿ç­‰åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ ¹æ®éœ€è¦å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·ä½¿ç”¨ä»¥æ„å»ºå…¨æ–¹ä½çš„æœåŠ¡ç½‘æ ¼ï¼Œæ€»ä¹‹Consulæä¾›äº†ä¸€ç§å®Œæ•´çš„æœåŠ¡ç½‘æ ¼è§£å†³æ–¹æ¡ˆã€‚
>
> å®ƒå…·æœ‰å¾ˆå¤šä¼˜ç‚¹ã€‚åŒ…æ‹¬ï¼šåŸºäº raft åè®®ï¼Œæ¯”è¾ƒç®€æ´ï¼›æ”¯æŒå¥åº·æ£€æŸ¥, åŒæ—¶æ”¯æŒ HTTP å’Œ DNS åè®® æ”¯æŒè·¨æ•°æ®ä¸­å¿ƒçš„ WAN é›†ç¾¤ æä¾›å›¾å½¢ç•Œé¢ è·¨å¹³å°ï¼Œæ”¯æŒ Linuxã€Macã€Windows

## 21ã€Consulæœ‰å“ªäº›ç‰¹æ€§ï¼Ÿ

> - æœåŠ¡å‘ç°ï¼šæä¾›HTTPå’ŒDNSä¸¤ç§æœåŠ¡å‘ç°æ–¹å¼
> - å¥åº·ç›‘æµ‹ï¼šæ”¯æŒå¤šç§æ–¹å¼ï¼ŒHttpã€TCPã€Dockerã€Shellè„šæœ¬å®šåˆ¶åŒ–ç›‘æ§
> - KVå­˜å‚¨ï¼škeyã€valueçš„å­˜å‚¨æ–¹å¼
> - å¤šæ•°æ®ä¸­å¿ƒï¼šæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒ
> - å¯è§†åŒ–Webç•Œé¢

## 22ã€Eurekaã€Consulã€Zookeeperä¸‰è€…éƒ½æ˜¯æ³¨å†Œä¸­å¿ƒï¼Œæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

|              | Eureka     | Consul   | Zookeeper |
| ------------ | ---------- | -------- | --------- |
| è¯­è¨€         | Java       | Go       | Java      |
| CAP          | AP         | CP       | CP        |
| æœåŠ¡å¥åº·æ£€æŸ¥ | å¯é…ç½®æ”¯æŒ | æ”¯æŒ     | æ”¯æŒ      |
| å¯¹å¤–æš´éœ²æ¥å£ | HTTP       | HTTP/DNS | å®¢æˆ·ç«¯    |
| Spring Cloud | å¯é›†æˆ     | å¯é›†æˆ   | å¯é›†æˆ    |

### CAP

- Cï¼šconsistency(å¼ºä¸€è‡´æ€§)
- Aï¼šAvailability(å¯ç”¨æ€§)
- Pï¼šPartition tolerance(åˆ†åŒºå®¹é”™æ€§)

## 23ã€ä»€ä¹ˆæ˜¯Spring Cloud Ribbonï¼Ÿ

> Spring Cloud Ribbonæ˜¯åŸºäºNetflix Ribbonå®ç°çš„ä¸€å¥—**å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡**çš„å·¥å…·ã€‚
>
> ç®€å•çš„è¯´ï¼ŒRibbonæ˜¯Netflixå‘å¸ƒçš„å¼€æºé¡¹ç›®ï¼Œä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨ã€‚Ribbonå®¢æˆ·ç«¯ç»„ä»¶æä¾›ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹å¦‚è¿æ¥è¶…æ—¶ï¼Œé‡è¯•ç­‰ã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­åˆ—å‡ºLoad Balancerï¼ˆç®€ç§°LBï¼‰åé¢æ‰€æœ‰çš„æœºå™¨ï¼ŒRibbonä¼šè‡ªåŠ¨çš„å¸®åŠ©ä½ åŸºäºæŸç§è§„åˆ™ï¼ˆå¦‚ç®€å•è½®è¯¢ï¼Œéšæœºè¿æ¥ç­‰ï¼‰å»è¿æ¥è¿™äº›æœºå™¨ã€‚

## 24ã€LBè´Ÿè½½å‡è¡¡(Load Balance)æ˜¯ä»€ä¹ˆ

> ç®€å•çš„è¯´å°±æ˜¯å°†ç”¨æˆ·çš„è¯·æ±‚å¹³æ‘Šçš„åˆ†é…åˆ°å¤šä¸ªæœåŠ¡ä¸Šï¼Œä»è€Œè¾¾åˆ°ç³»ç»Ÿçš„HAï¼ˆé«˜å¯ç”¨ï¼‰ã€‚

## 25ã€Ribbonçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ

> **Ribbonå°±æ˜¯è´Ÿè½½å‡è¡¡+RestTemplateè°ƒç”¨**

## 26ã€Ribbonè´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œä½ äº†è§£å—ï¼Ÿ

> **è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šrestæ¥å£ç¬¬å‡ æ¬¡è¯·æ±‚æ•° % æœåŠ¡å™¨é›†ç¾¤æ€»æ•°é‡ = å®é™…è°ƒç”¨æœåŠ¡å™¨ä½ç½®ä¸‹æ ‡ ï¼Œæ¯æ¬¡æœåŠ¡é‡å¯åŠ¨årestæ¥å£è®¡æ•°ä»1å¼€å§‹ã€‚**
>
> ```
> List<ServiceInstance> instances = discoveryClient.getInstances("XIAOBEAR-CLOUD-PAYMENT-SERVICE");
> å¦‚ï¼š  List [0] instances = 127.0.0.1:8002
> ã€€ã€€ã€€List [1] instances = 127.0.0.1:8001
> ```
>
> 8001+ 8002 ç»„åˆæˆä¸ºé›†ç¾¤ï¼Œå®ƒä»¬å…±è®¡2å°æœºå™¨ï¼Œé›†ç¾¤æ€»æ•°ä¸º2ï¼Œ æŒ‰ç…§è½®è¯¢ç®—æ³•åŸç†ï¼š
>
> å½“æ€»è¯·æ±‚æ•°ä¸º1æ—¶ï¼š1 % 2 =1 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º1 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8001
>
> å½“æ€»è¯·æ±‚æ•°ä½2æ—¶ï¼š2 % 2 =0 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º0 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8002
>
> å½“æ€»è¯·æ±‚æ•°ä½3æ—¶ï¼š3 % 2 =1 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º1 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8001
>
> å½“æ€»è¯·æ±‚æ•°ä½4æ—¶ï¼š4 % 2 =0 å¯¹åº”ä¸‹æ ‡ä½ç½®ä¸º0 ï¼Œåˆ™è·å¾—æœåŠ¡åœ°å€ä¸º127.0.0.1:8002
>
> ä¾æ¬¡ç±»æ¨......

## 27ã€Ribbonè´Ÿè½½å‡è¡¡ç­–ç•¥æœ‰å“ªäº›ï¼Ÿ

> - RoundRobinRuleï¼ˆè½®è¯¢ç­–ç•¥ï¼‰ï¼šè½®è¯¢ï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡é€‰æ‹©
> - RandomRuleï¼ˆéšæœºç­–ç•¥ï¼‰ï¼šéšæœºï¼Œéšæœºé€‰æ‹©ä¸€ä¸ªæœåŠ¡
> - RetryRuleï¼ˆé‡è¯•ç­–ç•¥ï¼‰ï¼šå…ˆæŒ‰ç…§RoundRobinRuleçš„ ç­–ç•¥è·å–æœåŠ¡ï¼Œå¦‚æœæœåŠ¡è·å–å¤±è´¥ï¼Œåˆ™åœ¨æŒ‡å®šçš„æ—¶é—´å†…é‡è¯•ï¼Œè·å–å¯ç”¨çš„æœåŠ¡
> - RestAvailableRuleï¼ˆæœ€å°è¿æ¥ç­–ç•¥ï¼‰ï¼šå…ˆè¿‡æ»¤è°ƒç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„æœåŠ¡
> - AvailabilityFulteringRuleï¼ˆå¯ç”¨æ€§æ•æ„Ÿç­–ç•¥ï¼‰ï¼šå…ˆè¿‡æ»¤è°ƒæ•…éšœå®ä¾‹ï¼Œå†é€‰æ‹©å¹¶å‘é‡æœ€å°çš„å®ä¾‹
> - WeightedResponseTimeRuleï¼ˆæƒé‡ç­–ç•¥ï¼‰ï¼šå¯¹RoundRobinRuleçš„æ‰©å±•ï¼Œå“åº”é€Ÿåº¦è¶Šå¿«çš„å®ä¾‹é€‰æ‹©æƒé‡è¶Šå¤§ï¼Œè¶Šå®¹æ˜“è¢«é€‰æ‹©ã€‚å®ƒçš„å®ç°åŸç†æ˜¯ï¼Œåˆšå¼€å§‹ä½¿ç”¨è½®è¯¢ç­–ç•¥å¹¶å¼€å¯ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œæ¯ä¸€æ®µæ—¶é—´æ”¶é›†ä¸€æ¬¡æ‰€æœ‰æœåŠ¡æä¾›è€…çš„å¹³å‡å“åº”æ—¶é—´ï¼Œç„¶åå†ç»™æ¯ä¸ªæœåŠ¡æä¾›è€…é™„ä¸Šä¸€ä¸ªæƒé‡ï¼Œæƒé‡è¶Šé«˜è¢«é€‰ä¸­çš„æ¦‚ç‡ä¹Ÿè¶Šå¤§ã€‚
> - ZoneAvoidanceRuleï¼ˆåŒºåŸŸæ•æ„Ÿç­–ç•¥ï¼‰ï¼šé»˜è®¤è§„åˆ™ï¼Œå¤åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§é€‰æ‹©æœåŠ¡å™¨

## 28ã€ Ribbonåº•å±‚å®ç°åŸç†ï¼Ÿ

> Ribbonä½¿ç”¨discoveryClientä»æ³¨å†Œä¸­å¿ƒè¯»å–ç›®æ ‡æœåŠ¡ä¿¡æ¯ï¼Œå¯¹åŒä¸€æ¥å£è¯·æ±‚è¿›è¡Œè®¡æ•°ï¼Œä½¿ç”¨%å–ä½™ç®—æ³•è·å–ç›®æ ‡æœåŠ¡é›†ç¾¤ç´¢å¼•ï¼Œè¿”å›è·å–åˆ°çš„ç›®æ ‡æœåŠ¡ä¿¡æ¯ã€‚

## 29ã€Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯ VS NginxæœåŠ¡ç«¯è´Ÿè½½å‡è¡¡åŒºåˆ«ï¼Ÿ

> - Nginxæ˜¯æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™nginxï¼Œç„¶åç”±nginxå®ç°è½¬å‘è¯·æ±‚ã€‚å³è´Ÿè½½å‡è¡¡æ˜¯ç”±æœåŠ¡ç«¯å®ç°çš„ã€‚
> - Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨è°ƒç”¨å¾®æœåŠ¡æ¥å£æ—¶å€™ï¼Œä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ°JVMæœ¬åœ°ï¼Œä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨æŠ€æœ¯ã€‚

## 28ã€Spring Cloud Feignæ˜¯ä»€ä¹ˆï¼Ÿ

> Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼WebServiceå®¢æˆ·ç«¯ã€‚ä½¿ç”¨Feignèƒ½è®©ç¼–å†™Web Serviceå®¢æˆ·ç«¯æ›´åŠ ç®€å•ã€‚
>
> å®ƒçš„ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡æ¥å£ç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£ã€‚Feignä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚Spring Cloudå¯¹Feignè¿›è¡Œäº†å°è£…ï¼Œä½¿å…¶æ”¯æŒäº†Spring MVCæ ‡å‡†æ³¨è§£å’ŒHttpMessageConvertersã€‚Feignå¯ä»¥ä¸Eurekaå’ŒRibbonç»„åˆä½¿ç”¨ä»¥æ”¯æŒè´Ÿè½½å‡è¡¡

## 29ã€Feignä¸OpenFeignçš„åŒºåˆ«ï¼Ÿ

> | Feign                                                        | OpenFeign                                                    |
> | ------------------------------------------------------------ | ------------------------------------------------------------ |
> | Feignæ˜¯Spring Cloudç»„ä»¶ä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTfulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯ï¼›Feignå†…ç½®äº†Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚Feignçš„ä½¿ç”¨æ–¹å¼æ˜¯ï¼šä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ | OpenFeignæ˜¯Spring Cloud åœ¨Feignçš„åŸºç¡€ä¸Šæ”¯æŒäº†SpringMVCçš„æ³¨è§£ï¼Œå¦‚@RequesMappingç­‰ç­‰ã€‚OpenFeignçš„@FeignClientå¯ä»¥è§£æSpringMVCçš„@RequestMappingæ³¨è§£ä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ã€‚ |
> | `<dependency>  <groupId>org.springframework.cloud</groupId> <artifactId>spring-cloud-starter-feign</artifactId></dependency>` | `<dependency> <groupId>org.springframework.cloud</groupId> <artifactId>spring-cloud-starter-openfeign</artifactId></dependency> `|

## 30ã€OpenFeignçš„è¶…æ—¶æ§åˆ¶ä½ äº†è§£ï¼Ÿ

> é»˜è®¤Feignå®¢æˆ·ç«¯åªç­‰å¾…ä¸€ç§’é’Ÿï¼Œä½†æ˜¯æœåŠ¡ç«¯å¤„ç†éœ€è¦è¶…è¿‡1ç§’é’Ÿï¼Œå¯¼è‡´Feignå®¢æˆ·ç«¯ä¸æƒ³ç­‰å¾…äº†ï¼Œç›´æ¥è¿”å›æŠ¥é”™ã€‚
>
> ä¸ºäº†é¿å…è¿™æ ·çš„æƒ…å†µï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦è®¾ç½®Feignå®¢æˆ·ç«¯çš„è¶…æ—¶æ§åˆ¶ã€‚
>
> ```
> #è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´(OpenFeigné»˜è®¤æ”¯æŒribbon)
> ribbon:
> #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹,ä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´
> ReadTimeout: 5000
> #æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´
> ConnectTimeout: 5000
> ```

## 31ã€ä»€ä¹ˆæ˜¯Hystrixæ–­è·¯å™¨ï¼Ÿ

> Hystrixæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å»¶è¿Ÿå’Œå®¹é”™çš„å¼€æºåº“ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œè®¸å¤šä¾èµ–ä¸å¯é¿å…çš„ä¼šè°ƒç”¨å¤±è´¥ï¼Œæ¯”å¦‚è¶…æ—¶ã€å¼‚å¸¸ç­‰ï¼ŒHystrixèƒ½å¤Ÿä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºé—®é¢˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥ï¼Œé¿å…çº§è”æ•…éšœï¼Œä»¥æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ã€‚

## 32ã€Hystrixå®ç°å»¶è¿Ÿå’Œå®¹é”™çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ

> - åŒ…è£¹è¯·æ±‚ï¼šä½¿ç”¨HystrixCommandåŒ…è£¹å¯¹ä¾èµ–çš„è°ƒç”¨é€»è¾‘ï¼Œæ¯ä¸ªå‘½ä»¤åœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­æ‰§è¡Œã€‚è¿™ä½¿ç”¨äº†è®¾è®¡æ¨¡å¼ä¸­çš„â€œå‘½ä»¤æ¨¡å¼â€ã€‚
> - è·³é—¸æœºåˆ¶ï¼šå½“æŸæœåŠ¡çš„é”™è¯¯ç‡è¶…è¿‡ä¸€å®šçš„é˜ˆå€¼æ—¶ï¼ŒHystrixå¯ä»¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨è·³é—¸ï¼Œåœæ­¢è¯·æ±‚è¯¥æœåŠ¡ä¸€æ®µæ—¶é—´ã€‚
> - èµ„æºéš”ç¦»ï¼šHystrixä¸ºæ¯ä¸ªä¾èµ–éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå°å‹çš„çº¿ç¨‹æ± ï¼ˆæˆ–è€…ä¿¡å·é‡ï¼‰ã€‚å¦‚æœè¯¥çº¿ç¨‹æ± å·²æ»¡ï¼Œå‘å¾€è¯¥ä¾èµ–çš„è¯·æ±‚å°±è¢«ç«‹å³æ‹’ç»ï¼Œè€Œä¸æ˜¯æ’é˜Ÿç­‰å¾…ï¼Œä»è€ŒåŠ é€Ÿå¤±è´¥åˆ¤å®šã€‚
> - ç›‘æ§ï¼šHystrixå¯ä»¥è¿‘ä¹å®æ—¶åœ°ç›‘æ§è¿è¡ŒæŒ‡æ ‡å’Œé…ç½®çš„å˜åŒ–ï¼Œä¾‹å¦‚æˆåŠŸã€å¤±è´¥ã€è¶…æ—¶ã€ä»¥åŠè¢«æ‹’ç»çš„è¯·æ±‚ç­‰ã€‚
> - å›é€€æœºåˆ¶ï¼šå½“è¯·æ±‚å¤±è´¥ã€è¶…æ—¶ã€è¢«æ‹’ç»ï¼Œæˆ–å½“æ–­è·¯å™¨æ‰“å¼€æ—¶ï¼Œæ‰§è¡Œå›é€€é€»è¾‘ã€‚å›é€€é€»è¾‘ç”±å¼€å‘äººå‘˜è‡ªè¡Œæä¾›ï¼Œä¾‹å¦‚è¿”å›ä¸€ä¸ªç¼ºçœå€¼ã€‚
> - è‡ªæˆ‘ä¿®å¤ï¼šæ–­è·¯å™¨æ‰“å¼€ä¸€æ®µæ—¶é—´åï¼Œä¼šè‡ªåŠ¨è¿›å…¥â€œåŠå¼€â€çŠ¶æ€ã€‚

## 33ã€é›ªå´©æ•ˆåº”ï¼Œä½ äº†è§£å—ï¼Ÿ

> åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªè¯·æ±‚éœ€è¦è°ƒç”¨å¤šä¸ªæœåŠ¡æ˜¯éå¸¸å¸¸è§çš„ã€‚å¦‚å®¢æˆ·ç«¯è®¿é—®AæœåŠ¡ï¼Œè€ŒAæœåŠ¡éœ€è¦è°ƒç”¨BæœåŠ¡ï¼ŒBæœåŠ¡éœ€è¦è°ƒç”¨CæœåŠ¡ï¼Œç”±äºç½‘ç»œåŸå› æˆ–è€…è‡ªèº«çš„åŸå› ï¼Œå¦‚æœBæœåŠ¡æˆ–è€…CæœåŠ¡ä¸èƒ½åŠæ—¶å“åº”ï¼ŒAæœåŠ¡å°†å¤„äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°BæœåŠ¡CæœåŠ¡å“åº”ã€‚æ­¤æ—¶è‹¥æœ‰å¤§é‡çš„è¯·æ±‚æ¶Œå…¥ï¼Œå®¹å™¨çš„çº¿ç¨‹èµ„æºä¼šè¢«æ¶ˆè€—å®Œæ¯•ï¼Œå¯¼è‡´æœåŠ¡ç˜«ç—ªã€‚æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¾èµ–æ€§ï¼Œæ•…éšœä¼šä¼ æ’­ï¼Œé€ æˆè¿é”ååº”ï¼Œä¼šå¯¹æ•´ä¸ªå¾®æœåŠ¡ç³»ç»Ÿé€ æˆç¾éš¾æ€§çš„ä¸¥é‡åæœï¼Œè¿™å°±æ˜¯æœåŠ¡æ•…éšœçš„â€œé›ªå´©â€æ•ˆåº”ã€‚
>
> é€ æˆé›ªå´©æ•ˆåº”çš„åŸå› ï¼š
>
> - å•ä¸ªæœåŠ¡çš„ä»£ç å­˜åœ¨bug
> - è¯·æ±‚è®¿é—®é‡æ¿€å¢å¯¼è‡´æœåŠ¡å‘ç”Ÿå´©æºƒ(å¦‚å¤§å‹å•†åŸçš„æªçº¢åŒ…ï¼Œç§’æ€åŠŸèƒ½)
> - æœåŠ¡å™¨çš„ç¡¬ä»¶æ•…éšœä¹Ÿä¼šå¯¼è‡´éƒ¨åˆ†æœåŠ¡ä¸å¯ç”¨

## 34ã€æœåŠ¡é™çº§ï¼Œä½ äº†è§£å—ï¼Ÿ

> æ‰€è°“é™çº§ï¼Œå°±æ˜¯å½“æŸä¸ªæœåŠ¡ç†”æ–­ä¹‹åï¼ŒæœåŠ¡å™¨å°†ä¸å†è¢«è°ƒç”¨ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯å¯ä»¥è‡ªå·±å‡†å¤‡ä¸€ä¸ªæœ¬åœ°çš„fallbackå›è°ƒï¼Œè¿”å›ä¸€ä¸ªç¼ºçœå€¼ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºå…œåº•æ–¹æ³•ã€‚
>
> **ä¼šå‘ç”Ÿé™çº§çš„æƒ…å†µ**
>
> - ç¨‹åºè¿è¡Œå¼‚å¸¸
> - è¶…æ—¶
> - æœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§
> - çº¿ç¨‹æ± ã€ä¿¡å·é‡æ‰“æ»¡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§

## 35ã€æœåŠ¡ç†”æ–­ï¼Œä½ äº†è§£å—ï¼Ÿ

> ç±»æ¯”ä¿é™©ä¸è¾¾åˆ°æœ€å¤§çš„æœåŠ¡è®¿é—®åï¼Œç›´æ¥æ‹’ç»è®¿é—®ï¼Œæ‹‰é—¸é™ç”µï¼Œç„¶åè°ƒç”¨æœåŠ¡é™çº§çš„æ–¹æ³•å¹¶è¿”å›å‹å¥½æç¤º
>
> å°±ç›¸å½“äºä¿é™©ä¸ï¼ŒæœåŠ¡çš„é™çº§-----ã€‹è¿›è€Œç†”æ–­-----ã€‹æ¢å¤è°ƒç”¨é“¾è·¯

## 36ã€æœåŠ¡é™æµï¼Œä½ äº†è§£å—ï¼Ÿ

> é™æµå¯ä»¥è®¤ä¸ºæœåŠ¡é™çº§çš„ä¸€ç§ï¼Œé™æµå°±æ˜¯é™åˆ¶ç³»ç»Ÿçš„è¾“å…¥å’Œè¾“å‡ºæµé‡å·²è¾¾åˆ°ä¿æŠ¤ç³»ç»Ÿçš„ç›®çš„ã€‚ä¸€èˆ¬æ¥è¯´ç³»ç»Ÿçš„ååé‡æ˜¯å¯ä»¥è¢«æµ‹ç®—çš„ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„ç¨³å›ºè¿è¡Œï¼Œä¸€æ—¦è¾¾åˆ°çš„éœ€è¦é™åˆ¶çš„é˜ˆå€¼ï¼Œå°±éœ€è¦é™åˆ¶æµé‡å¹¶é‡‡å–å°‘é‡æªæ–½ä»¥å®Œæˆé™åˆ¶æµé‡çš„ç›®çš„ã€‚æ¯”æ–¹ï¼šæ¨è¿Ÿè§£å†³ï¼Œæ‹’ç»è§£å†³ï¼Œæˆ–è€…è€…éƒ¨åˆ†æ‹’ç»è§£å†³ç­‰ç­‰ã€‚ç§’æ€é«˜å¹¶å‘ç­‰æ“ä½œï¼Œä¸¥ç¦ä¸€çªèœ‚çš„ä¸€æ ·æ‹¥æŒ¤ï¼Œæ’é˜Ÿæœ‰åºè¿›è¡Œï¼Œä¸€ç§’é’ŸNä¸ªï¼Œæœ‰åºè¿›è¡Œ

## 37ã€Hystrixå·¥ä½œæµç¨‹ï¼Ÿ

> ![å›¾ç‰‡](../images/640-16630797360341.png)
>
> | åºå· | æ“ä½œ                                                         |
> | ---- | ------------------------------------------------------------ |
> | 1    | åˆ›å»º HystrixCommandï¼ˆç”¨åœ¨ä¾èµ–çš„æœåŠ¡è¿”å›å•ä¸ªæ“ä½œç»“æœçš„æ—¶å€™ï¼‰ æˆ– HystrixObserableCommandï¼ˆç”¨åœ¨ä¾èµ–çš„æœåŠ¡è¿”å›å¤šä¸ªæ“ä½œç»“æœçš„æ—¶å€™ï¼‰ å¯¹è±¡ã€‚ |
> | 2    | å‘½ä»¤æ‰§è¡Œã€‚å…¶ä¸­ HystrixComand å®ç°äº†ä¸‹é¢å‰ä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼›è€Œ HystrixObservableCommand å®ç°äº†åä¸¤ç§æ‰§è¡Œæ–¹å¼ï¼šexecute()ï¼šåŒæ­¥æ‰§è¡Œï¼Œä»ä¾èµ–çš„æœåŠ¡è¿”å›ä¸€ä¸ªå•ä¸€çš„ç»“æœå¯¹è±¡ï¼Œ æˆ–æ˜¯åœ¨å‘ç”Ÿé”™è¯¯çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ã€‚queue()ï¼šå¼‚æ­¥æ‰§è¡Œï¼Œ ç›´æ¥è¿”å› ä¸€ä¸ªFutureå¯¹è±¡ï¼Œ å…¶ä¸­åŒ…å«äº†æœåŠ¡æ‰§è¡Œç»“æŸæ—¶è¦è¿”å›çš„å•ä¸€ç»“æœå¯¹è±¡ã€‚observe()ï¼šè¿”å› Observable å¯¹è±¡ï¼Œå®ƒä»£è¡¨äº†æ“ä½œçš„å¤šä¸ªç»“æœï¼Œå®ƒæ˜¯ä¸€ä¸ª Hot Obserableï¼ˆä¸è®º "äº‹ä»¶æº" æ˜¯å¦æœ‰ "è®¢é˜…è€…"ï¼Œéƒ½ä¼šåœ¨åˆ›å»ºåå¯¹äº‹ä»¶è¿›è¡Œå‘å¸ƒï¼Œæ‰€ä»¥å¯¹äº Hot Observable çš„æ¯ä¸€ä¸ª "è®¢é˜…è€…" éƒ½æœ‰å¯èƒ½æ˜¯ä» "äº‹ä»¶æº" çš„ä¸­é€”å¼€å§‹çš„ï¼Œå¹¶å¯èƒ½åªæ˜¯çœ‹åˆ°äº†æ•´ä¸ªæ“ä½œçš„å±€éƒ¨è¿‡ç¨‹ï¼‰ã€‚toObservable()ï¼šåŒæ ·ä¼šè¿”å› Observable å¯¹è±¡ï¼Œä¹Ÿä»£è¡¨äº†æ“ä½œçš„å¤šä¸ªç»“æœï¼Œä½†å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªCold Observableï¼ˆæ²¡æœ‰ "è®¢é˜…è€…" çš„æ—¶å€™å¹¶ä¸ä¼šå‘å¸ƒäº‹ä»¶ï¼Œè€Œæ˜¯è¿›è¡Œç­‰å¾…ï¼Œç›´åˆ°æœ‰ "è®¢é˜…è€…" ä¹‹åæ‰å‘å¸ƒäº‹ä»¶ï¼Œæ‰€ä»¥å¯¹äº Cold Observable çš„è®¢é˜…è€…ï¼Œå®ƒå¯ä»¥ä¿è¯ä»ä¸€å¼€å§‹çœ‹åˆ°æ•´ä¸ªæ“ä½œçš„å…¨éƒ¨è¿‡ç¨‹ï¼‰ã€‚ |
> | 3    | è‹¥å½“å‰å‘½ä»¤çš„è¯·æ±‚ç¼“å­˜åŠŸèƒ½æ˜¯è¢«å¯ç”¨çš„ï¼Œ å¹¶ä¸”è¯¥å‘½ä»¤ç¼“å­˜å‘½ä¸­ï¼Œ é‚£ä¹ˆç¼“å­˜çš„ç»“æœä¼šç«‹å³ä»¥ Observable å¯¹è±¡çš„å½¢å¼ è¿”å›ã€‚ |
> | 4    | æ£€æŸ¥æ–­è·¯å™¨æ˜¯å¦ä¸ºæ‰“å¼€çŠ¶æ€ã€‚å¦‚æœæ–­è·¯å™¨æ˜¯æ‰“å¼€çš„ï¼Œé‚£ä¹ˆHystrixä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œè€Œæ˜¯è½¬æ¥åˆ° fallback å¤„ç†é€»è¾‘ï¼ˆç¬¬ 8 æ­¥ï¼‰ï¼›å¦‚æœæ–­è·¯å™¨æ˜¯å…³é—­çš„ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å¯ç”¨èµ„æºæ¥æ‰§è¡Œå‘½ä»¤ï¼ˆç¬¬ 5 æ­¥ï¼‰ã€‚ |
> | 5    | çº¿ç¨‹æ± /è¯·æ±‚é˜Ÿåˆ—/ä¿¡å·é‡æ˜¯å¦å æ»¡ã€‚å¦‚æœå‘½ä»¤ä¾èµ–æœåŠ¡çš„ä¸“æœ‰çº¿ç¨‹æ± å’Œè¯·æ±‚é˜Ÿåˆ—ï¼Œæˆ–è€…ä¿¡å·é‡ï¼ˆä¸ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ï¼‰å·²ç»è¢«å æ»¡ï¼Œ é‚£ä¹ˆ Hystrix ä¹Ÿä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œ è€Œæ˜¯è½¬æ¥åˆ° fallback å¤„ç†é€»è¾‘ï¼ˆç¬¬8æ­¥ï¼‰ã€‚ |
> | 6    | Hystrix ä¼šæ ¹æ®æˆ‘ä»¬ç¼–å†™çš„æ–¹æ³•æ¥å†³å®šé‡‡å–ä»€ä¹ˆæ ·çš„æ–¹å¼å»è¯·æ±‚ä¾èµ–æœåŠ¡ã€‚HystrixCommand.run() ï¼šè¿”å›ä¸€ä¸ªå•ä¸€çš„ç»“æœï¼Œæˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚HystrixObservableCommand.construct()ï¼šè¿”å›ä¸€ä¸ªObservable å¯¹è±¡æ¥å‘å°„å¤šä¸ªç»“æœï¼Œæˆ–é€šè¿‡ onError å‘é€é”™è¯¯é€šçŸ¥ã€‚ |
> | 7    | Hystrixä¼šå°† "æˆåŠŸ"ã€"å¤±è´¥"ã€"æ‹’ç»"ã€"è¶…æ—¶" ç­‰ä¿¡æ¯æŠ¥å‘Šç»™æ–­è·¯å™¨ï¼Œ è€Œæ–­è·¯å™¨ä¼šç»´æŠ¤ä¸€ç»„è®¡æ•°å™¨æ¥ç»Ÿè®¡è¿™äº›æ•°æ®ã€‚æ–­è·¯å™¨ä¼šä½¿ç”¨è¿™äº›ç»Ÿè®¡æ•°æ®æ¥å†³å®šæ˜¯å¦è¦å°†æ–­è·¯å™¨æ‰“å¼€ï¼Œæ¥å¯¹æŸä¸ªä¾èµ–æœåŠ¡çš„è¯·æ±‚è¿›è¡Œ "ç†”æ–­/çŸ­è·¯"ã€‚ |
> | 8    | å½“å‘½ä»¤æ‰§è¡Œå¤±è´¥çš„æ—¶å€™ï¼Œ Hystrix ä¼šè¿›å…¥ fallback å°è¯•å›é€€å¤„ç†ï¼Œ æˆ‘ä»¬é€šå¸¸ä¹Ÿç§°è¯¥æ“ä½œä¸º "æœåŠ¡é™çº§"ã€‚è€Œèƒ½å¤Ÿå¼•èµ·æœåŠ¡é™çº§å¤„ç†çš„æƒ…å†µæœ‰ä¸‹é¢å‡ ç§ï¼šç¬¬4æ­¥ï¼šå½“å‰å‘½ä»¤å¤„äº"ç†”æ–­/çŸ­è·¯"çŠ¶æ€ï¼Œæ–­è·¯å™¨æ˜¯æ‰“å¼€çš„æ—¶å€™ã€‚ç¬¬5æ­¥ï¼šå½“å‰å‘½ä»¤çš„çº¿ç¨‹æ± ã€ è¯·æ±‚é˜Ÿåˆ—æˆ– è€…ä¿¡å·é‡è¢«å æ»¡çš„æ—¶å€™ã€‚ç¬¬6æ­¥ï¼šHystrixObservableCommand.construct() æˆ– HystrixCommand.run() æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™ã€‚ |
> | 9    | å½“Hystrixå‘½ä»¤æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œ å®ƒä¼šå°†å¤„ç†ç»“æœç›´æ¥è¿”å›æˆ–æ˜¯ä»¥Observable çš„å½¢å¼è¿”å›ã€‚ |
>
> tipsï¼šå¦‚æœæˆ‘ä»¬æ²¡æœ‰ä¸ºå‘½ä»¤å®ç°é™çº§é€»è¾‘æˆ–è€…åœ¨é™çº§å¤„ç†é€»è¾‘ä¸­æŠ›å‡ºäº†å¼‚å¸¸ï¼Œ Hystrix ä¾ç„¶ä¼šè¿”å›ä¸€ä¸ª Observable å¯¹è±¡ï¼Œ ä½†æ˜¯å®ƒä¸ä¼šå‘å°„ä»»ä½•ç»“æœæ•°æ®ï¼Œ è€Œæ˜¯é€šè¿‡ onError æ–¹æ³•é€šçŸ¥å‘½ä»¤ç«‹å³ä¸­æ–­è¯·æ±‚ï¼Œå¹¶é€šè¿‡onError()æ–¹æ³•å°†å¼•èµ·å‘½ä»¤å¤±è´¥çš„å¼‚å¸¸å‘é€ç»™è°ƒç”¨è€…ã€‚

## 38ã€ ä»€ä¹ˆæ˜¯Spring Cloud Zuulï¼Ÿ

> Zuulæ˜¯å¯¹SpringCloudæä¾›çš„æˆç†Ÿå¯¹çš„è·¯ç”±æ–¹æ¡ˆï¼Œä»–ä¼šæ ¹æ®è¯·æ±‚çš„è·¯å¾„ä¸åŒï¼Œç½‘å…³ä¼šå®šä½åˆ°æŒ‡å®šçš„å¾®æœåŠ¡ï¼Œå¹¶ä»£ç†è¯·æ±‚åˆ°ä¸åŒçš„å¾®æœåŠ¡æ¥å£ï¼Œä»–å¯¹å¤–éšè”½äº†å¾®æœåŠ¡çš„çœŸæ­£æ¥å£åœ°å€ã€‚ä¸‰ä¸ªé‡è¦æ¦‚å¿µï¼šåŠ¨æ€è·¯ç”±è¡¨ï¼Œè·¯ç”±å®šä½ï¼Œåå‘ä»£ç†
>
> - åŠ¨æ€è·¯ç”±è¡¨ï¼šZuulæ”¯æŒEurekaè·¯ç”±ï¼Œæ‰‹åŠ¨é…ç½®è·¯ç”±ï¼Œè¿™ä¿©ç§éƒ½æ”¯æŒè‡ªåŠ¨æ›´æ–°
> - è·¯ç”±å®šä½ï¼šæ ¹æ®è¯·æ±‚è·¯å¾„ï¼ŒZuulæœ‰è‡ªå·±çš„ä¸€å¥—å®šä½æœåŠ¡è§„åˆ™ä»¥åŠè·¯ç”±è¡¨è¾¾å¼åŒ¹é…
> - åå‘ä»£ç†ï¼šå®¢æˆ·ç«¯è¯·æ±‚åˆ°è·¯ç”±ç½‘å…³ï¼Œç½‘å…³å—ç†ä¹‹åï¼Œåœ¨å¯¹ç›®æ ‡å‘é€è¯·æ±‚ï¼Œæ‹¿åˆ°å“åº”ä¹‹ååœ¨ ç»™å®¢æˆ·ç«¯

## 39ã€Zuulçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿ

> å¯¹å¤–æš´éœ²ï¼Œæƒé™æ ¡éªŒï¼ŒæœåŠ¡èšåˆï¼Œæ—¥å¿—å®¡è®¡

## 40ã€ç½‘å…³ä¸è¿‡æ»¤å™¨æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

> ç½‘å…³æ˜¯å¯¹æ‰€æœ‰æœåŠ¡çš„è¯·æ±‚è¿›è¡Œåˆ†æè¿‡æ»¤ï¼Œè¿‡æ»¤å™¨æ˜¯å¯¹å•ä¸ªæœåŠ¡è€Œè¨€

## 41ã€Zuulä¸Nginxæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

> Zuulæ˜¯javaè¯­è¨€å®ç°çš„ï¼Œä¸»è¦ä¸ºjavaæœåŠ¡æä¾›ç½‘å…³æœåŠ¡ï¼Œå°¤å…¶åœ¨å¾®æœåŠ¡æ¶æ„ä¸­å¯ä»¥æ›´åŠ çµæ´»çš„å¯¹ç½‘å…³è¿›è¡Œæ“ä½œã€‚
>
> Nginxæ˜¯ä½¿ç”¨Cè¯­è¨€å®ç°ï¼Œæ€§èƒ½é«˜äºZuulï¼Œä½†æ˜¯å®ç°è‡ªå®šä¹‰æ“ä½œéœ€è¦ç†Ÿæ‚‰luaè¯­è¨€ï¼Œå¯¹ç¨‹åºå‘˜è¦æ±‚è¾ƒé«˜ï¼Œå¯ä»¥ä½¿ç”¨NginxåšZuulé›†ç¾¤ã€‚

## 42ã€ ZuulFilterå¸¸ç”¨æœ‰é‚£äº›æ–¹æ³•ï¼Ÿ

> - Run()ï¼šè¿‡æ»¤å™¨çš„å…·ä½“ä¸šåŠ¡é€»è¾‘
>
> - shouldFilter()ï¼šåˆ¤æ–­è¿‡æ»¤å™¨æ˜¯å¦æœ‰æ•ˆ
>
> - fifilterOrder()ï¼šè¿‡æ»¤å™¨æ‰§è¡Œé¡ºåº
>
> - fifilterType()ï¼šè¿‡æ»¤å™¨æ‹¦æˆªä½ç½®

## 43ã€ä»€ä¹ˆæ˜¯Spring Cloud GateWayï¼Ÿ

> Spring Cloud Gateway ä½œä¸º Spring Cloud ç”Ÿæ€ç³»ç»Ÿä¸­çš„ç½‘å…³ï¼Œç›®æ ‡æ˜¯æ›¿ä»£ Zuulï¼Œåœ¨Spring Cloud 2.0ä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œæ²¡æœ‰å¯¹æ–°ç‰ˆæœ¬çš„Zuul 2.0ä»¥ä¸Šæœ€æ–°é«˜æ€§èƒ½ç‰ˆæœ¬è¿›è¡Œé›†æˆï¼Œä»ç„¶è¿˜æ˜¯ä½¿ç”¨çš„Zuul 1.xéReactoræ¨¡å¼çš„è€ç‰ˆæœ¬ã€‚
>
> **è€Œä¸ºäº†æå‡ç½‘å…³çš„æ€§èƒ½ï¼ŒSpringCloud Gatewayæ˜¯åŸºäºWebFluxæ¡†æ¶å®ç°çš„ï¼Œè€ŒWebFluxæ¡†æ¶åº•å±‚åˆ™ä½¿ç”¨äº†é«˜æ€§èƒ½çš„Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶Nettyã€‚**
>
> Spring Cloud Gatewayçš„ç›®æ ‡æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ä¸”åŸºäº Filter é“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šå®‰å…¨ï¼Œç›‘æ§/æŒ‡æ ‡ï¼Œå’Œé™æµã€‚

## 44ã€ä¸ºä»€ä¹ˆæˆ‘ä»¬é€‰æ‹©GateWayï¼Ÿ

> 1. netflixä¸é è°±ï¼Œè¿Ÿè¿Ÿä¸å‘å¸ƒ
     >
     >    å› ä¸ºZuul1.0å·²ç»è¿›å…¥äº†ç»´æŠ¤é˜¶æ®µï¼Œè€Œä¸”Gatewayæ˜¯SpringCloudå›¢é˜Ÿç ”å‘çš„ï¼Œæ˜¯äº²å„¿å­äº§å“ï¼Œå€¼å¾—ä¿¡èµ–ã€‚è€Œä¸”å¾ˆå¤šåŠŸèƒ½Zuuléƒ½æ²¡æœ‰ç”¨èµ·æ¥ä¹Ÿéå¸¸çš„ç®€å•ä¾¿æ·ã€‚
     >
     >    Gatewayæ˜¯åŸºäºå¼‚æ­¥éé˜»å¡æ¨¡å‹ä¸Šè¿›è¡Œå¼€å‘çš„ï¼Œæ€§èƒ½æ–¹é¢ä¸éœ€è¦æ‹…å¿ƒã€‚è™½ç„¶Netflixæ—©å°±å‘å¸ƒäº†æœ€æ–°çš„ Zuul 2.xï¼Œä½† Spring Cloud è²Œä¼¼æ²¡æœ‰æ•´åˆè®¡åˆ’ã€‚è€Œä¸”Netflixç›¸å…³ç»„ä»¶éƒ½å®£å¸ƒè¿›å…¥ç»´æŠ¤æœŸï¼›ä¸çŸ¥å‰æ™¯å¦‚ä½•ï¼Ÿ
     >
     >    å¤šæ–¹é¢ç»¼åˆè€ƒè™‘Gatewayæ˜¯å¾ˆç†æƒ³çš„ç½‘å…³é€‰æ‹©ã€‚
>
> 2. Spring Cloud GateWayæœ‰å¾ˆå¤šç‰¹æ€§
>
> 3. - åŸºäºSpring Framework 5, Project Reactor å’Œ Spring Boot 2.0 è¿›è¡Œæ„å»ºï¼›
>    - åŠ¨æ€è·¯ç”±ï¼šèƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§ï¼›
>    - å¯ä»¥å¯¹è·¯ç”±æŒ‡å®š Predicateï¼ˆæ–­è¨€ï¼‰å’Œ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼›
>    - é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½ï¼›
>    - é›†æˆ Spring Cloud æœåŠ¡å‘ç°åŠŸèƒ½ï¼›
>    - æ˜“äºç¼–å†™çš„ Predicateï¼ˆæ–­è¨€ï¼‰å’Œ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ï¼›
>    - è¯·æ±‚é™æµåŠŸèƒ½ï¼›
>    - æ”¯æŒè·¯å¾„é‡å†™ã€‚

## 45ã€Spring Cloud Gateway ä¸ Zuulçš„åŒºåˆ«ï¼Ÿ

> 1. Zuul 1.xï¼Œæ˜¯ä¸€ä¸ªåŸºäºé˜»å¡ I/ O çš„ API Gateway
> 2. Zuul 1.x åŸºäºServlet 2. 5ä½¿ç”¨é˜»å¡æ¶æ„å®ƒä¸æ”¯æŒä»»ä½•é•¿è¿æ¥(å¦‚ WebSocket) Zuul çš„è®¾è®¡æ¨¡å¼å’ŒNginxè¾ƒåƒï¼Œæ¯æ¬¡ I/ O æ“ä½œéƒ½æ˜¯ä»å·¥ä½œçº¿ç¨‹ä¸­é€‰æ‹©ä¸€ä¸ªæ‰§è¡Œï¼Œè¯·æ±‚çº¿ç¨‹è¢«é˜»å¡åˆ°å·¥ä½œçº¿ç¨‹å®Œæˆï¼Œä½†æ˜¯å·®åˆ«æ˜¯Nginx ç”¨C++ å®ç°ï¼ŒZuul ç”¨ Java å®ç°ï¼Œè€Œ JVM æœ¬èº«ä¼šæœ‰ç¬¬ä¸€æ¬¡åŠ è½½è¾ƒæ…¢çš„æƒ…å†µï¼Œä½¿å¾—Zuul çš„æ€§èƒ½ç›¸å¯¹è¾ƒå·®ã€‚
> 3. Zuul 2.xç†å¿µæ›´å…ˆè¿›ï¼Œæƒ³åŸºäºNettyéé˜»å¡å’Œæ”¯æŒé•¿è¿æ¥ï¼Œä½†SpringCloudç›®å‰è¿˜æ²¡æœ‰æ•´åˆã€‚Zuul 2.xçš„æ€§èƒ½è¾ƒ Zuul 1.x æœ‰è¾ƒå¤§æå‡ã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œæ ¹æ®å®˜æ–¹æä¾›çš„åŸºå‡†æµ‹è¯•ï¼Œ Spring Cloud Gateway çš„ RPSï¼ˆæ¯ç§’è¯·æ±‚æ•°ï¼‰æ˜¯Zuul çš„ 1. 6 å€ã€‚
> 4. Spring Cloud Gateway å»ºç«‹ åœ¨ Spring Framework 5ã€ Project Reactor å’Œ Spring Boot 2 ä¹‹ä¸Šï¼Œ ä½¿ç”¨éé˜»å¡ APIã€‚
> 5. Spring Cloud Gateway è¿˜ æ”¯æŒ WebSocketï¼Œ å¹¶ä¸”ä¸Springç´§å¯†é›†æˆæ‹¥æœ‰æ›´å¥½çš„å¼€å‘ä½“éªŒ

## 46ã€Spring Cloud GateWayå·¥ä½œæµç¨‹ï¼Ÿ

> ![å›¾ç‰‡](../images/640-16630797360342.png)
>
> å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚ç„¶ååœ¨ Gateway Handler Mapping ä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ° Gateway Web Handlerã€‚
>
> Handler å†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚
>
> è¿‡æ»¤å™¨ä¹‹é—´ç”¨è™šçº¿åˆ†å¼€æ˜¯å› ä¸ºè¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰ï¼ˆâ€œpreâ€ï¼‰æˆ–ä¹‹åï¼ˆâ€œpostâ€ï¼‰æ‰§è¡Œä¸šåŠ¡é€»è¾‘ã€‚
>
> Filteråœ¨â€œpreâ€ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ ¡éªŒã€æƒé™æ ¡éªŒã€æµé‡ç›‘æ§ã€æ—¥å¿—è¾“å‡ºã€åè®®è½¬æ¢ç­‰ï¼Œ
>
> åœ¨â€œpostâ€ç±»å‹çš„è¿‡æ»¤å™¨ä¸­å¯ä»¥åšå“åº”å†…å®¹ã€å“åº”å¤´çš„ä¿®æ”¹ï¼Œæ—¥å¿—çš„è¾“å‡ºï¼Œæµé‡ç›‘æ§ç­‰æœ‰ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚
>
> æ ¸å¿ƒé€»è¾‘ï¼š**è·¯ç”±è½¬å‘+æ‰§è¡Œè¿‡æ»¤é“¾**

## 47ã€Spring Cloud GateWayç½‘å…³é…ç½®çš„ä¸¤ç§æ–¹å¼ï¼Ÿ

> - yamlé…ç½®
    >
    >   ```
>    server:
>      port: 9527
>   
>    spring:
>      application:
>        name: xiaobear-cloud-gateway
>      cloud:
>        gateway:
>          routes:
>            - id: payment_routh #payment_route    #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
>              uri: http://localhost:8001         #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
>              predicates:
>                - Path=/payment/selectOne/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>   
>            - id: payment_routh2 #payment_route   #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
>              uri: http://localhost:8001         #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
>              predicates:
>                - Path=/payment/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>   ```
>
>
>
> - ä»£ç ä¸­æ³¨å…¥`RouteLocator`çš„`Bean`
    >
    >   ```
>    @Configuration
>    public class GateWayConfig {
>   
>        @Bean
>        public RouteLocator customRouteLocator(RouteLocatorBuilder routeBuilder){
>            return routeBuilder.routes().route("xiaobear-config",r -> r.path("/spring-cloud-gateway-configuration").uri("https://www.bilibili.com/video/BV18E411x7eT")).build();
>       }
>    }
>   ```

## 48ã€Spring Cloud GateWayå¸¸ç”¨çš„æ–­è¨€æ–¹å¼æœ‰å“ªäº›ï¼Ÿ

> - After Route Predicate Factoryï¼šè¡¨ç¤ºåœ¨è¿™ä¸ªæ—¶åŒºé‡Œçš„æ—¶é—´ç‚¹æ‰å…è®¸è®¿é—®ï¼Œæ—¶é—´æ ¼å¼ä¸ºJava 8æ–°ç‰¹æ€§çš„æ—¶åŒºæ—¶é—´æ ¼å¼
    >
    >   ```
>    ZonedDateTime zbj = ZonedDateTime.now(); // é»˜è®¤æ—¶åŒº
>     ZonedDateTime zny = ZonedDateTime.now(ZoneId.of("America/New_York")); // ç”¨æŒ‡å®šæ—¶åŒºè·å–å½“å‰æ—¶é—´
>   ```
    >
    >   ```
>    spring:
>     application:
>       name: xiaobear-cloud-gateway
>     cloud:
>       gateway:
>         routes:
>         - id: payment_routh2 #payment_route   #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
>             uri: lb://XIAOBEAR-CLOUD-PAYMENT-SERVICE
>              #uri: http://localhost:8001         #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
>             predicates:
>               - Path=/payment/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>               - After=2021-05-24T15:17:53.623+08:00[Asia/Shanghai]         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>   ```
>
> - Before Route Predicate Factoryï¼šåœ¨æ—¶é—´ç‚¹å‰æ‰å…è®¸è®¿é—®
    >
    >   ```
>    spring:
>     application:
>       name: xiaobear-cloud-gateway
>     cloud:
>       gateway:
>         routes:
>         - id: payment_routh2 #payment_route   #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
>             uri: lb://XIAOBEAR-CLOUD-PAYMENT-SERVICE
>              #uri: http://localhost:8001         #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
>             predicates:
>               - Path=/payment/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>               - Before=2021-05-24T15:17:53.623+08:00[Asia/Shanghai]         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>   ```
>
>
>
> - Between Route Predicate Factoryï¼šåœ¨ä¸¤è€…ä¹‹é—´
    >
    >   ```
>    spring:
>     application:
>       name: xiaobear-cloud-gateway
>     cloud:
>       gateway:
>         routes:
>         - id: payment_routh2 #payment_route   #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
>             uri: lb://XIAOBEAR-CLOUD-PAYMENT-SERVICE
>              #uri: http://localhost:8001         #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
>             predicates:
>               - Path=/payment/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>               - Between=2021-05-24T15:17:53.623+08:00[Asia/Shanghai], 2021-05-24T15:30:53.623+08:00[Asia/Shanghai]         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>   ```
>
>
>
> - Cookie Route Predicate Factoryï¼šCookie Route Predicateéœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯ Cookie name ,ä¸€ä¸ªæ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚
    >
    >   è·¯ç”±è§„åˆ™ä¼šé€šè¿‡è·å–å¯¹åº”çš„ Cookie name å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸Šå°±ä¼šæ‰§è¡Œè·¯ç”±ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šåˆ™ä¸æ‰§è¡Œ
    >
    >   ```
>    spring:
>     application:
>       name: xiaobear-cloud-gateway
>     cloud:
>       gateway:
>         routes:
>         - id: payment_routh2 #payment_route   #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
>             uri: lb://XIAOBEAR-CLOUD-PAYMENT-SERVICE
>              #uri: http://localhost:8001         #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
>             predicates:
>               - Path=/payment/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>               - Between=2021-05-24T15:17:53.623+08:00[Asia/Shanghai], 2021-05-24T15:30:53.623+08:00[Asia/Shanghai]         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>   ```
>
>
>
> - Header Route Predicate Factoryï¼šä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯å±æ€§åç§°å’Œä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™ä¸ªå±æ€§å€¼å’Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…åˆ™æ‰§è¡Œã€‚
    >
    >   ```
>    spring:
>     application:
>       name: xiaobear-cloud-gateway
>     cloud:
>       gateway:
>         routes:
>         - id: payment_routh2 #payment_route   #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
>             uri: lb://XIAOBEAR-CLOUD-PAYMENT-SERVICE
>              #uri: http://localhost:8001         #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
>             predicates:
>               - Path=/payment/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>               - Header=X-Request-Id, \d+  # è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼        
>   ```
>
>
>
> - Host Route Predicate Factoryï¼šHost Route Predicate æ¥æ”¶ä¸€ç»„å‚æ•°ï¼Œä¸€ç»„åŒ¹é…çš„åŸŸååˆ—è¡¨ï¼Œè¿™ä¸ªæ¨¡æ¿æ˜¯ä¸€ä¸ª ant åˆ†éš”çš„æ¨¡æ¿ï¼Œç”¨.å·ä½œä¸ºåˆ†éš”ç¬¦ã€‚å®ƒé€šè¿‡å‚æ•°ä¸­çš„ä¸»æœºåœ°å€ä½œä¸ºåŒ¹é…è§„åˆ™ã€‚
    >
    >   ```
>    spring:
>     application:
>       name: xiaobear-cloud-gateway
>     cloud:
>       gateway:
>         routes:
>         - id: payment_routh2 #payment_route   #è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å
>             uri: lb://XIAOBEAR-CLOUD-PAYMENT-SERVICE
>              #uri: http://localhost:8001         #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€
>             predicates:
>               - Path=/payment/payment/lb/**         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>               - Host=**.xiaobear.com         # æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±
>   ```
>
>
>
> å…¶ä»–çš„è¯·å‚ç…§å®˜ç½‘ï¼šhttps://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gateway-request-predicates-factories
>
> æ€»ç»“ï¼š`Predicate`å°±æ˜¯ä¸ºäº†å®ç°ä¸€ç»„åŒ¹é…è§„åˆ™ï¼Œè®©è¯·æ±‚æ‰¾åˆ°å¯¹åº”çš„`Route`è¿›è¡Œå¤„ç†

## 49ã€ä»€ä¹ˆæ˜¯Spring Cloud GateWay Filterè¿‡æ»¤ï¼Ÿ

> è·¯ç”±è¿‡æ»¤å™¨å¯ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨åªèƒ½æŒ‡å®šè·¯ç”±è¿›è¡Œä½¿ç”¨ã€‚
>
> Spring Cloud Gateway å†…ç½®äº†å¤šç§è·¯ç”±è¿‡æ»¤å™¨ï¼Œä»–ä»¬éƒ½ç”±GatewayFilterçš„å·¥å‚ç±»æ¥äº§ç”Ÿã€‚

## 50ã€Spring Cloud GateWay Filterè¿‡æ»¤å™¨çš„åˆ†ç±»æœ‰å“ªäº›ï¼Ÿ

> **æŒ‰ç”Ÿå‘½å‘¨æœŸåˆ†ç±»**
>
> - `Pre`
> - `Post`
>
> **æŒ‰ç§ç±»åˆ†ç±»**
>
> - GatewayFilter Factories
> - Global Filters

## 51ã€å¦‚ä½•è‡ªå®šä¹‰Spring Cloud GateWayå…¨å±€è¿‡æ»¤å™¨ï¼Ÿ

> è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨`Global Filters`
>
> ä¸»è¦æ˜¯å®ç°ä¸¤ä¸ªæ¥å£ `implements GlobalFilter,Ordered`
>
> å…·ä½“æ¡ˆä¾‹è¯·å‚è€ƒï¼šå®ä¾‹æ•™ç¨‹

## 52ã€ä»€ä¹ˆæ˜¯Spring Cloud Configï¼Ÿ

> SpringCloud Configä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒï¼Œé…ç½®æœåŠ¡å™¨ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®ã€‚
>
> SpringCloud Configåˆ†ä¸º**æœåŠ¡ç«¯**å’Œ**å®¢æˆ·ç«¯**ä¸¤éƒ¨åˆ†ã€‚
>
> - æœåŠ¡ç«¯ä¹Ÿç§°ä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨ï¼Œç”¨æ¥è¿æ¥é…ç½®æœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›è·å–é…ç½®ä¿¡æ¯ï¼ŒåŠ å¯†/è§£å¯†ä¿¡æ¯ç­‰è®¿é—®æ¥å£
> - å®¢æˆ·ç«¯åˆ™æ˜¯é€šè¿‡æŒ‡å®šçš„é…ç½®ä¸­å¿ƒæ¥ç®¡ç†åº”ç”¨èµ„æºï¼Œä»¥åŠä¸ä¸šåŠ¡ç›¸å…³çš„é…ç½®å†…å®¹ï¼Œå¹¶åœ¨å¯åŠ¨çš„æ—¶å€™ä»é…ç½®ä¸­å¿ƒè·å–å’ŒåŠ è½½é…ç½®ä¿¡æ¯é…ç½®æœåŠ¡å™¨é»˜è®¤é‡‡ç”¨gitæ¥å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·å°±æœ‰åŠ©äºå¯¹ç¯å¢ƒé…ç½®è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡gitå®¢æˆ·ç«¯å·¥å…·æ¥æ–¹ä¾¿çš„ç®¡ç†å’Œè®¿é—®é…ç½®å†…å®¹ã€‚

## 53ã€Spring Cloud Configæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

> - é›†ä¸­ç®¡ç†é…ç½®æ–‡ä»¶
> - ä¸åŒç¯å¢ƒä¸åŒé…ç½®ï¼ŒåŠ¨æ€åŒ–çš„é…ç½®æ›´æ–°ï¼Œåˆ†ç¯å¢ƒéƒ¨ç½²ï¼Œæ¯”å¦‚/devã€/testã€/prodã€/betaã€/release
> - è¿è¡ŒæœŸé—´åŠ¨æ€è°ƒæ•´é…ç½®ï¼Œä¸å†éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡éƒ¨ç½²çš„æœºå™¨ä¸Šç¼–å†™é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ä¼šå‘é…ç½®ä¸­å¿ƒç»Ÿä¸€æ‹‰å–é…ç½®è‡ªå·±çš„ä¿¡æ¯
> - å½“é…ç½®å‘ç”Ÿå˜åŠ¨æ—¶ï¼ŒæœåŠ¡ä¸éœ€è¦é‡å¯å³å¯æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–å¹¶åº”ç”¨æ–°çš„é…ç½®
> - å°†é…ç½®ä¿¡æ¯ä»¥RESTæ¥å£çš„å½¢å¼æš´éœ²
> - postã€curlè®¿é—®åˆ·æ–°å³å¯

## 54ã€Spring Cloud Configæ€ä¹ˆè¯»å–é…ç½®æ–‡ä»¶ï¼Ÿ

> ```
> /{application}/{profile}[/{label}]
> /{application}-{profile}.yml
> /{label}/{application}-{profile}.yml
> /{application}-{profile}.properties
> /{label}/{application}-{profile}.properties
> ```
>
> å…¶ä¸­â€œåº”ç”¨ç¨‹åºâ€ä½œä¸º`SpringApplication`ä¸­çš„`spring.config.name`æ³¨å…¥ï¼ˆå³å¸¸è§„Spring Bootåº”ç”¨ç¨‹åºä¸­é€šå¸¸ä¸ºâ€œåº”ç”¨ç¨‹åºâ€ï¼‰ï¼Œâ€œé…ç½®æ–‡ä»¶â€æ˜¯æ´»åŠ¨é…ç½®æ–‡ä»¶ï¼ˆæˆ–é€—å·åˆ†éš”åˆ—è¡¨ï¼‰çš„å±æ€§ï¼‰ï¼Œâ€œlabelâ€æ˜¯å¯é€‰çš„gitæ ‡ç­¾ï¼ˆé»˜è®¤ä¸ºâ€œmasterâ€ï¼‰
>
> labelï¼šåˆ†æ”¯(branch)
>
> name ï¼šæœåŠ¡å
>
> profilesï¼šç¯å¢ƒ(dev/test/prod)

## 55ã€Spring Cloud Configä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¦‚ä½•åŠ¨æ€åˆ·æ–°ï¼Ÿ

> é…åˆ`Spring Cloud Bus`å®ç°é…ç½®çš„åŠ¨æ€çš„åˆ·æ–°

## 56ã€ä»€ä¹ˆæ˜¯Spring Cloud Busæ¶ˆæ¯æ€»çº¿ï¼Ÿ

> Spring Cloud Buså°†åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹ä¸è½»é‡çº§æ¶ˆæ¯ä»£ç†é“¾æ¥ã€‚è¿™å¯ä»¥ç”¨äºå¹¿æ’­çŠ¶æ€æ›´æ”¹ï¼ˆä¾‹å¦‚é…ç½®æ›´æ”¹ï¼‰æˆ–å…¶ä»–ç®¡ç†æŒ‡ä»¤ã€‚ä¸€ä¸ªå…³é”®çš„æƒ³æ³•æ˜¯ï¼ŒBuså°±åƒä¸€ä¸ªæ‰©å±•çš„Spring Bootåº”ç”¨ç¨‹åºçš„åˆ†å¸ƒå¼æ‰§è¡Œå™¨ï¼Œä½†ä¹Ÿå¯ä»¥ç”¨ä½œåº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡æ¸ é“ã€‚å½“å‰å”¯ä¸€çš„å®ç°æ˜¯ä½¿ç”¨AMQPä»£ç†ä½œä¸ºä¼ è¾“ï¼Œä½†æ˜¯ç›¸åŒçš„åŸºæœ¬åŠŸèƒ½é›†ï¼ˆè¿˜æœ‰ä¸€äº›å–å†³äºä¼ è¾“ï¼‰åœ¨å…¶ä»–ä¼ è¾“çš„è·¯çº¿å›¾ä¸Šã€‚

## 57ã€Spring Cloud Buså¦‚ä½•åŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­ï¼Ÿ

> - åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªå®¢æˆ·ç«¯/bus/refreshï¼Œè€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯é…ç½®
> - åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ªæœåŠ¡ç«¯ConfigServerçš„/bus/refreshç«¯ç‚¹ï¼Œè€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®
>
> **æ¨èï¼š**ç¬¬äºŒä¸ªæ€æƒ³æ›´åˆé€‚ä¸€ç‚¹ï¼Œç¬¬ä¸€ä¸ªä¸é€‚åˆåŸå› å¦‚ä¸‹ï¼š
>
> - æ‰“ç ´äº†å¾®æœåŠ¡çš„å•ä¸€èŒè´£æ€§ï¼Œå› ä¸ºå¾®æœåŠ¡æœ¬èº«æ˜¯ä¸šåŠ¡æ¨¡å—ï¼Œå®ƒæœ¬ä¸åº”è¯¥æ‰¿æ‹…é…ç½®åˆ·æ–°çš„èŒè´£
> - ç ´åäº†å¾®æœåŠ¡å„èŠ‚ç‚¹çš„å¯¹ç­‰æ€§
> - æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚æ¯”å¦‚å¾®æœåŠ¡åœ¨è¿ç§»æ—¶ï¼Œå®ƒçš„ç½‘ç»œåœ°å€æ—¶å¸¸å‘ç”Ÿå˜åŒ–ï¼Œè¿™æ—¶è¦æƒ³åšåˆ°è‡ªåŠ¨åˆ·æ–°ï¼Œé‚£å°±ä¼šå¢åŠ æ›´å¤šçš„ä¿®æ”¹

## 58ã€Spring Cloud Buså¦‚ä½•åŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥ï¼Ÿ

> ä¸æƒ³é€šçŸ¥æ‰€æœ‰åˆ·æ–°ï¼Œè€Œåªæ˜¯æƒ³åˆ·æ–°ä¸€éƒ¨åˆ†é…ç½®ï¼Œå…¬å¼å¦‚ä¸‹ğŸ‘‡
>
> http://localhost:é…ç½®ä¸­å¿ƒçš„ç«¯å£å·/actuator/bus-refresh/{destination}
>
> bus/refreshè¯·æ±‚ä¸å†å‘é€åˆ°å…·ä½“çš„æœåŠ¡å®ä¾‹ä¸Šï¼Œè€Œæ˜¯å‘ç»™config serverå¹¶é€šè¿‡destinationå‚æ•°ç±»æŒ‡å®šéœ€è¦æ›´æ–°é…ç½®çš„æœåŠ¡æˆ–å®ä¾‹
>
> ç¤ºä¾‹ï¼šä»¥åˆ·æ–°è¿è¡Œåœ¨3355ç«¯å£ä¸Šçš„config-clientä¸ºä¾‹
>
> - curl -X POST "http://localhost:3344/actuator/bus-refresh/config-client:3355"

## 59ã€Spring Cloud Streamæ¶ˆæ¯é©±åŠ¨æ˜¯ä»€ä¹ˆï¼Ÿ

> å±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚,é™ä½åˆ‡æ¢æˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹ï¼›è½»é‡çº§äº‹ä»¶é©±åŠ¨å¾®æœåŠ¡æ¡†æ¶ï¼Œå¯ä»¥ä½¿ç”¨ç®€å•çš„å£°æ˜å¼æ¨¡å‹æ¥å‘é€åŠæ¥æ”¶æ¶ˆæ¯ï¼Œä¸»è¦å®ç°ä¸ºApache KafkaåŠRabbitMQï¼›

## 60ã€ä¸ºä»€ä¹ˆSpring Cloud Streamå¯ä»¥ç»Ÿä¸€åº•å±‚å·®å¼‚ï¼Ÿ

> åœ¨æ²¡æœ‰ç»‘å®šå™¨è¿™ä¸ªæ¦‚å¿µçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„SpringBootåº”ç”¨è¦ç›´æ¥ä¸æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œä¿¡æ¯äº¤äº’çš„æ—¶å€™ï¼Œç”±äºå„æ¶ˆæ¯ä¸­é—´ä»¶æ„å»ºçš„åˆè¡·ä¸åŒï¼Œå®ƒä»¬çš„å®ç°ç»†èŠ‚ä¸Šä¼šæœ‰è¾ƒå¤§çš„å·®å¼‚æ€§é€šè¿‡å®šä¹‰ç»‘å®šå™¨ä½œä¸ºä¸­é—´å±‚ï¼Œå®Œç¾åœ°å®ç°äº†**åº”ç”¨ç¨‹åºä¸æ¶ˆæ¯ä¸­é—´ä»¶ç»†èŠ‚ä¹‹é—´çš„éš”ç¦»**ã€‚é€šè¿‡å‘åº”ç”¨ç¨‹åºæš´éœ²ç»Ÿä¸€çš„Channelé€šé“ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºä¸éœ€è¦å†è€ƒè™‘å„ç§ä¸åŒçš„æ¶ˆæ¯ä¸­é—´ä»¶å®ç°ã€‚**é€šè¿‡å®šä¹‰ç»‘å®šå™¨Binderä½œä¸ºä¸­é—´å±‚ï¼Œå®ç°äº†åº”ç”¨ç¨‹åºä¸æ¶ˆæ¯ä¸­é—´ä»¶ç»†èŠ‚ä¹‹é—´çš„éš”ç¦»ã€‚**

## 61ã€Spring Cloud Streamå¦‚ä½•è§£å†³é‡å¤æ¶ˆè´¹å’ŒæŒä¹…åŒ–ï¼Ÿ

> åŠ å…¥åˆ†ç»„å±æ€§`Group`ï¼Œå¾®æœåŠ¡åº”ç”¨æ”¾ç½®äºåŒä¸€ä¸ª`Group`ä¸­ï¼Œå°±èƒ½å¤Ÿä¿è¯æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªåº”ç”¨æ¶ˆè´¹ä¸€æ¬¡ã€‚ä¸åŒçš„ç»„æ˜¯å¯ä»¥æ¶ˆè´¹çš„ï¼ŒåŒä¸€ä¸ªç»„å†…ä¼šå‘ç”Ÿç«äº‰å…³ç³»ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªå¯ä»¥æ¶ˆè´¹ã€‚

## 62ã€ä»€ä¹ˆæ˜¯Spring Cloud Sleuthï¼Ÿ

> Spring Cloud Sleuthæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æä¾›è¿½è¸ªè§£å†³æ–¹æ¡ˆå¹¶ä¸”å…¼å®¹æ”¯æŒäº†zipkinã€‚
